function makeWhiteSpace(e){for(var t=[],n=!0;e>0;e--)t.push(n||1==e?nbsp:" "),n^=!0;return t.join("")}function fixSpaces(e){return" "==e.charAt(0)&&(e=nbsp+e.slice(1)),e.replace(/\t/g,function(){return makeWhiteSpace(indentUnit)}).replace(/[ \u00a0]{2,}/g,function(e){return makeWhiteSpace(e.length)})}function cleanText(e){return e.replace(/\u00a0/g," ").replace(/\u200b/g,"")}function makePartSpan(e){var t=e;3==e.nodeType?t=e.nodeValue:e=document.createTextNode(t);var n=document.createElement("span");return n.isPart=!0,n.appendChild(e),n.currentText=t,n}function alwaysZero(){return 0}function asEditorLines(e){var t=makeWhiteSpace(indentUnit);return map(e.replace(/\t/g,t).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent),oldIE=internetExplorer&&/MSIE\s+[4-8]\b/.test(navigator.userAgent),webkit=/AppleWebKit/.test(navigator.userAgent),safari=/Apple Computer, Inc/.test(navigator.vendor),gecko=navigator.userAgent.match(/gecko\/(\d{8})/i);gecko&&(gecko=Number(gecko[1]));var mac=/Mac/.test(navigator.platform),brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent),slowWebkit=/AppleWebKit\/533/.test(navigator.userAgent),webkitLastLineHack=webkit?function(e){var t=e.lastChild;if(!t||!t.hackBR){var n=document.createElement("br");n.hackBR=!0,e.appendChild(n)}}:function(){},Editor=function(){function e(e,t){function n(e,o){if(3==e.nodeType){var s=e.nodeValue=fixSpaces(e.nodeValue.replace(/[\r\u200b]/g,"").replace(/\n/g," "));s.length&&(r=!1),i.push(e)}else if(isBR(e)&&0==e.childNodes.length)r=!0,i.push(e);else{for(var a=e.firstChild;a;a=a.nextSibling)n(a);!r&&c.hasOwnProperty(e.nodeName.toUpperCase())&&(r=!0,t&&o||i.push(document.createElement("br")))}}var i=[],r=!0;return n(e,!0),i}function t(t){function n(e){var t=e.parentNode,n=e.nextSibling;return function(e){t.insertBefore(e,n)}}function i(e){var t="\n";return 3==e.nodeType?(select.snapshotChanged(),e=makePartSpan(e),t=e.currentText,l=!1):(l&&window.opera&&c(makePartSpan("")),l=!0),e.dirty=!0,a.push(e),c(e),t}function r(t,n){for(var r=e(t,n),o=0;o<r.length;o++)r[o]=i(r[o]);return r.join("")}function o(e){if(e.isPart&&1==e.childNodes.length&&3==e.firstChild.nodeType){var t=e.firstChild.nodeValue;return e.dirty=e.dirty||t!=e.currentText,e.currentText=t,!/[\n\t\r]/.test(e.currentText)}return!1}function s(){if(!t)throw StopIteration;var e=t;if(t=e.nextSibling,o(e))return a.push(e),l=!1,e.currentText;if(isBR(e))return l&&window.opera&&e.parentNode.insertBefore(makePartSpan(""),e),a.push(e),l=!0,"\n";var i=!e.nextSibling;return c=n(e),removeElement(e),r(e,i)}var a=[],c=null,l=!0;return{next:s,nodes:a}}function n(e){for(;e&&!isBR(e);)e=e.previousSibling;return e}function i(e,t){for(e?isBR(e)&&(e=e.nextSibling):e=t.firstChild;e&&!isBR(e);)e=e.nextSibling;return e}function r(){return(new Date).getTime()}function o(e,t,n,i){function r(t){var n=cleanText(e.history.textAfter(t));return i?n.toLowerCase():n}this.editor=e,this.history=e.history,this.history.commit(),this.valid=!!t,this.atOccurrence=!1,void 0==i&&(i="string"==typeof t&&t==t.toLowerCase());var o={node:null,offset:0},s=this;if(n&&"object"==typeof n&&"number"==typeof n.character){e.checkLine(n.line);var a={node:n.line,offset:n.character};this.pos={from:a,to:a}}else n?this.pos={from:select.cursorPos(e.container,!0)||o,to:select.cursorPos(e.container,!1)||o}:this.pos={from:o,to:o};if("string"!=typeof t)return void(this.matches=function(e,n,i){if(e)for(var o=r(n).slice(0,i),a=o.match(t),c=0;a;){var l=o.indexOf(a[0]);c+=l,o=o.slice(l+1);var h=o.match(t);if(!h)break;a=h}else var o=r(n).slice(i),a=o.match(t),c=a&&i+o.indexOf(a[0]);return a?(s.currentMatch=a,{from:{node:n,offset:c},to:{node:n,offset:c+a[0].length}}):void 0});i&&(t=t.toLowerCase());var c=t.split("\n");this.matches=1==c.length?function(e,n,i){var o,s=r(n),a=t.length;return(e?i>=a&&-1!=(o=s.lastIndexOf(t,i-a)):-1!=(o=s.indexOf(t,i)))?{from:{node:n,offset:o},to:{node:n,offset:o+a}}:void 0}:function(e,t,n){var i=e?c.length-1:0,o=c[i],s=r(t),a=e?s.indexOf(o)+o.length:s.lastIndexOf(o);if(!(e?a>=n||a!=o.length:n>=a||a!=s.length-o.length))for(var l=t;;){if(e&&!l)return;if(l=e?this.history.nodeBefore(l):this.history.nodeAfter(l),!e&&!l)return;if(s=r(l),o=c[e?--i:++i],!(i>0&&i<c.length-1)){var h=e?s.lastIndexOf(o):s.indexOf(o)+o.length;if(e?h!=s.length-o.length:h!=o.length)return;return{from:{node:e?l:t,offset:e?h:a},to:{node:e?t:l,offset:e?a:h}}}if(s!=o)return}}}function s(e){function t(){void 0!=document.body.contentEditable&&internetExplorer?document.body.contentEditable="true":document.designMode="on",internetExplorer&&"dynamic"!=e.height&&(document.body.style.minHeight=window.frameElement.clientHeight-2*document.body.offsetTop-5+"px"),document.documentElement.style.borderWidth="0",e.textWrapping||(i.style.whiteSpace="nowrap")}function n(){r.cursorActivity(!1)}this.options=e,window.indentUnit=e.indentUnit;var i=this.container=document.body;this.history=new UndoHistory(i,e.undoDepth,e.undoDelay,this);var r=this;if(!s.Parser)throw"No parser loaded.";if(e.parserConfig&&s.Parser.configure&&s.Parser.configure(e.parserConfig),e.readOnly||internetExplorer||select.setCursorPos(i,{node:null,offset:0}),this.dirty=[],this.importCode(e.content||""),this.history.onChange=e.onChange,e.readOnly)e.textWrapping||(i.style.whiteSpace="nowrap");else{e.continuousScanning!==!1&&(this.scanner=this.documentScanner(e.passTime),this.delayScanning());try{t()}catch(o){var a=addEventHandler(document,"focus",function(){a(),t()},!0)}addEventHandler(document,"keydown",method(this,"keyDown")),addEventHandler(document,"keypress",method(this,"keyPress")),addEventHandler(document,"keyup",method(this,"keyUp")),addEventHandler(internetExplorer?document.body:window,"mouseup",n),addEventHandler(document.body,"cut",n),gecko&&addEventHandler(window,"pagehide",function(){r.unloaded=!0}),addEventHandler(document.body,"paste",function(e){n();var t=null;try{var i=e.clipboardData||window.clipboardData;i&&(t=i.getData("Text"))}catch(o){}null!==t&&(e.stop(),r.replaceSelection(t),select.scrollToCursor(r.container))}),this.options.autoMatchParens&&addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"))}}function a(e){return e>=16&&18>=e||e>=33&&40>=e}var c={P:!0,DIV:!0,LI:!0};return o.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function t(){var e={node:r,offset:o};return n.pos={from:e,to:e},n.atOccurrence=!1,!1}if(!this.valid)return!1;var n=this,i=e?this.pos.from:this.pos.to,r=i.node,o=i.offset;for(r&&!r.parentNode&&(r=null,o=0);;){if(this.pos=this.matches(e,r,o))return this.atOccurrence=!0,!0;if(e){if(!r)return t();r=this.history.nodeBefore(r),o=this.history.textAfter(r).length}else{var s=this.history.nodeAfter(r);if(!s)return o=this.history.textAfter(r).length,t();r=s,o=0}}},select:function(){this.atOccurrence&&(select.setCursorPos(this.editor.container,this.pos.from,this.pos.to),select.scrollToCursor(this.editor.container))},replace:function(e){if(this.atOccurrence){var t=this.currentMatch;t&&(e=e.replace(/\\(\d)/,function(e,n){return t[n]}));var n=this.editor.replaceRange(this.pos.from,this.pos.to,e);this.pos.to=n,this.atOccurrence=!1}},position:function(){return this.atOccurrence?{line:this.pos.from.node,character:this.pos.from.offset}:void 0}},s.prototype={importCode:function(e){function t(){var e=n.slice(r,r+i);e.push(""),o.history.push(o.history.nodeBefore(null),null,e),o.history.reset(),r+=i,r<n.length&&parent.setTimeout(t,1e3)}var n=asEditorLines(e),i=1e3;if(!this.options.incrementalLoading||n.length<i)this.history.push(null,null,n),this.history.reset();else{var r=0,o=this;t()}},getCode:function(){if(!this.container.firstChild)return"";var e=[];return select.markSelection(),forEach(t(this.container.firstChild),method(e,"push")),select.selectMarked(),webkit&&this.container.lastChild.hackBR&&e.pop(),webkitLastLineHack(this.container),cleanText(e.join(""))},checkLine:function(e){if(e===!1||null!=e&&e.parentNode!=this.container&&!e.hackBR)throw parent.CodeMirror.InvalidLineHandle},cursorPosition:function(e){null==e&&(e=!0);var t=select.cursorPos(this.container,e);return t?{line:t.node,character:t.offset}:{line:null,character:0}},firstLine:function(){return null},lastLine:function(){var e=this.container.lastChild;return e&&(e=n(e)),e&&e.hackBR&&(e=n(e.previousSibling)),e},nextLine:function(e){this.checkLine(e);var t=i(e,this.container);return!t||t.hackBR?!1:t},prevLine:function(e){return this.checkLine(e),null==e?!1:n(e.previousSibling)},visibleLineCount:function(){for(var e=this.container.firstChild;e&&isBR(e);)e=e.nextSibling;if(!e)return!1;var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return Math.floor(t/e.offsetHeight)},selectLines:function(e,t,n,i){this.checkLine(e);var r={node:e,offset:t},o=null;void 0!==i&&(this.checkLine(n),o={node:n,offset:i}),select.setCursorPos(this.container,r,o),select.scrollToCursor(this.container)},lineContent:function(e){var t=[];for(e=e?e.nextSibling:this.container.firstChild;e&&!isBR(e);e=e.nextSibling)t.push(nodeText(e));return cleanText(t.join(""))},setLineContent:function(e,t){this.history.commit(),this.replaceRange({node:e,offset:0},{node:e,offset:this.history.textAfter(e).length},t),this.addDirtyNode(e),this.scheduleHighlight()},removeLine:function(e){for(var t=e?e.nextSibling:this.container.firstChild;t;){var n=t.nextSibling;if(removeElement(t),isBR(t))break;t=n}this.addDirtyNode(e),this.scheduleHighlight()},insertIntoLine:function(e,t,n){var r=null;if("end"==t)r=i(e,this.container);else for(var o=e?e.nextSibling:this.container.firstChild;o;o=o.nextSibling){if(0==t){r=o;break}var s=nodeText(o);if(s.length>t){r=o.nextSibling,n=s.slice(0,t)+n+s.slice(t),removeElement(o);break}t-=s.length}for(var a=asEditorLines(n),c=0;c<a.length;c++)c>0&&this.container.insertBefore(document.createElement("BR"),r),this.container.insertBefore(makePartSpan(a[c]),r);this.addDirtyNode(e),this.scheduleHighlight()},selectedText:function(){var e=this.history;e.commit();var t=select.cursorPos(this.container,!0),n=select.cursorPos(this.container,!1);if(!t||!n)return"";if(t.node==n.node)return e.textAfter(t.node).slice(t.offset,n.offset);for(var i=[e.textAfter(t.node).slice(t.offset)],r=e.nodeAfter(t.node);r!=n.node;r=e.nodeAfter(r))i.push(e.textAfter(r));return i.push(e.textAfter(n.node).slice(0,n.offset)),cleanText(i.join("\n"))},replaceSelection:function(e){this.history.commit();var t=select.cursorPos(this.container,!0),n=select.cursorPos(this.container,!1);t&&n&&(n=this.replaceRange(t,n,e),select.setCursorPos(this.container,n),webkitLastLineHack(this.container))},cursorCoords:function(e,t){function n(e,n){var i=-(document.body.scrollTop||document.documentElement.scrollTop||0),r=-(document.body.scrollLeft||document.documentElement.scrollLeft||0)+n;return forEach([e,t?null:window.frameElement],function(e){for(;e;)r+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent}),{x:r,y:i,yBot:i+e.offsetHeight}}function i(e,t){var n=document.createElement("SPAN");n.appendChild(document.createTextNode(e));try{return t(n)}finally{n.parentNode&&n.parentNode.removeChild(n)}}var r=select.cursorPos(this.container,e);if(!r)return null;for(var o=r.offset,s=r.node,a=this;o;){s=s?s.nextSibling:this.container.firstChild;var c=nodeText(s);if(o<c.length)return i(c.substr(0,o),function(e){return e.style.position="absolute",e.style.visibility="hidden",e.className=s.className,a.container.appendChild(e),n(s,e.offsetWidth)});o-=c.length}return s&&isSpan(s)?n(s,s.offsetWidth):s&&s.nextSibling&&isSpan(s.nextSibling)?n(s.nextSibling,0):i("​",function(e){return s?s.parentNode.insertBefore(e,s.nextSibling):a.container.insertBefore(e,a.container.firstChild),n(e,0)})},reroutePasteEvent:function(){if(!(this.capturingPaste||window.opera||gecko&&gecko>=20101026)){this.capturingPaste=!0;var e=window.frameElement.CodeMirror.textareaHack,t=this.cursorCoords(!0,!0);if(e.style.top=t.y+"px",oldIE){var n=select.getBookmark(this.container);n&&(this.selectionSnapshot=n)}parent.focus(),e.value="",e.focus();var i=this;parent.setTimeout(function(){i.capturingPaste=!1,window.focus(),i.selectionSnapshot&&window.select.setBookmark(i.container,i.selectionSnapshot);var t=e.value;t&&(i.replaceSelection(t),select.scrollToCursor(i.container))},10)}},replaceRange:function(e,t,n){var i=asEditorLines(n);i[0]=this.history.textAfter(e.node).slice(0,e.offset)+i[0];var r=i[i.length-1];i[i.length-1]=r+this.history.textAfter(t.node).slice(t.offset);var o=this.history.nodeAfter(t.node);return this.history.push(e.node,o,i),{node:this.history.nodeBefore(o),offset:r.length}},getSearchCursor:function(e,t,n){return new o(this,e,t,n)},reindent:function(){this.container.firstChild&&this.indentRegion(null,this.container.lastChild)},reindentSelection:function(e){if(select.somethingSelected()){var t=select.selectionTopNode(this.container,!0),n=select.selectionTopNode(this.container,!1);if(t===!1||n===!1)return;this.indentRegion(t,n,e,!0)}else this.indentAtCursor(e)},grabKeys:function(e,t){this.frozen=e,this.keyFilter=t},ungrabKeys:function(){this.frozen="leave"},setParser:function(e,t){s.Parser=window[e],t=t||this.options.parserConfig,t&&s.Parser.configure&&s.Parser.configure(t),this.container.firstChild&&(forEach(this.container.childNodes,function(e){3!=e.nodeType&&(e.dirty=!0)}),this.addDirtyNode(this.firstChild),this.scheduleHighlight())},keyDown:function(e){if("leave"==this.frozen&&(this.frozen=null,this.keyFilter=null),this.frozen&&(!this.keyFilter||this.keyFilter(e.keyCode,e)))return e.stop(),void this.frozen(e);var t=e.keyCode;if(this.delayScanning(),this.options.autoMatchParens&&this.scheduleParenHighlight(),13==t){if(e.ctrlKey&&!e.altKey)this.reparseBuffer();else{select.insertNewlineAtCursor();var r=this.options.enterMode;"flat"!=r&&this.indentAtCursor("keep"==r?"keep":void 0),select.scrollToCursor(this.container)}e.stop()}else if(9!=t||"default"==this.options.tabMode||e.ctrlKey)if(32==t&&e.shiftKey&&"default"==this.options.tabMode)this.handleTab(!0),e.stop();else if(36!=t||e.shiftKey||e.ctrlKey)if(35!=t||e.shiftKey||e.ctrlKey)if(33!=t||e.shiftKey||e.ctrlKey||gecko)if(34!=t||e.shiftKey||e.ctrlKey||gecko)if(219!=t&&221!=t||!e.ctrlKey||e.altKey)if(!e.metaKey||e.shiftKey||37!=t&&39!=t)!e.ctrlKey&&!e.metaKey||e.altKey||(e.shiftKey&&90==t||89==t?(select.scrollToNode(this.history.redo()),e.stop()):90==t||safari&&8==t?(select.scrollToNode(this.history.undo()),e.stop()):83==t&&this.options.saveFunction?(this.options.saveFunction(),e.stop()):86!=t||mac||this.reroutePasteEvent());else{var o=select.selectionTopNode(this.container);if(o===!1||!this.container.firstChild)return;if(37==t)select.focusAfterNode(n(o),this.container);else{var s=i(o,this.container);select.focusAfterNode(s?s.previousSibling:this.container.lastChild,this.container)}e.stop()}else this.highlightParens(e.shiftKey,!0),e.stop();else this.pageDown()&&e.stop();else this.pageUp()&&e.stop();else this.end()&&e.stop();else this.home()&&e.stop();else this.handleTab(!e.shiftKey),e.stop()},keyPress:function(e){var t=this.options.electricChars&&s.Parser.electricChars,n=this;if(this.frozen&&(!this.keyFilter||this.keyFilter(e.keyCode||e.code,e))||13==e.code||9==e.code&&"default"!=this.options.tabMode||32==e.code&&e.shiftKey&&"default"==this.options.tabMode)e.stop();else if(mac&&(e.ctrlKey||e.metaKey)&&"v"==e.character)this.reroutePasteEvent();else if(t&&-1!=t.indexOf(e.character))parent.setTimeout(function(){n.indentAtCursor(null)},0);else if(brokenOpera){if(8==e.code){var i=select.selectionTopNode(this.container),n=this,r=i?i.nextSibling:this.container.firstChild;i!==!1&&r&&isBR(r)&&parent.setTimeout(function(){select.selectionTopNode(n.container)==r&&select.focusAfterNode(r.previousSibling,n.container)},20)}else if(46==e.code){var i=select.selectionTopNode(this.container),n=this;i&&isBR(i)&&parent.setTimeout(function(){select.selectionTopNode(n.container)!=i&&select.focusAfterNode(i,n.container)},20)}}else if(slowWebkit){var i=select.selectionTopNode(this.container),r=i?i.nextSibling:this.container.firstChild;if(i&&r&&isBR(r)&&!isBR(i)){var o=document.createTextNode("​");this.container.insertBefore(o,r),parent.setTimeout(function(){"​"==o.nodeValue?removeElement(o):o.nodeValue=o.nodeValue.replace("​","")},20)}}webkit&&!this.options.textWrapping&&setTimeout(function(){var e=select.selectionTopNode(n.container,!0);e&&3==e.nodeType&&e.previousSibling&&isBR(e.previousSibling)&&e.nextSibling&&isBR(e.nextSibling)&&e.parentNode.replaceChild(document.createElement("BR"),e.previousSibling)},50)},keyUp:function(e){this.cursorActivity(a(e.keyCode))},indentLineAfter:function(e,t){function i(e){var t=e?e.nextSibling:r.container.firstChild;return t&&hasClass(t,"whitespace")?t:null}var r=this,o=i(e),a=0,c=o?o.currentText.length:0,l=o?o.nextSibling:e?e.nextSibling:this.container.firstChild;if("keep"==t){if(e){var h=i(n(e.previousSibling));h&&(a=h.currentText.length)}}else{var d=e&&l&&l.currentText?l.currentText:"";null!=t&&"indent"!=this.options.tabMode?a=t?c+indentUnit:Math.max(0,c-indentUnit):e?a=e.indentation(d,c,t,l):s.Parser.firstIndentation&&(a=s.Parser.firstIndentation(d,c,t,l))}var u=a-c;0>u?0==a?(l&&select.snapshotMove(o.firstChild,l.firstChild||l,0),removeElement(o),o=null):(select.snapshotMove(o.firstChild,o.firstChild,u,!0),o.currentText=makeWhiteSpace(a),o.firstChild.nodeValue=o.currentText):u>0?o?(o.currentText=makeWhiteSpace(a),o.firstChild.nodeValue=o.currentText,select.snapshotMove(o.firstChild,o.firstChild,u,!0)):(o=makePartSpan(makeWhiteSpace(a)),o.className="whitespace",e?insertAfter(o,e):this.container.insertBefore(o,this.container.firstChild),select.snapshotMove(l&&(l.firstChild||l),o.firstChild,a,!1,!0)):o&&select.snapshotMove(o.firstChild,o.firstChild,a,!1),0!=u&&this.addDirtyNode(e)},highlightAtCursor:function(){var e=select.selectionTopNode(this.container,!0),t=select.selectionTopNode(this.container,!1);return e===!1||t===!1?!1:(select.markSelection(),this.highlight(e,i(t,this.container),!0,20)===!1?!1:(select.selectMarked(),!0))},handleTab:function(e){"spaces"!=this.options.tabMode||select.somethingSelected()?this.reindentSelection(e):select.insertTabAtCursor()},home:function(){var e=select.selectionTopNode(this.container,!0),t=e;if(e===!1||e&&!e.isPart&&!isBR(e)||!this.container.firstChild)return!1;for(;e&&!isBR(e);)e=e.previousSibling;var n=e?e.nextSibling:this.container.firstChild;return n&&n!=t&&n.isPart&&hasClass(n,"whitespace")?select.focusAfterNode(n,this.container):select.focusAfterNode(e,this.container),select.scrollToCursor(this.container),!0},end:function(){var e=select.selectionTopNode(this.container,!0);return e===!1?!1:(e=i(e,this.container))?(select.focusAfterNode(e.previousSibling,this.container),select.scrollToCursor(this.container),!0):!1},pageUp:function(){var e=this.cursorPosition().line,t=this.visibleLineCount();if(e===!1||t===!1)return!1;t-=2;for(var n=0;t>n&&(e=this.prevLine(e),e!==!1);n++);return 0==n?!1:(select.setCursorPos(this.container,{node:e,offset:0}),select.scrollToCursor(this.container),!0)},pageDown:function(){var e=this.cursorPosition().line,t=this.visibleLineCount();if(e===!1||t===!1)return!1;t-=2;for(var n=0;t>n;n++){var i=this.nextLine(e);if(i===!1)break;e=i}return 0==n?!1:(select.setCursorPos(this.container,{node:e,offset:0}),select.scrollToCursor(this.container),!0)},scheduleParenHighlight:function(){this.parenEvent&&parent.clearTimeout(this.parenEvent);var e=this;this.parenEvent=parent.setTimeout(function(){e.highlightParens()},300)},highlightParens:function(e,t){function n(e,t){e&&(l?l.call?l(e,t):e.className+=" "+l[t?0:1]:(e.style.fontWeight="bold",e.style.color=t?"#8F8":"#F88"))}function r(e){e&&(l&&!l.call?removeClass(removeClass(e,l[0]),l[1]):c.options.unmarkParen?c.options.unmarkParen(e):(e.style.fontWeight="",e.style.color=""))}function o(e){if(e.currentText){var t=e.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return t&&t[1]}}function s(e){return/[\(\[\{]/.test(e)}function a(){for(var e,t=[],n=!0,i=d;i;i=f?i.nextSibling:i.previousSibling)if(i.className==u&&isSpan(i)&&(e=o(i))){if(s(e)==f?t.push(e):t.length?t.pop()!=matching[e]&&(n=!1):n=!1,!t.length)break}else if(i.dirty||!isSpan(i)&&!isBR(i))return{node:i,status:"dirty"};return{node:i,status:i&&n}}var c=this,l=this.options.markParen;if("string"==typeof l&&(l=[l,l]),!t&&c.highlighted&&(r(c.highlighted[0]),r(c.highlighted[1])),window&&window.parent&&window.select){this.parenEvent&&parent.clearTimeout(this.parenEvent),this.parenEvent=null;var h,d=select.selectionTopNode(this.container,!0);if(d&&this.highlightAtCursor()&&(d=select.selectionTopNode(this.container,!0),d&&((h=o(d))||(d=d.nextSibling)&&(h=o(d))))){var u=d.className,f=s(h);for(matching[h];;){var p=a();{if("dirty"!=p.status){n(d,p.status),n(p.node,p.status),t?parent.setTimeout(function(){r(d),r(p.node)},500):c.highlighted=[d,p.node],e&&p.node&&select.focusAfterNode(p.node.previousSibling,this.container);break}this.highlight(p.node,i(p.node)),p.node.dirty=!1}}}}},indentAtCursor:function(e){if(this.container.firstChild&&this.highlightAtCursor()){var t=select.selectionTopNode(this.container,!1);t!==!1&&(select.markSelection(),this.indentLineAfter(n(t),e),select.selectMarked())}},indentRegion:function(e,t,r,o){var s=e=n(e),a=e&&n(e.previousSibling);isBR(t)||(t=i(t,this.container)),this.addDirtyNode(e);do{var c=i(s,this.container);s&&this.highlight(a,c,!0),this.indentLineAfter(s,r),a=s,s=c}while(s!=t);o&&select.setCursorPos(this.container,{node:e,offset:0},{node:t,offset:0})},cursorActivity:function(e){if(this.unloaded&&(window.document.designMode="off",window.document.designMode="on",this.unloaded=!1),oldIE){this.container.createTextRange().execCommand("unlink"),clearTimeout(this.saveSelectionSnapshot);var t=this;this.saveSelectionSnapshot=setTimeout(function(){var e=select.getBookmark(t.container);e&&(t.selectionSnapshot=e)},200)}var n=this.options.onCursorActivity;if(!e||n){var i=select.selectionTopNode(this.container,!1);if(i===!1||!this.container.firstChild)return;i=i||this.container.firstChild,n&&n(i),e||(this.scheduleHighlight(),this.addDirtyNode(i))}},reparseBuffer:function(){forEach(this.container.childNodes,function(e){e.dirty=!0}),this.container.firstChild&&this.addDirtyNode(this.container.firstChild)},addDirtyNode:function(e){if(e=e||this.container.firstChild){for(var t=0;t<this.dirty.length;t++)if(this.dirty[t]==e)return;3!=e.nodeType&&(e.dirty=!0),this.dirty.push(e)}},allClean:function(){return!this.dirty.length},scheduleHighlight:function(){var e=this;parent.clearTimeout(this.highlightTimeout),this.highlightTimeout=parent.setTimeout(function(){e.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){for(;this.dirty.length>0;){var e=this.dirty.pop();try{for(;e&&e.parentNode!=this.container;)e=e.parentNode;if(e&&(e.dirty||3==e.nodeType))return e}catch(t){}}return null},highlightDirty:function(e){if(!window||!window.parent||!window.select)return!1;this.options.readOnly||select.markSelection();for(var t,n=e?null:r()+this.options.passTime;(r()<n||e)&&(t=this.getDirtyNode());){var i=this.highlight(t,n);i&&i.node&&i.dirty&&this.addDirtyNode(i.node.nextSibling)}return this.options.readOnly||select.selectMarked(),t&&this.scheduleHighlight(),0==this.dirty.length},documentScanner:function(e){var t=this,n=null;return function(){if(window&&window.parent&&window.select){n&&n.parentNode!=t.container&&(n=null),select.markSelection();var i=t.highlight(n,r()+e,!0);select.selectMarked();var o=i?i.node&&i.node.nextSibling:null;n=n==o?null:o,t.delayScanning()}}},delayScanning:function(){this.scanner&&(parent.clearTimeout(this.documentScan),this.documentScan=parent.setTimeout(this.scanner,this.options.continuousScanning))},highlight:function(e,n,i,o){function a(e,t){return!t.reduced&&t.currentText==e.value&&t.className==e.style}function c(e,t){e.currentText=e.currentText.substring(t),e.reduced=!0}function l(e){var t=makePartSpan(e.value);return t.className=e.style,t}function h(e){if(e){var t=e.oldNextSibling;(C||void 0===t||e.nextSibling!=t)&&f.history.touch(e),e.oldNextSibling=e.nextSibling}else{var t=f.container.oldFirstChild;(C||void 0===t||f.container.firstChild!=t)&&f.history.touch(null),f.container.oldFirstChild=f.container.firstChild}}function d(e){return(null==e.previousSibling||isBR(e.previousSibling))&&(null==e.nextSibling||isBR(e.nextSibling))}var u=this.container,f=this,p=this.options.activeTokens,g="number"==typeof n?n:null;if(!u.firstChild)return!1;for(;e&&(!e.parserFromHere||e.dirty);){if(null!=o&&isBR(e)&&--o<0)return!1;e=e.previousSibling}if(e&&!e.nextSibling)return!1;var v=t(e?e.nextSibling:u.firstChild),m=stringStream(v),y=e?e.parserFromHere(m):s.Parser.make(m),b={current:null,get:function(){return this.current||(this.current=v.nodes.shift()),this.current},next:function(){this.current=null},remove:function(){u.removeChild(this.get()),this.current=null},getNonEmpty:function(){for(var e=this.get();e&&isSpan(e)&&""==e.currentText;)if(window.opera&&d(e))this.next(),e=this.get();else{var t=e;this.remove(),e=this.get(),select.snapshotMove(t.firstChild,e&&(e.firstChild||e),0)}return e}},C=!1,x=!0,S=0;return forEach(y,function(t){var o=b.getNonEmpty();if("\n"==t.value){if(!isBR(o))throw"Parser out of sync. Expected BR.";if((o.dirty||!o.indentation)&&(C=!0),h(e),e=o,o.parserFromHere=y.copy(),o.indentation=t.indentation||alwaysZero,o.dirty=!1,null==g&&o==n)throw StopIteration;if(null!=g&&r()>=g||!C&&!x&&S>1&&!i)throw StopIteration;x=C,C=!1,S=0,b.next()}else{if(!isSpan(o))throw"Parser out of sync. Expected SPAN.";if(o.dirty&&(C=!0),S++,a(t,o))p&&o.dirty&&p(o,t,f),o.dirty=!1,b.next();else{C=!0;var s=l(t);u.insertBefore(s,o),p&&p(s,t,f);for(var d=t.value.length,v=0;d>0;){o=b.get();var m=o.currentText.length;select.snapshotReplaceNode(o.firstChild,s.firstChild,d,v),m>d?(c(o,d),d=0):(d-=m,v+=m,b.remove())}}}}),h(e),webkitLastLineHack(this.container),{node:b.getNonEmpty(),dirty:C}}},s}();addEventHandler(window,"load",function(){var e=window.frameElement.CodeMirror;e.editor=new Editor(e.options);parent.setTimeout(method(e,"init"),0)});