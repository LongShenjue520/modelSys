var XMLParser=Editor.Parser=function(){function n(n){function t(n){for(var t=n.length-1;t>=0;t--)k.push(n[t])}function e(){t(arguments),C=!0}function a(){t(arguments),C=!1}function l(){A.style+=" xml-error"}function i(n){return function(t,r){r==n?e():(l(),e(arguments.callee))}}function c(n,t){var e=r.doNotIndent.hasOwnProperty(n)||T&&T.noIndent;T={prev:T,name:n,indent:O,startOfLine:t,noIndent:e}}function f(){T=T.prev}function s(n){return function(t,e){var r=n;if(r&&r.noIndent)return e;if(o&&/<!\[CDATA\[/.test(t))return 0;for(r&&/^<\//.test(t)&&(r=r.prev);r&&!r.startOfLine;)r=r.prev;return r?r.indent+indentUnit:0}}function m(){return a(x,m)}function x(n,t){"<"==t?e(d,g,h(1==w)):"</"==t?e(p,i(">")):"xml-cdata"==n?(T&&"!cdata"==T.name||c("!cdata"),/\]\]>$/.test(t)&&f(),e()):b.hasOwnProperty(n)?e():(l(),e())}function d(n,t){"xml-name"==n?(M=t.toLowerCase(),A.style="xml-tagname",e()):(M=null,a())}function p(n,t){"xml-name"==n&&(A.style="xml-tagname",T&&t.toLowerCase()==T.name?f():l()),e()}function h(n){return function(t,o){"/>"==o||">"==o&&r.autoSelfClosers.hasOwnProperty(M)?e():">"==o?(c(M,n),e()):(l(),e(arguments.callee))}}function g(n){"xml-name"==n?(A.style="xml-attname",e(y,g)):a()}function y(n,t){"="==t?e(v):">"==t||"/>"==t?a(h):a()}function v(n){"xml-attribute"==n?e(v):a()}var A,C,L=u(n),k=[m],w=0,O=0,M=null,T=null,b={"xml-text":!0,"xml-entity":!0,"xml-comment":!0,"xml-processing":!0,"xml-doctype":!0};return{indentation:function(){return O},next:function(){if(A=L.next(),"whitespace"==A.style&&0==w?O=A.value.length:w++,"\n"==A.content&&(O=w=0,A.indentation=s(T)),"whitespace"==A.style||"xml-comment"==A.type)return A;for(;;)if(C=!1,k.pop()(A.style,A.content),C)return A},copy:function(){var n=k.concat([]),t=L.state,e=T,r=this;return function(o){return k=n.concat([]),w=O=0,T=e,L=u(o,t),r}}}}var t={autoSelfClosers:{br:!0,img:!0,hr:!0,link:!0,input:!0,meta:!0,col:!0,frame:!0,base:!0,area:!0},doNotIndent:{pre:!0,"!cdata":!0}},e={autoSelfClosers:{},doNotIndent:{"!cdata":!0}},r=t,o=!1,u=function(){function n(n,e){var o=n.next();if("<"==o)return n.equals("!")?(n.next(),n.equals("[")?n.lookAhead("[CDATA[",!0)?(e(r("xml-cdata","]]>")),null):"xml-text":n.lookAhead("--",!0)?(e(r("xml-comment","-->")),null):n.lookAhead("DOCTYPE",!0)?(n.nextWhileMatches(/[\w\._\-]/),e(r("xml-doctype",">")),"xml-doctype"):"xml-text"):n.equals("?")?(n.next(),n.nextWhileMatches(/[\w\._\-]/),e(r("xml-processing","?>")),"xml-processing"):(n.equals("/")&&n.next(),e(t),"xml-punctuation");if("&"==o){for(;!n.endOfLine()&&";"!=n.next(););return"xml-entity"}return n.nextWhileMatches(/[^&<\n]/),"xml-text"}function t(t,r){var o=t.next();return">"==o?(r(n),"xml-punctuation"):/[?\/]/.test(o)&&t.equals(">")?(t.next(),r(n),"xml-punctuation"):"="==o?"xml-punctuation":/[\'\"]/.test(o)?(r(e(o)),null):(t.nextWhileMatches(/[^\s\u00a0=<>\"\'\/?]/),"xml-name")}function e(n){return function(e,r){for(;!e.endOfLine();)if(e.next()==n){r(t);break}return"xml-attribute"}}function r(t,e){return function(r,o){for(;!r.endOfLine();){if(r.lookAhead(e,!0)){o(n);break}r.next()}return t}}return function(t,e){return tokenizer(t,e||n)}}();return{make:n,electricChars:"/",configure:function(n){null!=n.useHTMLKludges&&(r=n.useHTMLKludges?t:e),n.alignCDATA&&(o=n.alignCDATA)}}}();