!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}(function(e){function t(t){if(t.getOption("disableInput"))return e.Pass;for(var n=t.listSelections(),i=[],s=0;s<n.length;s++){if(!n[s].empty())return e.Pass;var l=n[s].head,c=t.getTokenAt(l),d=e.innerMode(t.getMode(),c.state),f=d.state;if("xml"!=d.mode.name||!f.tagName)return e.Pass;var g=t.getOption("autoCloseTags"),u="html"==d.mode.configuration,h="object"==typeof g&&g.dontCloseTags||u&&r,m="object"==typeof g&&g.indentTags||u&&a,p=f.tagName;c.end>l.ch&&(p=p.slice(0,p.length-c.end+l.ch));var b=p.toLowerCase();if(!p||"string"==c.type&&(c.end!=l.ch||!/[\"\']/.test(c.string.charAt(c.string.length-1))||1==c.string.length)||"tag"==c.type&&"closeTag"==f.type||c.string.indexOf("/")==c.string.length-1||h&&o(h,b)>-1||e.scanForClosingTag&&e.scanForClosingTag(t,l,p,Math.min(t.lastLine()+1,l.line+50)))return e.Pass;var y=m&&o(m,b)>-1;i[s]={indent:y,text:">"+(y?"\n\n":"")+"</"+p+">",newPos:y?e.Pos(l.line+1,0):e.Pos(l.line,l.ch+1)}}for(var s=n.length-1;s>=0;s--){var v=i[s];t.replaceRange(v.text,n[s].head,n[s].anchor,"+insert");var P=t.listSelections().slice(0);P[s]={head:v.newPos,anchor:v.newPos},t.setSelections(P),v.indent&&(t.indentLine(v.newPos.line,null,!0),t.indentLine(v.newPos.line+1,null,!0))}}function n(t){if(t.getOption("disableInput"))return e.Pass;for(var n=t.listSelections(),o=[],r=0;r<n.length;r++){if(!n[r].empty())return e.Pass;var a=n[r].head,i=t.getTokenAt(a),s=e.innerMode(t.getMode(),i.state),l=s.state;if("string"==i.type||"<"!=i.string.charAt(0)||i.start!=a.ch-1||"xml"!=s.mode.name||!l.context||!l.context.tagName)return e.Pass;o[r]="/"+l.context.tagName+">"}t.replaceSelections(o)}function o(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;o>n;++n)if(e[n]==t)return n;return-1}e.defineOption("autoCloseTags",!1,function(o,r,a){if(a!=e.Init&&a&&o.removeKeyMap("autoCloseTags"),r){var i={name:"autoCloseTags"};("object"!=typeof r||r.whenClosing)&&(i["'/'"]=function(e){return n(e)}),("object"!=typeof r||r.whenOpening)&&(i["'>'"]=function(e){return t(e)}),o.addKeyMap(i)}});var r=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],a=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"]});