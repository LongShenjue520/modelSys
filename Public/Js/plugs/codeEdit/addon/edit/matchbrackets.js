!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){function e(t,e,i,r){var o=t.getLineHandle(e.line),f=e.ch-1,l=f>=0&&c[o.text.charAt(f)]||c[o.text.charAt(++f)];if(!l)return null;var h=">"==l.charAt(1)?1:-1;if(i&&h>0!=(f==e.ch))return null;var u=t.getTokenTypeAt(a(e.line,f+1)),s=n(t,a(e.line,f+(h>0?1:0)),h,u||null,r);return{from:a(e.line,f),to:s&&s.pos,match:s&&s.ch==l.charAt(0),forward:h>0}}function n(t,e,n,i,r){for(var o=r&&r.maxScanLineLength||1e4,f=r&&r.maxScanLines||500,l=[],h=/[(){}[\]]/,u=n>0?Math.min(e.line+f,t.lastLine()+1):Math.max(t.firstLine()-1,e.line-f),s=e.line;s!=u;s+=n){var m=t.getLine(s);if(m){var d=n>0?0:m.length-1,g=n>0?m.length:-1;if(!(m.length>o))for(s==e.line&&(d=e.ch-(0>n?1:0));d!=g;d+=n){var p=m.charAt(d);if(h.test(p)&&(void 0===i||t.getTokenTypeAt(a(s,d+1))==i)){var v=c[p];if(">"==v.charAt(1)==n>0)l.push(p);else{if(!l.length)return{pos:a(s,d),ch:p};l.pop()}}}}}}function i(t,n,i){for(var r=t.state.matchBrackets.maxHighlightLineLength||1e3,c=[],f=t.listSelections(),l=0;l<f.length;l++){var h=f[l].empty()&&e(t,f[l].head,!1,i);if(h&&t.getLine(h.from.line).length<=r&&h.to&&t.getLine(h.to.line).length<=r){var u=h.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";c.push(t.markText(h.from,a(h.from.line,h.from.ch+1),{className:u})),h.to&&c.push(t.markText(h.to,a(h.to.line,h.to.ch+1),{className:u}))}}if(c.length){o&&t.state.focused&&t.display.input.focus();var s=function(){t.operation(function(){for(var t=0;t<c.length;t++)c[t].clear()})};if(!n)return s;setTimeout(s,800)}}function r(t){t.operation(function(){f&&(f(),f=null),f=i(t,!1,t.state.matchBrackets)})}var o=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),a=t.Pos,c={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},f=null;t.defineOption("matchBrackets",!1,function(e,n,i){i&&i!=t.Init&&e.off("cursorActivity",r),n&&(e.state.matchBrackets="object"==typeof n?n:{},e.on("cursorActivity",r))}),t.defineExtension("matchBrackets",function(){i(this,!0)}),t.defineExtension("findMatchingBracket",function(t,n){return e(this,t,n)}),t.defineExtension("scanForBracket",function(t,e,i){return n(this,t,e,i)})});