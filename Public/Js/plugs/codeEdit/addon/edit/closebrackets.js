!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function n(n,t){var r=n.getRange(e.Pos(t.line,t.ch-1),e.Pos(t.line,t.ch+1));return 2==r.length?r:null}function t(t){for(var r={name:"autoCloseBrackets",Backspace:function(r){if(r.getOption("disableInput"))return e.Pass;for(var i=r.listSelections(),o=0;o<i.length;o++){if(!i[o].empty())return e.Pass;var a=n(r,i[o].head);if(!a||t.indexOf(a)%2!=0)return e.Pass}for(var o=i.length-1;o>=0;o--){var s=i[o].head;r.replaceRange("",e.Pos(s.line,s.ch-1),e.Pos(s.line,s.ch+1))}}},i="",o=0;o<t.length;o+=2)(function(n,t){n!=t&&(i+=t),r["'"+n+"'"]=function(r){if(r.getOption("disableInput"))return e.Pass;for(var o,s,l=r.listSelections(),f=0;f<l.length;f++){var c,u=l[f],d=u.head;if("'"==n&&"comment"==r.getTokenTypeAt(d))return e.Pass;var s=r.getRange(d,e.Pos(d.line,d.ch+1));if(u.empty())if(n==t&&s==t)c="skip";else{if(n==t&&e.isWordChar(s))return e.Pass;if(!(r.getLine(d.line).length==d.ch||i.indexOf(s)>=0||a.test(s)))return e.Pass;c="both"}else c="surround";if(o){if(o!=c)return e.Pass}else o=c}if("skip"==o)r.execCommand("goCharRight");else if("surround"==o){for(var h=r.getSelections(),f=0;f<h.length;f++)h[f]=n+h[f]+t;r.replaceSelections(h,"around")}else"both"==o&&(r.replaceSelection(n+t,null),r.execCommand("goCharLeft"))},n!=t&&(r["'"+t+"'"]=function(n){for(var r=n.listSelections(),i=0;i<r.length;i++){var o=r[i];if(!o.empty()||n.getRange(o.head,e.Pos(o.head.line,o.head.ch+1))!=t)return e.Pass}n.execCommand("goCharRight")})})(t.charAt(o),t.charAt(o+1));return r}function r(t){return function(r){if(r.getOption("disableInput"))return e.Pass;for(var i=r.listSelections(),o=0;o<i.length;o++){if(!i[o].empty())return e.Pass;var a=n(r,i[o].head);if(!a||t.indexOf(a)%2!=0)return e.Pass}r.operation(function(){r.replaceSelection("\n\n",null),r.execCommand("goCharLeft"),i=r.listSelections();for(var e=0;e<i.length;e++){var n=i[e].head.line;r.indentLine(n,null,!0),r.indentLine(n+1,null,!0)}})}}var i="()[]{}''\"\"",o="[]{}",a=/\s/;e.defineOption("autoCloseBrackets",!1,function(n,a,s){if(s!=e.Init&&s&&n.removeKeyMap("autoCloseBrackets"),a){var l=i,f=o;"string"==typeof a?l=a:"object"==typeof a&&(null!=a.pairs&&(l=a.pairs),null!=a.explode&&(f=a.explode));var c=t(l);f&&(c.Enter=r(f)),n.addKeyMap(c)}})});