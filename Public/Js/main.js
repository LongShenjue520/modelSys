function newRow(e){var t=$(".list:visible"),a=t.find("th"),l=a.length,r=t.find("tr").last().attr("class");if(""==r)var i="<tr class='trbg'>";else var i="<tr>";for(var n="",s="",d=0;l>d;d++)n=a.eq(d).attr("type"),s=a.eq(d).attr("field"),"id"==s||"undefined"==typeof s?i+="<td>#</td>":"time"==n?i+="<td><input type='text' name='"+a.eq(d).attr("rfield")+"[]' size='10' readonly='true' class='date textInput readonly'></td>":"status"==n?i+="<td><select name='status[]'><option value='1'>启用</option><option value='0'>禁用</option></select></td>":"undefined"!=typeof n&&"count"!=n?$.ajax({url:e+"/getGroup/type/"+n,async:!1,type:"GET",dataType:"json",success:function(e){i+="<td><select name='"+s+"[]'>";for(var t=0;t<e.length;t++)i+="<option value='"+e[t].id+"'>"+e[t].name+"</option>";i+="</select></td>"}}):i+="<td><input name='"+s+"[]' type='text' class='textInput' /></td>";if(i+="</tr>",t.append(i),"undefined"==typeof $("#bInsert").attr("id")){var o=document.createElement("form");o.id="bInsert",o.method="post",o.action=e+"/batchInsert",t.wrap(o)}$.fn.datepicker&&$("input.date").each(function(){var e=$(this),t={};e.attr("format")&&(t.pattern=e.attr("format")),e.attr("yearstart")&&(t.yearstart=e.attr("yearstart")),e.attr("yearend")&&(t.yearend=e.attr("yearend")),e.datepicker(t)})}function batchInsertSubmit(){"undefined"==typeof $("#bInsert").attr("id")?alertMsg.warn("请添加行！"):$("#bInsert").submit()}function sonPageInit(){$(".autocomplete").each(function(){$(this).autocomplete({serviceUrl:TP_APP+"/Public/autocomplete"})})}function addFifterItem(){var e=$(".list:visible").eq(0).find("th[field]"),t=e.length,a=new Array;for(i=0;i<t;i++)a[i]=e.eq(i).attr("field");var l=$("#fifter .unit label");for(j=0;j<l.length;j++)for(i=0;i<t;i++)l.eq(j).attr("field")==a[i]&&delete a[i];var r="<div id='selFifterItem' class='unit'><label>";r+="<select onchange='getNewFifterItem(this);'><option value=''>请选择</option>";for(index in a)r+="<option type='"+e.eq(index).attr("type")+"' value='"+a[index]+"'>"+e.eq(index).text()+"</option>";r+="</select></label></div>",$("#fifter").append(r)}function getNewFifterItem(e){var t=$(e).find("option:selected"),a=TP_APP+"/Public/new_fifter",l={field:t.val(),type:t.attr("type"),showname:t.text()};$.get(a,l,function(e){$("#selFifterItem").remove(),$("#fifter").append(e),$.fn.datepicker&&$("input.date").each(function(){var e=$(this),t={};e.attr("format")&&(t.pattern=e.attr("format")),e.attr("yearstart")&&(t.yearstart=e.attr("yearstart")),e.attr("yearend")&&(t.yearend=e.attr("yearend")),e.datepicker(t)})})}function del_current_fifter(e){$close=$(e),$close.parent().remove()}function setConf(form){var fields="";$("tr[name=fields]").each(function(e){var t="",a="";$(this).find("input").each(function(e){var l=$(this);a=l.attr("name"),t+="checkbox"==l.attr("type")?l.attr("checked")?"1":"":l.val(),3!=e&&(t+=",")}),fields+=a+"="+t+"&"}),fields=fields.substring(0,fields.lastIndexOf("&"));var $form=$(form),$callback=navTabAjaxDone;return $.isFunction($callback)||($callback=eval("("+callback+")")),$.ajax({type:"POST",url:$form.attr("action"),data:fields,dataType:"json",cache:!1,success:$callback,error:DWZ.ajaxError}),!1}function all_select(e,t,a){if($checkbox=$(e),"table"==a)var l=$checkbox.parent().parent().index();else var l=$checkbox.parent().index();var r=$checkbox.attr("checked"),i=!1;if("checked"==r&&(i=!0),"table"==a){var n=$checkbox.parents(".grid");n.find(".gridScroller .gridTbody tr").each(function(e){$(this).children().eq(l).children().children().attr("checked",i)})}else $("#"+t+" tr").each(function(e){$(this).children().eq(l).children().attr("checked",i)})}function all_selectquickSearch(e,t){$checkbox=$(e);var a=$.pdialog.getCurrent();a.find("input."+t).attr("checked",$checkbox.is(":checked"))}function to_dynamic(e){var t=$("#node").val();"all"==t&&(alertMsg.warn("请选择要配置的节点！"),$(e).attr("rel","Dynamicconf"),$(e).attr("href",TP_ACTION),$(e).attr("title","动态配置")),$(e).attr("href",$(e).attr("href")+"/table/"+t)}function addDomainItem(){var e=TP_APP+"/Public/getDomain";$.getJSON(e,function(e){if(null!=e){for(var t=new Array,a=new Array,l=0;l<e.length;l++)t[l]=e[l].name,a[l]=e[l].referfield;var r=$("#fifter .unit label");for(j=0;j<r.length;j++)for(l=0;l<e.length;l++)r.eq(j).attr("field")==a[l]&&(delete t[l],delete a[l]);var i="<div id='selFifterItem' class='unit'><label>";i+="<select onchange='getNewDomainItem(this);'><option value=''>请选择</option>";for(index in t)i+="<option value='"+a[index]+"'>"+t[index]+"</option>";i+="</select></label></div>",$("#fifter").append(i)}})}function getNewDomainItem(e){var t=$(e).find("option:selected"),a=TP_APP+"/Public/new_domain",l={field:t.val(),type:t.attr("type"),showname:t.text()};$.get(a,l,function(e){$("#selFifterItem").remove(),$("#fifter").append(e)})}function start_to_resume(){for(var e="",t=document.getElementsByName("resume_type"),a=0;a<t.length;a++)$(t[a]).attr("checked")&&(t=t[a].value);if("part"==t){for(var l=document.getElementsByName("table"),r=new Array,a=0;a<l.length;a++)$(l[a]).attr("checked")&&r.push(l[a].value);e=r.join(",")}var i=$("#file").val();$("#resume_notic").html("正在还原，请耐心等候 ..."),$.post(TP_APP+"/Resume/start_resume",{tables:e,type:t,file:i,folder:encodeURIComponent($("#folder").val())},function(e){$("#resume_notic").html(e)})}function resume_part(){$("#part_tables").fadeIn("fast")}function showSelect(e,t){var a=TP_APP+"/Resume/show/filename/"+e+"/folder/"+encodeURIComponent(t);$.pdialog.open(a,"resumeDB","还原数据库",{minable:!0,width:500,height:400,mask:!0,resizable:!1})}function start_to_backup(){for(var e=document.getElementsByName("backup_tables"),t=document.getElementsByName("backup_type"),a=$("#remark").val(),l=$("#folder").val(),r=$("#sizelimit").val(),i=0;i<e.length;i++)$(e[i]).attr("checked")&&(e=e[i].value);for(var i=0;i<t.length;i++)$(t[i]).attr("checked")&&(t=t[i].value);if("part"==e){for(var n=document.getElementsByName("table"),s=new Array,i=0;i<n.length;i++)$(n[i]).attr("checked")&&s.push(n[i].value);e=s.join(",")}$("#backup_notic").html("正在备份，请耐心等候 ..."),$.post(TP_APP+"/Backup/start_backup",{tables:e,type:t,remark:a,folder:l,sizelimit:r},function(e){$("#backup_notic").html(e)})}function backup_part(){$("#part_tables").fadeIn("fast"),""==$("#tables").html()&&$.post(TP_APP+"/Backup/show_tables",function(e){e=$.parseJSON(e);for(var t="",a=0;a<e.length;a++)t+="<label style='width:300px;'><input name='table' type='checkbox' value='"+e[a]+"' />"+e[a]+"</label>";$("#tables").html(t)})}function hide_tables(){$("#part_tables").fadeOut("fast")}function highlight(e){$(e).css("background","#ccc")}function unhighlight(e){$(e).css("background","#fff")}function showAddress(){var e=TP_APP+"/Email/show";$.pdialog.open(e,"showAddress","选择用户邮址",{minable:!0,width:500,height:400,mask:!0,resizable:!1})}function batchAddEmail(){if("none"==$("#notic").css("display")){for(var e=document.getElementsByName("one_email"),t=new Array,a=0;a<e.length;a++)$(e[a]).attr("checked")&&t.push(e[a].value);var l=$("#addresses").val();if(""!=l){for(var r=0,i="",n=document.getElementsByName("select_tmp"),a=0;a<n.length;a++)if($(n[a]).attr("checked")){n=n[a];break}l=l.split(",");for(var s=0;s<t.length;s++){var d=t[s]+"#"+n.value;isIn(d,l)||-1!=d.indexOf(":#")||(l.push(d),r++,i+="<p onmouseover='highlight(this);' onmouseout='unhighlight(this);'><label style='color:green;'>"+n.title+" "+t[s]+"</label>",i+="<a href='#close' onclick='del_current_email(this);' class='close'>close</a></p>")}}else l=t;var o=$("#all_address").html();$("#all_address").html(o+i),$("#notic").html("此次共添加了"+r+"条不重复邮址").fadeIn().delay(1500).fadeOut(),$("#addresses").val(l.join(",")),$.pdialog.close("showAddress")}}function isIn(e,t){for(var a=0;a<t.length;a++)if(e==t[a])return!0;return!1}function addEmail(){if("none"==$("#notic").css("display")){var e=$.trim($("#address").val());if(isEmail(e)){for(var t=document.getElementsByName("select_tmp"),a=0;a<t.length;a++)if($(t[a]).attr("checked")){t=t[a];break}var l=$("#addresses").val();if(""!=l){l=l.split(",");for(var r=l.length,a=0;r>a;a++)if(e+"#"+t.value==l[a])return void $("#notic").html("此模板下的Email地址已经存在。").fadeIn().delay(800).fadeOut()}else l=[];l.push(e+"#"+t.value),$("#addresses").val(l.join(","));var i=$("#all_address").html();i+="<p onmouseover='highlight(this);' onmouseout='unhighlight(this);'><label title='"+e+"#"+t.value+"' style='color:green;'>"+t.title+" "+e+"</label>",i+="<a href='#close' onclick='del_current_email(this);' class='close'>close</a></p>",$("#all_address").html(i)}else $("#notic").html("这不是有效的Email地址。").fadeIn().delay(800).fadeOut()}}function del_current_email(e){$close=$(e);var t=$close.parent();t.remove();for(var a=$("#addresses").val().split(","),l=a.length,r=t.children("label:eq(0)").attr("title"),i=0;l>i;i++)if(r==a[i]){a.splice(i,1);break}$("#addresses").val(a.join(","))}function isEmail(e){var t=/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;return t.test(e)}function confirmSearch(e){return""==e?!1:("none"!=$("#relate_tables").css("display")&&($("#relate_tables").css("display","none"),$("#tables tbody").html("")),void $.getJSON(TP_APP+"/Search/confirmSearch?view="+e,function(e){if(e){for(var t,a,l,r,i,n="",s=0,d=e.length;d>s;s++)t=e[s].name,a=e[s].showname,l=e[s].findtype,r=e[s].findtable,i=e[s].findfield,"undefined"==typeof t&&(t=""),"undefined"==typeof a&&(a=""),"undefined"==typeof l&&(l=""),"undefined"==typeof r&&(r=""),"undefined"==typeof i&&(i=""),n+="<tr><td><input type='text' value='"+t+"' class='required textInput' /></td>",n+="<td><input type='text' value='"+a+"' class='required textInput' /></td>",n+="<td><input style='width:50px;' type='text' value='"+l+"' class='required textInput' /></td>",n+='<td><input style="width:120px;" type="text" class="required checkByInput" checkfor="Exnt_Tables" insert="TABLE_NAME" show="TABLE_NAME" value="'+r+'" callback="searchchangetable" /></td>',n+='<td><input name="search_tablesname" type="text" class="required checkByInput" map="array(\'table_name\'=>'+r+');" checkfor="Exnt_Table_column" insert="COLUMN_NAME" show="COLUMN_NAME" value="'+i+'"  /></td>',n+="<td><a href='#close' onclick='removeSearchField(this);' class='close'>close</a></td></tr>";$("#search_table tbody").html(n),$("#search_error").hide(),$("#search_fields").show()}else $("#search_fields").hide(),$("#search_error").show()}))}function addSearchField(){var e="<tr><td><input type='text' class='required textInput' /></td>";e+="<td><input type='text' class='required textInput' /></td>",e+="<td><input style='width:50px;' type='text' class='required textInput' /></td>",e+='<td><input style="width:120px;" type="text" class="required checkByInput xytdinput" checkfor="Exnt_Tables" insert="TABLE_NAME" show="TABLE_NAME" value="" callback="searchchangetable" /></td>',e+='<td><input name="search_tablesname" type="text" class="required checkByInput xytdinput" map="" checkfor="Exnt_Table_column" insert="COLUMN_NAME" show="COLUMN_NAME" /></td>',e+="<td><a href='#close' onclick='removeSearchField(this);' class='close'>close</a></td></tr>",$("#search_table tbody").append(e)}function removeSearchField(e){$(e).parent().parent().remove()}function AllStarWrited(){if(""==$("#search_fields tbody").html())return alert("请确定第一步中有信息可以分配"),!1;for(var e=$("#search_fields input"),t=0,a=e.length;a>t;t++)if(""==$.trim(e[t].value))return alert("请填写第一步中所有带 * 的文本框"),!1;return!0}function confirmTables(e){if(!AllStarWrited())return!1;$("input[name=sortjson]").val("");for(var t,a,l,r=[],i=[],n=[],s="",d=1,o=$("#search_table tbody tr"),c=[],f=0,h=o.length;h>f;f++){if(a=o[f].cells[0].firstChild.value,c.push({key:a,val:o[f].cells[1].firstChild.value}),t=o[f].cells[3].firstChild.value,0==f&&(l=t),isIn(t,r))for(var u=0;u<r.length;u++)t==r[u]&&(i[u]=i[u]+1,i[u]>d&&(d=i[u],l=r[u]));else r.push(t),i.push(1),n.push({table:t,show:a,select:o[f].cells[4].firstChild.value});$("#maintable").val(l),$("#maintable2").html(l)}var p=r.join(","),v="";if("object"==typeof e)for(var b in e)isNaN(b)&&(v+='<li><p style="display:none">'+b+":"+e[e[b]]+"</p><div><font>"+e[e[b]]+"</font></div></li>");else for(var f=0,h=c.length;h>f;f++)v+='<li><p style="display:none">'+c[f].key+":"+c[f].val+"</p><div><font>"+c[f].val+"</font></div></li>";$("#searchList").html(v);var m=function(){var e=$("#searchList li").map(function(){return $(this).children().html()}).get();$("input[name=sortjson]").val(e.join(","))};$("#searchList, #searchList2").dragsort({dragSelector:"div",dragBetween:!0,dragEnd:m,placeHolderTemplate:"<li class='placeHolder'><div></div></li>"}),e||$.get(TP_APP+"/Search/getFields/tables/"+p,function(e){if(e=$.parseJSON(e),0!==e.data){if(r.length>1){for(var t,a,i,d,o=e,c=[],f=0,h=o.length;h>f;f++){t=o[f],c[f]="<select>";for(var u=0,p=t.length;p>u;u++)c[f]+="<option value='"+t[u]+"' ",n[f].table==l?(d=f,n[f+1]&&n[f+1].show==t[u]&&(c[f]+="selected")):t[u]==n[f].select&&(c[f]+="selected"),c[f]+=">"+t[u]+"</option>";if(c[f]+="</select>",f>1){var v=f+o.length;c[v]=c[d].replace(/selected/,"").replace(new RegExp("(value='"+n[f].show+"')"),"$1 selected")}}for(var b=0,m=r.length;m>b;b++){r[b]==l&&(i=b),s+="<tr><td><input style='width:150px;' onclick='confirmMainTable(this);' type='button' value='"+r[b]+"'></td>",s+="<td>"+c[b]+"</td>",s+="<td><select onchange='changeReTable(this);' >";for(var y=0;m>y;y++)y!=b&&(s+="<option value='"+r[y]+"'>"+r[y]+"</option>");s+="</select></td>",a=b>1?b+r.length:0==b?1:0,s+="<td>"+c[a]+"</td></tr>"}$("#tables tbody").html(s);var g=$("#tables tbody tr").eq(i);g.find("input").attr("disabled","disabled"),g.find("select").attr("disabled","disabled"),$("#oneTable").css("display","none"),$("#tables").css("display","")}else $("#oneTable").css("display",""),$("#tables").css("display","none");$("#relate_tables").css("display","")}else navTabAjaxDone(e),"none"!=$("#relate_tables").css("display")&&($("#relate_tables").css("display","none"),$("#tables tbody").html(""))})}function confirmMainTable(e){$("#relate_tables input").removeAttr("disabled"),$("#relate_tables select").removeAttr("disabled");var t=$(e).parent().parent();t.find("input").attr("disabled","disabled"),t.find("select").attr("disabled","disabled"),$("#maintable2").text(e.value),$("#maintable").val(e.value)}function dwzPageBreak(e){var t=$.extend({targetType:"navTab",rel:"",data:{pageNum:"",numPerPage:"",orderField:"",orderDirection:""},callback:null},e),a="dialog"==t.targetType?$.pdialog.getCurrent():navTab.getCurrentPanel();if(t.rel){e.data.realnavTab&&e.data.refreshtabs&&(a=navTab._getPanels().eq(navTab._currentIndex-1));var l=a.find("#"+t.rel);e.data.refreshtabsbyid&&(l=$("#"+t.rel));var r=_getPagerForm(l,t.data);if(r){if($("#search_form2").length>0)var i="<div id='search_form2' style='display:none;'>"+$("#search_form2").html()+"</div>";l.loadUrl($(r).attr("action"),$(r).serializeArray(),function(){l.find("[layoutH]").layoutH(),null!=i&&$(i).appendTo(l.find("#pagerForm"))})}}else{var r=_getPagerForm(a,t.data),n=$(r).serializeArray();"dialog"==t.targetType?r&&$.pdialog.reload($(r).attr("action"),{data:n,callback:t.callback}):r&&navTab.reload($(r).attr("action"),{data:n,callback:t.callback})}}function changeReTable(e){var t=$("#tables input[value='"+e.value+"']"),a=$(t).parent().next().html(),l=$(e).parent().next();l.html(a),l.children().removeAttr("disabled")}function searchSave(form,callback){var $form=$(form);if(!AllStarWrited()||!$form.valid())return!1;for(var trs=$("#search_table tbody tr"),fields="",showfield,table,relatetables="",i=0,len=trs.length;len>i;i++)showfield=trs[i].cells[0].firstChild.value,table=trs[i].cells[3].firstChild.value,fields+=showfield+"-"+trs[i].cells[1].firstChild.value,fields+="-"+trs[i].cells[2].firstChild.value,fields+="-"+table+"-"+trs[i].cells[4].firstChild.value+";;";$("#fields").val(fields),trs=$("#relate_tables tbody tr");for(var i=0,len=trs.length;len>i;i++)for(var j=0;4>j;j++){var input=trs[i].cells[j].firstChild;if("disabled"===$(input).attr("disabled"))break;relatetables+=input.value,relatetables+=3>j?"-":";"}$("#relatetables").val(relatetables);var $callback=callback||DWZ.ajaxDone;return $.isFunction($callback)||($callback=eval("("+callback+")")),$.ajax({type:form.method||"POST",url:$form.attr("action"),data:$form.serializeArray(),dataType:"json",cache:!1,success:function(e){var t=DWZ.jsonEval(e);""!=t.checkfield&&$form.find("input[name='"+t.checkfield+"']").val(t.data),$callback(e)},error:DWZ.ajaxError}),!1}function searchSubmit(e){var t=navTab.getCurrentPanel(),a=t.find("#pagerForm:visible"),l=$(".dialogContent:visible");if(l.length>1)l.each(function(e){var l=$(this);return 0==l.find("#search_form").length?(a=l.find("#pagerForm:visible"),t=a.parents("div.dialogContent:first"),!1):void 0});else{t=a.parent();var r=t.find("div.treeleft");r.length>0&&(t=t.find("div.treeleft").next())}for(var i=t.find("#search_form2"),n=$("#search_form").serializeArray(),s="",d=0,o=n.length;o>d;d++)s+="<input type='hidden' name='"+n[d].name+"' value='"+n[d].value+"' />";var c="<div id='search_form2' style='display:none;'>"+s+"</div>";return i.length>0?i.html(s):$(c).appendTo(a),t.ajaxUrl({type:"POST",url:a.attr("action"),data:a.serializeArray(),callback:function(){t.find("[layoutH]").layoutH(),$(c).appendTo(t.find("#pagerForm"))}}),$.pdialog.close($.pdialog.getCurrent()),!1}function searchSubmit2(e){for(var t=$(".dialog:visible").last().prev().find("#pagerForm"),a=$("#fifter2").parent().serializeArray(),l="",r=0,i=a.length;i>r;r++)l+="<input type='hidden' name='"+a[r].name+"' value='"+a[r].value+"' />";var n="<div id='search_form3' style='display:none;'>"+l+"</div>";$("#search_form3").length>0?$("#search_form3").html(l):$(n).appendTo(t);var s=t.parent();return s.ajaxUrl({type:"POST",url:t.attr("action"),data:t.serializeArray(),callback:function(){s.find("[layoutH]").layoutH(),$(n).appendTo(s.find("#pagerForm"))}}),!1}$(function(){$("td[field]").live("mousedown",function(e){if(3==e.which){var t="navTabFIFTER",a="fifterDiv",l="fifterTd",r="";$(this).parents("#lookup").length>0&&(t+="2",a+="2",l+="2",r="/searchtype/2");var i={};i[l]=function(e){var t=e.attr("field"),l=e.parents(".grid").find("thead").attr("ename"),i=TP_APP+"/Search/singlesearch/field/"+t+"/model/"+l+r;$.pdialog.open(i,a,"查找记录",{minable:!1,maxable:!1,width:570,height:150,mask:!0,resizable:!1,mask:!0})},$(this).contextMenu(t,{bindings:i,ctrSub:function(e,t){t.find("[rel='"+l+"']")}})}})});var xy={appPosition:function(e,t){if(e.length>0){var a=0,l=0,r=0,i=0,n=e[0].style,s=$("body").width();i=t.left,r=t.top+80,a=e.children("ul").children("li").length,l=a>5?192:96,a=Math.min(108*a,570),a>s&&(a=s),a+i>s&&(i-=Math.min(a-108,i)),n.width=a+"px",n.height=l+"px",n.left=i+"px",n.top=r+"px"}},startMenuPosition:function(e,t){if(e.length>0){var a=0,l=-1,r=32,i=e[0].style,n=$(window).height();a=e.children("li").length,a*=r,a+t.top>n&&(l-=Math.min(a-r,Math.floor(t.top/r)*r),i.top=l+"px")}},changeTab:function(e,t){t=t||window.event,t.preventDefault?t.preventDefault():t.returnValue=!1;var a=e.href.split("#")[1],l=$(e).parents(".xyTab"),r=l.find(".xyTabList"),i=l.find(".xyTabContent");r.filter(".xyTabListCu").removeClass("xyTabListCu").end().eq(a).addClass("xyTabListCu"),i.filter(".xyTabContentCu").removeClass("xyTabContentCu").end().eq(a).addClass("xyTabContentCu")},showNext:function(e){$(e).next().show()},hideNext:function(e){$(e).next().hide()}};!function(e){function t(){if(a)return a;var t=e('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div></div>');e("body").append(t);var l=e("div",t).innerWidth();t.css("overflow-y","auto");var r=e("div",t).innerWidth();return e(t).remove(),a=l-r}var a=0;e.fn.tableScroll=function(a){if("undo"==a){var l=e(this).parent().parent();return l.find(".tablescroll_head thead").prependTo(this),l.find(".tablescroll_foot tfoot").appendTo(this),l.before(this),void l.empty()}var r=e.extend({},e.fn.tableScroll.defaults,a);return r.scrollbarWidth=t(),this.each(function(){var t=r.flush,a=e(this).addClass("tablescroll_body"),l=e('<div class="tablescroll_wrapper"></div>').insertBefore(a).append(a);l.parent("div").hasClass(r.containerClass)||e("<div></div>").addClass(r.containerClass).insertBefore(l).append(l);var i=r.width?r.width:a.outerWidth();l.css({width:i+"px",height:r.height+"px","overflow-y":"auto","overflow-x":"hidden"}),a.css("width",i+"px");var n=l.outerWidth(),s=n-i;l.css({width:i-s+r.scrollbarWidth+"px"}),a.css("width",i-s+"px"),a.outerHeight()<=r.height&&(l.css({height:"auto",width:i-s+"px"}),t=!1);var d=e("thead",a).length?!0:!1,o=e("tfoot",a).length?!0:!1,c=e("thead tr:first",a),f=e("tbody tr:first",a),h=e("tfoot tr:first",a),u=0;if(e("th, td",c).each(function(t){u=e(this).width(),e("th:eq("+t+"), td:eq("+t+")",c).css("width",u+"px"),e("th:eq("+t+"), td:eq("+t+")",f).css("width",u+"px"),o&&e("th:eq("+t+"), td:eq("+t+")",h).css("width",u+"px")}),d)var p=e('<table class="tablescroll_head" cellspacing="0"></table>').insertBefore(l).prepend(e("thead",a));if(o)var v=e('<table class="tablescroll_foot" cellspacing="0"></table>').insertAfter(l).prepend(e("tfoot",a));void 0!=p&&(p.css("width",i+"px"),t&&(e("tr:first th:last, tr:first td:last",p).css("width",u+r.scrollbarWidth+"px"),p.css("width",l.outerWidth()+"px"))),void 0!=v&&(v.css("width",i+"px"),t&&(e("tr:first th:last, tr:first td:last",v).css("width",u+r.scrollbarWidth+"px"),v.css("width",l.outerWidth()+"px")))}),this},e.fn.tableScroll.defaults={flush:!0,width:null,height:100,containerClass:"tablescroll"},e.fn.selectButton=function(e){return this.each(function(){var t=jQuery,a=t(this),l=a.attr("multiple");a.hide();var r=t('<div class="selectButton"></div>'),i=0,n=function(l){l.attr("label")&&r.append("<strong>"+l.attr("label")+"</strong>");var n=t('<ul class="select-buttons">');l.children("option").each(function(){var r=t("<li></li>");l.children("option").length>1?0==i?r.addClass("first"):i==l.children("option").length-1&&r.addClass("last"):r.addClass("only"),t(this).attr("disabled")||a.attr("disabled")?(r.addClass("disabled"),r.append("<span>"+t(this).html()+"</span>")):r.append('<a href="#" data-select-index="'+i+'">'+t(this).html()+"</a>"),e&&e.noDefault||!t(this).attr("selected")||r.children("a, span").addClass("selected"),n.append(r),i++}),r.append(n)},s=a.children("optgroup");0==s.length?n(a):s.each(function(){n(t(this))}),a.after(r),r.find("a").click(function(e){if(e.preventDefault(),t(this).hasClass("selected"))return!1;var i=t(a.find("option")[t(this).attr("data-select-index")]);l?i.attr("selected")?(t(this).removeClass("selected"),i.removeAttr("selected")):(t(this).addClass("selected"),i.attr("selected","selected")):(r.find("a, span").removeClass("selected"),t(this).addClass("selected"),i.siblings().removeAttr("selected").end().attr("selected","selected")),a.trigger("change")})})}}(jQuery);