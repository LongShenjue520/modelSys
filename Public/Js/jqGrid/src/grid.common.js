!function(e){e.extend(e.jgrid,{showModal:function(e){e.w.show()},closeModal:function(e){e.w.hide().attr("aria-hidden","true"),e.o&&e.o.remove()},hideModal:function(t,i){if(i=e.extend({jqm:!0,gb:""},i||{}),i.onClose){var a=i.onClose(t);if("boolean"==typeof a&&!a)return}if(e.fn.jqm&&i.jqm===!0)e(t).attr("aria-hidden","true").jqmHide();else{if(""!==i.gb)try{e(".jqgrid-overlay:first",i.gb).hide()}catch(o){}e(t).hide().attr("aria-hidden","true")}},findPos:function(e){var t=0,i=0;if(e.offsetParent)do t+=e.offsetLeft,i+=e.offsetTop;while(e=e.offsetParent);return[t,i]},createModal:function(t,i,a,o,n,r,d){var l,s=document.createElement("div"),u=this;d=e.extend({},d||{}),l="rtl"==e(a.gbox).attr("dir")?!0:!1,s.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog",s.id=t.themodal;var c=document.createElement("div");c.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix",c.id=t.modalhead,e(c).append("<span class='ui-jqdialog-title'>"+a.caption+"</span>");var f=e("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){f.addClass("ui-state-hover")},function(){f.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick'></span>");e(c).append(f),l?(s.dir="rtl",e(".ui-jqdialog-title",c).css("float","right"),e(".ui-jqdialog-titlebar-close",c).css("left","0.3em")):(s.dir="ltr",e(".ui-jqdialog-title",c).css("float","left"),e(".ui-jqdialog-titlebar-close",c).css("right","0.3em"));var m=document.createElement("div");e(m).addClass("ui-jqdialog-content ui-widget-content").attr("id",t.modalcontent),e(m).append(i),s.appendChild(m),e(s).prepend(c),r===!0?e("body").append(s):"string"==typeof r?e(r).append(s):e(s).insertBefore(o),e(s).css(d),"undefined"==typeof a.jqModal&&(a.jqModal=!0);var h={};if(e.fn.jqm&&a.jqModal===!0){if(0===a.left&&0===a.top&&a.overlay){var p=[];p=this.findPos(n),a.left=p[0]+4,a.top=p[1]+4}h.top=a.top+"px",h.left=a.left}else(0!==a.left||0!==a.top)&&(h.left=a.left,h.top=a.top+"px");if(e("a.ui-jqdialog-titlebar-close",c).click(function(){var i=e("#"+e.jgrid.jqID(t.themodal)).data("onClose")||a.onClose,o=e("#"+e.jgrid.jqID(t.themodal)).data("gbox")||a.gbox;return u.hideModal("#"+e.jgrid.jqID(t.themodal),{gb:o,jqm:a.jqModal,onClose:i}),!1}),0!==a.width&&a.width||(a.width=300),0!==a.height&&a.height||(a.height=200),!a.zIndex){var g=e(o).parents("*[role=dialog]").filter(":first").css("z-index");g?a.zIndex=parseInt(g,10)+2:a.zIndex=950}var F=0;if(l&&h.left&&!r&&(F=e(a.gbox).width()-(isNaN(a.width)?0:parseInt(a.width,10))-8,h.left=parseInt(h.left,10)+parseInt(F,10)),h.left&&(h.left+="px"),e(s).css(e.extend({width:isNaN(a.width)?"auto":a.width+"px",height:isNaN(a.height)?"auto":a.height+"px",zIndex:a.zIndex,overflow:"hidden"},h)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":t.modalhead,"aria-hidden":"true"}),"undefined"==typeof a.drag&&(a.drag=!0),"undefined"==typeof a.resize&&(a.resize=!0),a.drag)if(e(c).css("cursor","move"),e.fn.jqDrag)e(s).jqDrag(c);else try{e(s).draggable({handle:e("#"+e.jgrid.jqID(c.id))})}catch(v){}if(a.resize)if(e.fn.jqResize)e(s).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'></div>"),e("#"+e.jgrid.jqID(t.themodal)).jqResize(".jqResize",t.scrollelm?"#"+e.jgrid.jqID(t.scrollelm):!1);else try{e(s).resizable({handles:"se, sw",alsoResize:t.scrollelm?"#"+e.jgrid.jqID(t.scrollelm):!1})}catch(x){}a.closeOnEscape===!0&&e(s).keydown(function(i){if(27==i.which){var o=e("#"+e.jgrid.jqID(t.themodal)).data("onClose")||a.onClose;u.hideModal(this,{gb:a.gbox,jqm:a.jqModal,onClose:o})}})},viewModal:function(t,i){if(i=e.extend({toTop:!0,overlay:10,modal:!1,overlayClass:"ui-widget-overlay",onShow:this.showModal,onHide:this.closeModal,gbox:"",jqm:!0,jqM:!0},i||{}),e.fn.jqm&&i.jqm===!0)i.jqM?e(t).attr("aria-hidden","false").jqm(i).jqmShow():e(t).attr("aria-hidden","false").jqmShow();else{""!==i.gbox&&(e(".jqgrid-overlay:first",i.gbox).show(),e(t).data("gbox",i.gbox)),e(t).show().attr("aria-hidden","false");try{e(":input:visible",t)[0].focus()}catch(a){}}},info_dialog:function(t,i,a,o){var n={width:290,height:"auto",dataheight:"auto",drag:!0,resize:!1,caption:"<b>"+t+"</b>",left:250,top:170,zIndex:1e3,jqModal:!0,modal:!1,closeOnEscape:!0,align:"center",buttonalign:"center",buttons:[]};e.extend(n,o||{});var r=n.jqModal,d=this;e.fn.jqm&&!r&&(r=!1);var l="";if(n.buttons.length>0)for(var s=0;s<n.buttons.length;s++)"undefined"==typeof n.buttons[s].id&&(n.buttons[s].id="info_button_"+s),l+="<a href='javascript:void(0)' id='"+n.buttons[s].id+"' class='fm-button ui-state-default ui-corner-all'>"+n.buttons[s].text+"</a>";var u=isNaN(n.dataheight)?n.dataheight:n.dataheight+"px",c="text-align:"+n.align+";",f="<div id='info_id'>";f+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+u+";"+c+"'>"+i+"</div>",f+=a?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+n.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+a+"</a>"+l+"</div>":""!==l?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+n.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+l+"</div>":"",f+="</div>";try{"false"==e("#info_dialog").attr("aria-hidden")&&this.hideModal("#info_dialog",{jqm:r}),e("#info_dialog").remove()}catch(m){}this.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},f,n,"","",!0),l&&e.each(n.buttons,function(t){e("#"+e.jgrid.jqID(this.id),"#info_id").bind("click",function(){return n.buttons[t].onClick.call(e("#info_dialog")),!1})}),e("#closedialog","#info_id").click(function(){return d.hideModal("#info_dialog",{jqm:r}),!1}),e(".fm-button","#info_dialog").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}),e.isFunction(n.beforeOpen)&&n.beforeOpen(),this.viewModal("#info_dialog",{onHide:function(e){e.w.hide().remove(),e.o&&e.o.remove()},modal:n.modal,jqm:r}),e.isFunction(n.afterOpen)&&n.afterOpen();try{e("#info_dialog").focus()}catch(h){}},createEl:function(t,i,a,o,n){function r(t,i){return e.isFunction(i.dataInit)&&i.dataInit.call(s,t),i.dataEvents&&e.each(i.dataEvents,function(){void 0!==this.data?e(t).bind(this.type,this.data,this.fn):e(t).bind(this.type,this.fn)}),i}function d(t,i,a){var o=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr"];"undefined"!=typeof a&&e.isArray(a)&&e.merge(o,a),e.each(i,function(i,a){-1===e.inArray(i,o)&&e(t).attr(i,a)}),i.hasOwnProperty("id")||e(t).attr("id",e.jgrid.randId())}var l="",s=this;switch(t){case"textarea":l=document.createElement("textarea"),o?i.cols||e(l).css({width:"98%"}):i.cols||(i.cols=20),i.rows||(i.rows=2),("&nbsp;"==a||"&#160;"==a||1==a.length&&160==a.charCodeAt(0))&&(a=""),l.value=a,d(l,i),i=r(l,i),e(l).attr({role:"textbox",multiline:"true"});break;case"checkbox":if(l=document.createElement("input"),l.type="checkbox",i.value){var u=i.value.split(":");a===u[0]&&(l.checked=!0,l.defaultChecked=!0),l.value=u[0],e(l).attr("offval",u[1])}else{var c=a.toLowerCase();c.search(/(false|0|no|off|undefined)/i)<0&&""!==c?(l.checked=!0,l.defaultChecked=!0,l.value=a):l.value="on",e(l).attr("offval","off")}d(l,i,["value"]),i=r(l,i),e(l).attr("role","checkbox");break;case"select":l=document.createElement("select"),l.setAttribute("role","select");var f,m=[];if(i.multiple===!0?(f=!0,l.multiple="multiple",e(l).attr("aria-multiselectable","true")):f=!1,"undefined"!=typeof i.dataUrl)e.ajax(e.extend({url:i.dataUrl,type:"GET",dataType:"html",context:{elem:l,options:i,vl:a},success:function(t){var i,a=[],o=this.elem,n=this.vl,l=e.extend({},this.options),u=l.multiple===!0;if(e.isFunction(l.buildSelect)){var c=l.buildSelect.call(s,t);i=e(c).html()}else i=e(t).html();i&&(e(o).append(i),d(o,l),l=r(o,l),"undefined"==typeof l.size&&(l.size=u?3:1),u?(a=n.split(","),a=e.map(a,function(t){return e.trim(t)})):a[0]=e.trim(n),setTimeout(function(){e("option",o).each(function(t){0===t&&o.multiple&&(this.selected=!1),e(this).attr("role","option"),(e.inArray(e.trim(e(this).text()),a)>-1||e.inArray(e.trim(e(this).val()),a)>-1)&&(this.selected="selected")})},0))}},n||{}));else if(i.value){var h;"undefined"==typeof i.size&&(i.size=f?3:1),f&&(m=a.split(","),m=e.map(m,function(t){return e.trim(t)})),"function"==typeof i.value&&(i.value=i.value());var p,g,F,v=void 0===i.separator?":":i.separator,x=void 0===i.delimiter?";":i.delimiter;if("string"==typeof i.value)for(p=i.value.split(x),h=0;h<p.length;h++)g=p[h].split(v),g.length>2&&(g[1]=e.map(g,function(e,t){return t>0?e:void 0}).join(v)),F=document.createElement("option"),F.setAttribute("role","option"),F.value=g[0],F.innerHTML=g[1],l.appendChild(F),f||e.trim(g[0])!=e.trim(a)&&e.trim(g[1])!=e.trim(a)||(F.selected="selected"),f&&(e.inArray(e.trim(g[1]),m)>-1||e.inArray(e.trim(g[0]),m)>-1)&&(F.selected="selected");else if("object"==typeof i.value){var b=i.value;for(var j in b)b.hasOwnProperty(j)&&(F=document.createElement("option"),F.setAttribute("role","option"),F.value=j,F.innerHTML=b[j],l.appendChild(F),f||e.trim(j)!=e.trim(a)&&e.trim(b[j])!=e.trim(a)||(F.selected="selected"),f&&(e.inArray(e.trim(b[j]),m)>-1||e.inArray(e.trim(j),m)>-1)&&(F.selected="selected"))}d(l,i,["value"]),i=r(l,i)}break;case"text":case"password":case"button":var y;y="button"==t?"button":"textbox",l=document.createElement("input"),l.type=t,l.value=a,d(l,i),i=r(l,i),"button"!=t&&(o?i.size||e(l).css({width:"98%"}):i.size||(i.size=20)),e(l).attr("role",y);break;case"image":case"file":l=document.createElement("input"),l.type=t,d(l,i),i=r(l,i);break;case"custom":l=document.createElement("span");try{if(!e.isFunction(i.custom_element))throw"e1";var w=i.custom_element.call(s,a,i);if(!w)throw"e2";w=e(w).addClass("customelement").attr({id:i.id,name:i.name}),e(l).empty().append(w)}catch(q){"e1"==q&&this.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose),"e2"==q?this.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):this.info_dialog(e.jgrid.errors.errcap,"string"==typeof q?q:q.message,e.jgrid.edit.bClose)}}return l},checkDate:function(e,t){var i,a=function(e){return e%4!==0||e%100===0&&e%400!==0?28:29},o=function(e){for(var t=1;e>=t;t++)this[t]=31,(4==t||6==t||9==t||11==t)&&(this[t]=30),2==t&&(this[t]=29);return this},n={};if(e=e.toLowerCase(),i=-1!=e.indexOf("/")?"/":-1!=e.indexOf("-")?"-":-1!=e.indexOf(".")?".":"/",e=e.split(i),t=t.split(i),3!=t.length)return!1;for(var r,d=-1,l=-1,s=-1,u=0;u<e.length;u++){var c=isNaN(t[u])?0:parseInt(t[u],10);n[e[u]]=c,r=e[u],-1!=r.indexOf("y")&&(d=u),-1!=r.indexOf("m")&&(s=u),-1!=r.indexOf("d")&&(l=u)}r="y"==e[d]||"yyyy"==e[d]?4:"yy"==e[d]?2:-1;var f,m=o(12);return-1===d?!1:(f=n[e[d]].toString(),2==r&&1==f.length&&(r=1),f.length!=r||0===n[e[d]]&&"00"!=t[d]?!1:-1===s?!1:(f=n[e[s]].toString(),f.length<1||n[e[s]]<1||n[e[s]]>12?!1:-1===l?!1:(f=n[e[l]].toString(),f.length<1||n[e[l]]<1||n[e[l]]>31||2==n[e[s]]&&n[e[l]]>a(n[e[d]])||n[e[l]]>m[n[e[s]]]?!1:!0)))},isEmpty:function(e){return e.match(/^\s+$/)||""===e?!0:!1},checkTime:function(e){var t,i=/^(\d{1,2}):(\d{2})([ap]m)?$/;if(!this.isEmpty(e)){if(t=e.match(i),!t)return!1;if(t[3]){if(t[1]<1||t[1]>12)return!1}else if(t[1]>23)return!1;if(t[2]>59)return!1}return!0},checkValues:function(t,i,a,o,n){var r,d,l,s,u;if("undefined"==typeof o)if("string"==typeof i){for(d=0,u=a.p.colModel.length;u>d;d++)if(a.p.colModel[d].name==i){r=a.p.colModel[d].editrules,i=d;try{l=a.p.colModel[d].formoptions.label}catch(c){}break}}else i>=0&&(r=a.p.colModel[i].editrules);else r=o,l=void 0===n?"_":n;if(r){if(l||(l=a.p.colNames[i]),r.required===!0&&this.isEmpty(t))return[!1,l+": "+e.jgrid.edit.msg.required,""];var f=r.required===!1?!1:!0;if(r.number===!0&&(f!==!1||!this.isEmpty(t))&&isNaN(t))return[!1,l+": "+e.jgrid.edit.msg.number,""];if("undefined"!=typeof r.minValue&&!isNaN(r.minValue)&&parseFloat(t)<parseFloat(r.minValue))return[!1,l+": "+e.jgrid.edit.msg.minValue+" "+r.minValue,""];if("undefined"!=typeof r.maxValue&&!isNaN(r.maxValue)&&parseFloat(t)>parseFloat(r.maxValue))return[!1,l+": "+e.jgrid.edit.msg.maxValue+" "+r.maxValue,""];var m;if(r.email===!0&&!(f===!1&&this.isEmpty(t)||(m=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,m.test(t))))return[!1,l+": "+e.jgrid.edit.msg.email,""];if(r.integer===!0&&(f!==!1||!this.isEmpty(t))){if(isNaN(t))return[!1,l+": "+e.jgrid.edit.msg.integer,""];if(t%1!==0||-1!=t.indexOf("."))return[!1,l+": "+e.jgrid.edit.msg.integer,""]}if(r.date===!0&&!(f===!1&&this.isEmpty(t)||(s=a.p.colModel[i].formatoptions&&a.p.colModel[i].formatoptions.newformat?a.p.colModel[i].formatoptions.newformat:a.p.colModel[i].datefmt||"Y-m-d",this.checkDate(s,t))))return[!1,l+": "+e.jgrid.edit.msg.date+" - "+s,""];if(r.time===!0&&!(f===!1&&this.isEmpty(t)||this.checkTime(t)))return[!1,l+": "+e.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];if(r.url===!0&&!(f===!1&&this.isEmpty(t)||(m=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i,m.test(t))))return[!1,l+": "+e.jgrid.edit.msg.url,""];if(r.custom===!0&&(f!==!1||!this.isEmpty(t))){if(e.isFunction(r.custom_func)){var h=r.custom_func.call(a,t,l);return e.isArray(h)?h:[!1,e.jgrid.edit.msg.customarray,""]}return[!1,e.jgrid.edit.msg.customfcheck,""]}}return[!0,"",""]}})}(jQuery);