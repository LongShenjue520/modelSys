!function(r){"use strict";r.jgrid.extend({groupingSetup:function(){return this.each(function(){var i=this,o=i.p.groupingView;if(null===o||"object"!=typeof o&&!r.isFunction(o))i.p.grouping=!1;else if(o.groupField.length){"undefined"==typeof o.visibiltyOnNextGrouping&&(o.visibiltyOnNextGrouping=[]);for(var t=0;t<o.groupField.length;t++)if(o.groupOrder[t]||(o.groupOrder[t]="asc"),o.groupText[t]||(o.groupText[t]="{0}"),"boolean"!=typeof o.groupColumnShow[t]&&(o.groupColumnShow[t]=!0),"boolean"!=typeof o.groupSummary[t]&&(o.groupSummary[t]=!1),o.groupColumnShow[t]===!0?(o.visibiltyOnNextGrouping[t]=!0,r(i).jqGrid("showCol",o.groupField[t])):(o.visibiltyOnNextGrouping[t]=r("#"+r.jgrid.jqID(i.p.id+"_"+o.groupField[t])).is(":visible"),r(i).jqGrid("hideCol",o.groupField[t])),o.sortitems[t]=[],o.sortnames[t]=[],o.summaryval[t]=[],o.groupSummary[t]){o.summary[t]=[];for(var e=i.p.colModel,n=0,s=e.length;s>n;n++)e[n].summaryType&&o.summary[t].push({nm:e[n].name,st:e[n].summaryType,v:""})}}else i.p.grouping=!1})},groupingPrepare:function(i,o,t,e){return this.each(function(){o[0]+="";var n=o[0].toString().split(" ").join(""),s=this.p.groupingView,u=this;t.hasOwnProperty(n)?t[n].push(i):(t[n]=[],t[n].push(i),s.sortitems[0].push(n),s.sortnames[0].push(r.trim(o[0].toString())),s.summaryval[0][n]=r.extend(!0,[],s.summary[0])),s.groupSummary[0]&&r.each(s.summaryval[0][n],function(){r.isFunction(this.st)?this.v=this.st.call(u,this.v,this.nm,e):this.v=r(u).jqGrid("groupingCalculations."+this.st,this.v,this.nm,e)})}),t},groupingToggle:function(i){return this.each(function(){var o=this,t=o.p.groupingView,e=i.lastIndexOf("_"),n=i.substring(0,e+1),s=parseInt(i.substring(e+1),10)+1,u=t.minusicon,p=t.plusicon,a=r("#"+r.jgrid.jqID(i)),g=a.length?a[0].nextSibling:null,l=r("#"+r.jgrid.jqID(i)+" span.tree-wrap-"+o.p.direction),d=!1;if(l.hasClass(u)){if(t.showSummaryOnHide&&t.groupSummary[0]){if(g)for(;g&&!r(g).hasClass("jqfoot");)r(g).hide(),g=g.nextSibling}else if(g)for(;g&&r(g).attr("id")!=n+String(s);)r(g).hide(),g=g.nextSibling;l.removeClass(u).addClass(p),d=!0}else{if(g)for(;g&&r(g).attr("id")!=n+String(s);)r(g).show(),g=g.nextSibling;l.removeClass(p).addClass(u)}r(o).triggerHandler("jqGridGroupingClickGroup",[i,d]),r.isFunction(o.p.onClickGroup)&&o.p.onClickGroup.call(o,i,d)}),!1},groupingRender:function(i,o){return this.each(function(){var t,e,n,s,u=this,p=u.p.groupingView,a="",g="",l=p.groupCollapse?p.plusicon:p.minusicon;for(p.groupDataSorted||(p.sortitems[0].sort(),p.sortnames[0].sort(),"desc"==p.groupOrder[0].toLowerCase()&&(p.sortitems[0].reverse(),p.sortnames[0].reverse())),l+=" tree-wrap-"+u.p.direction,s=0;o>s;){if(u.p.colModel[s].name==p.groupField[0]){n=s;break}s++}r.each(p.sortitems[0],function(s,d){t=u.p.id+"ghead_"+s,g="<span style='cursor:pointer;' class='ui-icon "+l+"' onclick=\"jQuery('#"+r.jgrid.jqID(u.p.id)+"').jqGrid('groupingToggle','"+t+"');return false;\"></span>";try{e=u.formatter(t,p.sortnames[0][s],n,p.sortitems[0])}catch(m){e=p.sortnames[0][s]}a+='<tr id="'+t+'" role="row" class= "ui-widget-content jqgroup ui-row-'+u.p.direction+'"><td colspan="'+o+'">'+g+r.jgrid.format(p.groupText[0],e,i[d].length)+"</td></tr>";for(var h=0;h<i[d].length;h++)a+=i[d][h].join("");if(p.groupSummary[0]){var c="";p.groupCollapse&&!p.showSummaryOnHide&&(c=' style="display:none;"'),a+="<tr"+c+' role="row" class="ui-widget-content jqfoot ui-row-'+u.p.direction+'">';for(var f,y=p.summaryval[0][d],v=u.p.colModel,j=i[d].length,w=0;o>w;w++){var C="<td "+u.formatCol(w,1,"")+">&#160;</td>",b="{0}";r.each(y,function(){if(this.nm==v[w].name){v[w].summaryTpl&&(b=v[w].summaryTpl),"avg"==this.st&&this.v&&j>0&&(this.v=this.v/j);try{f=u.formatter("",this.v,w,this)}catch(i){f=this.v}return C="<td "+u.formatCol(w,1,"")+">"+r.jgrid.format(b,f)+"</td>",!1}}),a+=C}a+="</tr>"}}),r("#"+r.jgrid.jqID(u.p.id)+" tbody:first").append(a),a=null})},groupingGroupBy:function(i,o){return this.each(function(){var t=this;"string"==typeof i&&(i=[i]);var e=t.p.groupingView;t.p.grouping=!0,"undefined"==typeof e.visibiltyOnNextGrouping&&(e.visibiltyOnNextGrouping=[]);var n;for(n=0;n<e.groupField.length;n++)!e.groupColumnShow[n]&&e.visibiltyOnNextGrouping[n]&&r(t).jqGrid("showCol",e.groupField[n]);for(n=0;n<i.length;n++)e.visibiltyOnNextGrouping[n]=r("#"+r.jgrid.jqID(t.p.id)+"_"+r.jgrid.jqID(i[n])).is(":visible");t.p.groupingView=r.extend(t.p.groupingView,o||{}),e.groupField=i,r(t).trigger("reloadGrid")})},groupingRemove:function(i){return this.each(function(){var o=this;if("undefined"==typeof i&&(i=!0),o.p.grouping=!1,i===!0){for(var t=o.p.groupingView,e=0;e<t.groupField.length;e++)!t.groupColumnShow[e]&&t.visibiltyOnNextGrouping[e]&&r(o).jqGrid("showCol",t.groupField);r("tr.jqgroup, tr.jqfoot","#"+r.jgrid.jqID(o.p.id)+" tbody:first").remove(),r("tr.jqgrow:hidden","#"+r.jgrid.jqID(o.p.id)+" tbody:first").show()}else r(o).trigger("reloadGrid")})},groupingCalculations:{sum:function(r,i,o){return parseFloat(r||0)+parseFloat(o[i]||0)},min:function(r,i,o){return""===r?parseFloat(o[i]||0):Math.min(parseFloat(r),parseFloat(o[i]||0))},max:function(r,i,o){return""===r?parseFloat(o[i]||0):Math.max(parseFloat(r),parseFloat(o[i]||0))},count:function(r,i,o){return""===r&&(r=0),o.hasOwnProperty(i)?r+1:0},avg:function(r,i,o){return parseFloat(r||0)+parseFloat(o[i]||0)}}})}(jQuery);