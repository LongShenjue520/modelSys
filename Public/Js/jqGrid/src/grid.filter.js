!function(t){t.fn.jqFilter=function(e){if("string"==typeof e){var r=t.fn.jqFilter[e];if(!r)throw"jqFilter - No such method: "+e;var n=t.makeArray(arguments).slice(1);return r.apply(this,n)}var s=t.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[{name:"eq",description:"equal",operator:"="},{name:"ne",description:"not equal",operator:"<>"},{name:"lt",description:"less",operator:"<"},{name:"le",description:"less or equal",operator:"<="},{name:"gt",description:"greater",operator:">"},{name:"ge",description:"greater or equal",operator:">="},{name:"bw",description:"begins with",operator:"LIKE"},{name:"bn",description:"does not begin with",operator:"NOT LIKE"},{name:"in",description:"in",operator:"IN"},{name:"ni",description:"not in",operator:"NOT IN"},{name:"ew",description:"ends with",operator:"LIKE"},{name:"en",description:"does not end with",operator:"NOT LIKE"},{name:"cn",description:"contains",operator:"LIKE"},{name:"nc",description:"does not contain",operator:"NOT LIKE"},{name:"nu",description:"is null",operator:"IS NULL"},{name:"nn",description:"is not null",operator:"IS NOT NULL"}],numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],_gridsopt:[],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},t.jgrid.filter,e||{});return this.each(function(){if(!this.filter){this.p=s,(null===this.p.filter||void 0===this.p.filter)&&(this.p.filter={groupOp:this.p.groupOps[0].op,rules:[],groups:[]});var e,r,n=this.p.columns.length,o=/msie/i.test(navigator.userAgent)&&!window.opera;if(this.p._gridsopt.length)for(e=0;e<this.p._gridsopt.length;e++)this.p.ops[e].description=this.p._gridsopt[e];if(this.p.initFilter=t.extend(!0,{},this.p.filter),n){for(e=0;n>e;e++)r=this.p.columns[e],r.stype?r.inputtype=r.stype:r.inputtype||(r.inputtype="text"),r.sorttype?r.searchtype=r.sorttype:r.searchtype||(r.searchtype="string"),void 0===r.hidden&&(r.hidden=!1),r.label||(r.label=r.name),r.index&&(r.name=r.index),r.hasOwnProperty("searchoptions")||(r.searchoptions={}),r.hasOwnProperty("searchrules")||(r.searchrules={});this.p.showQuery&&t(this).append("<table class='queryresult ui-widget ui-widget-content' style='display:block;max-width:440px;border:0px none;' dir='"+this.p.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var i=function(e,r){var n=[!0,""];if(t.isFunction(r.searchrules))n=r.searchrules(e,r);else if(t.jgrid&&t.jgrid.checkValues)try{n=t.jgrid.checkValues(e,-1,null,r.searchrules,r.label)}catch(o){}n&&n.length&&n[0]===!1&&(s.error=!n[0],s.errmsg=n[1])};this.onchange=function(){return this.p.error=!1,this.p.errmsg="",t.isFunction(this.p.onChange)?this.p.onChange.call(this,this.p):!1},this.reDraw=function(){t("table.group:first",this).remove();var e=this.createTableForGroup(s.filter,null);t(this).append(e),t.isFunction(this.p.afterRedraw)&&this.p.afterRedraw.call(this,this.p)},this.createTableForGroup=function(e,r){var n,o=this,i=t("<table class='group ui-widget ui-widget-content' style='border:0px none;'><tbody></tbody></table>"),p="left";"rtl"==this.p.direction&&(p="right",i.attr("dir","rtl")),null===r&&i.append("<tr class='error' style='display:none;'><th colspan='5' class='ui-state-error' align='"+p+"'></th></tr>");var a=t("<tr></tr>");i.append(a);var l=t("<th colspan='5' align='"+p+"'></th>");if(a.append(l),this.p.ruleButtons===!0){var u=t("<select class='opsel'></select>");l.append(u);var c,h="";for(n=0;n<s.groupOps.length;n++)c=e.groupOp===o.p.groupOps[n].op?" selected='selected'":"",h+="<option value='"+o.p.groupOps[n].op+"'"+c+">"+o.p.groupOps[n].text+"</option>";u.append(h).bind("change",function(){e.groupOp=t(u).val(),o.onchange()})}var d="<span></span>";if(this.p.groupButton&&(d=t("<input type='button' value='+ {}' title='Add subgroup' class='add-group'/>"),d.bind("click",function(){return void 0===e.groups&&(e.groups=[]),e.groups.push({groupOp:s.groupOps[0].op,rules:[],groups:[]}),o.reDraw(),o.onchange(),!1})),l.append(d),this.p.ruleButtons===!0){var g,f=t("<input type='button' value='+' title='Add rule' class='add-rule ui-add'/>");f.bind("click",function(){for(void 0===e.rules&&(e.rules=[]),n=0;n<o.p.columns.length;n++){var t="undefined"==typeof o.p.columns[n].search?!0:o.p.columns[n].search,r=o.p.columns[n].hidden===!0,s=o.p.columns[n].searchoptions.searchhidden===!0;if(s&&t||t&&!r){g=o.p.columns[n];break}}var i;return i=g.searchoptions.sopt?g.searchoptions.sopt:o.p.sopt?o.p.sopt:"string"===g.searchtype?o.p.stropts:o.p.numopts,e.rules.push({field:g.name,op:i[0],data:""}),o.reDraw(),!1}),l.append(f)}if(null!==r){var m=t("<input type='button' value='-' title='Delete group' class='delete-group'/>");l.append(m),m.bind("click",function(){for(n=0;n<r.groups.length;n++)if(r.groups[n]===e){r.groups.splice(n,1);break}return o.reDraw(),o.onchange(),!1})}if(void 0!==e.groups)for(n=0;n<e.groups.length;n++){var v=t("<tr></tr>");i.append(v);var y=t("<td class='first'></td>");v.append(y);var b=t("<td colspan='4'></td>");b.append(this.createTableForGroup(e.groups[n],e)),v.append(b)}if(void 0===e.groupOp&&(e.groupOp=o.p.groupOps[0].op),void 0!==e.rules)for(n=0;n<e.rules.length;n++)i.append(this.createTableRowForRule(e.rules[n],e));return i},this.createTableRowForRule=function(e,r){var n,i,p,a,l,u=this,c=t("<tr></tr>"),h="";c.append("<td class='first'></td>");var d=t("<td class='columns'></td>");c.append(d);var g,f=t("<select></select>"),m=[];d.append(f),f.bind("change",function(){for(e.field=t(f).val(),p=t(this).parents("tr:first"),n=0;n<u.p.columns.length;n++)if(u.p.columns[n].name===e.field){a=u.p.columns[n];break}if(a){a.searchoptions.id=t.jgrid.randId(),o&&"text"===a.inputtype&&(a.searchoptions.size||(a.searchoptions.size=10));var r=t.jgrid.createEl(a.inputtype,a.searchoptions,"",!0,u.p.ajaxSelectOptions,!0);t(r).addClass("input-elm"),i=a.searchoptions.sopt?a.searchoptions.sopt:u.p.sopt?u.p.sopt:"string"===a.searchtype?u.p.stropts:u.p.numopts;var s="",l=0;for(m=[],t.each(u.p.ops,function(){m.push(this.name)}),n=0;n<i.length;n++)g=t.inArray(i[n],m),-1!==g&&(0===l&&(e.op=u.p.ops[g].name),s+="<option value='"+u.p.ops[g].name+"'>"+u.p.ops[g].description+"</option>",l++);if(t(".selectopts",p).empty().append(s),t(".selectopts",p)[0].selectedIndex=0,t.browser.msie&&t.browser.version<9){var c=parseInt(t("select.selectopts",p)[0].offsetWidth)+1;t(".selectopts",p).width(c),t(".selectopts",p).css("width","auto")}t(".data",p).empty().append(r),t(".input-elm",p).bind("change",function(r){var n=t(this).hasClass("ui-autocomplete-input")?200:0;setTimeout(function(){var n=r.target;e.data="SPAN"===n.nodeName.toUpperCase()&&a.searchoptions&&t.isFunction(a.searchoptions.custom_value)?a.searchoptions.custom_value(t(n).children(".customelement:first"),"get"):n.value,u.onchange()},n)}),setTimeout(function(){e.data=t(r).val(),u.onchange()},0)}});var v=0;for(n=0;n<u.p.columns.length;n++){var y="undefined"==typeof u.p.columns[n].search?!0:u.p.columns[n].search,b=u.p.columns[n].hidden===!0,w=u.p.columns[n].searchoptions.searchhidden===!0;(w&&y||y&&!b)&&(l="",e.field===u.p.columns[n].name&&(l=" selected='selected'",v=n),h+="<option value='"+u.p.columns[n].name+"'"+l+">"+u.p.columns[n].label+"</option>")}f.append(h);var O=t("<td class='operators'></td>");c.append(O),a=s.columns[v],a.searchoptions.id=t.jgrid.randId(),o&&"text"===a.inputtype&&(a.searchoptions.size||(a.searchoptions.size=10));var F=t.jgrid.createEl(a.inputtype,a.searchoptions,e.data,!0,u.p.ajaxSelectOptions,!0),k=t("<select class='selectopts'></select>");for(O.append(k),k.bind("change",function(){e.op=t(k).val(),p=t(this).parents("tr:first");var r=t(".input-elm",p)[0];"nu"===e.op||"nn"===e.op?(e.data="",r.value="",r.setAttribute("readonly","true"),r.setAttribute("disabled","true")):(r.removeAttribute("readonly"),r.removeAttribute("disabled")),u.onchange()}),i=a.searchoptions.sopt?a.searchoptions.sopt:u.p.sopt?u.p.sopt:"string"===a.searchtype?s.stropts:u.p.numopts,h="",t.each(u.p.ops,function(){m.push(this.name)}),n=0;n<i.length;n++)g=t.inArray(i[n],m),-1!==g&&(l=e.op===u.p.ops[g].name?" selected='selected'":"",h+="<option value='"+u.p.ops[g].name+"'"+l+">"+u.p.ops[g].description+"</option>");k.append(h);var x=t("<td class='data'></td>");c.append(x),x.append(F),t(F).addClass("input-elm").bind("change",function(){e.data="custom"===a.inputtype?a.searchoptions.custom_value(t(this).children(".customelement:first"),"get"):t(this).val(),u.onchange()});var j=t("<td></td>");if(c.append(j),this.p.ruleButtons===!0){var S=t("<input type='button' value='-' title='Delete rule' class='delete-rule ui-del'/>");j.append(S),S.bind("click",function(){for(n=0;n<r.rules.length;n++)if(r.rules[n]===e){r.rules.splice(n,1);break}return u.reDraw(),u.onchange(),!1})}return c},this.getStringForGroup=function(t){var e,r="(";if(void 0!==t.groups)for(e=0;e<t.groups.length;e++){r.length>1&&(r+=" "+t.groupOp+" ");try{r+=this.getStringForGroup(t.groups[e])}catch(n){alert(n)}}if(void 0!==t.rules)try{for(e=0;e<t.rules.length;e++)r.length>1&&(r+=" "+t.groupOp+" "),r+=this.getStringForRule(t.rules[e])}catch(s){alert(s)}return r+=")","()"===r?"":r},this.getStringForRule=function(e){var r,n,o,p,a="",l="",u=["int","integer","float","number","currency"];for(r=0;r<this.p.ops.length;r++)if(this.p.ops[r].name===e.op){a=this.p.ops[r].operator,l=this.p.ops[r].name;break}for(r=0;r<this.p.columns.length;r++)if(this.p.columns[r].name===e.field){n=this.p.columns[r];break}return p=e.data,("bw"===l||"bn"===l)&&(p+="%"),("ew"===l||"en"===l)&&(p="%"+p),("cn"===l||"nc"===l)&&(p="%"+p+"%"),("in"===l||"ni"===l)&&(p=" ("+p+")"),s.errorcheck&&i(e.data,n),o=-1!==t.inArray(n.searchtype,u)||"nn"===l||"nu"===l?e.field+" "+a+" "+p:e.field+" "+a+' "'+p+'"'},this.resetFilter=function(){this.p.filter=t.extend(!0,{},this.p.initFilter),this.reDraw(),this.onchange()},this.hideError=function(){t("th.ui-state-error",this).html(""),t("tr.error",this).hide()},this.showError=function(){t("th.ui-state-error",this).html(this.p.errmsg),t("tr.error",this).show()},this.toUserFriendlyString=function(){return this.getStringForGroup(s.filter)},this.toString=function(){function t(t){if(r.p.errorcheck){var e,n;for(e=0;e<r.p.columns.length;e++)if(r.p.columns[e].name===t.field){n=r.p.columns[e];break}n&&i(t.data,n)}return t.op+"(item."+t.field+",'"+t.data+"')"}function e(r){var n,s="(";if(void 0!==r.groups)for(n=0;n<r.groups.length;n++)s.length>1&&(s+="OR"===r.groupOp?" || ":" && "),s+=e(r.groups[n]);if(void 0!==r.rules)for(n=0;n<r.rules.length;n++)s.length>1&&(s+="OR"===r.groupOp?" || ":" && "),s+=t(r.rules[n]);return s+=")","()"===s?"":s}var r=this;return e(this.p.filter)},this.reDraw(),this.p.showQuery&&this.onchange(),this.filter=!0}}})},t.extend(t.fn.jqFilter,{toSQLString:function(){var t="";return this.each(function(){t=this.toUserFriendlyString()}),t},filterData:function(){var t;return this.each(function(){t=this.p.filter}),t},getParameter:function(t){return void 0!==t&&this.p.hasOwnProperty(t)?this.p[t]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(t){"string"==typeof t&&(t=jQuery.jgrid.parse(t)),this.each(function(){this.p.filter=t,this.reDraw(),this.onchange()})}})}(jQuery);