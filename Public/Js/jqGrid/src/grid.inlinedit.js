!function(e){"use strict";e.jgrid.inlineEdit=e.jgrid.inlineEdit||{},e.jgrid.extend({editRow:function(t,i,r,a,d,n,o,s,l){var c={},u=e.makeArray(arguments).slice(1);return"object"===e.type(u[0])?c=u[0]:("undefined"!=typeof i&&(c.keys=i),e.isFunction(r)&&(c.oneditfunc=r),e.isFunction(a)&&(c.successfunc=a),"undefined"!=typeof d&&(c.url=d),"undefined"!=typeof n&&(c.extraparam=n),e.isFunction(o)&&(c.aftersavefunc=o),e.isFunction(s)&&(c.errorfunc=s),e.isFunction(l)&&(c.afterrestorefunc=l)),c=e.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"},e.jgrid.inlineEdit,c),this.each(function(){var i,r,a,d,n,o=this,s=0,l=null,u={};o.grid&&(d=e(o).jqGrid("getInd",t,!0),d!==!1&&(a=e(d).attr("editable")||"0","0"!=a||e(d).hasClass("not-editable-row")||(n=o.p.colModel,e('td[role="gridcell"]',d).each(function(a){i=n[a].name;var d=o.p.treeGrid===!0&&i==o.p.ExpandColumn;if(d)r=e("span:first",this).html();else try{r=e.unformat.call(o,this,{rowId:t,colModel:n[a]},a)}catch(c){r=n[a].edittype&&"textarea"==n[a].edittype?e(this).text():e(this).html()}if("cb"!=i&&"subgrid"!=i&&"rn"!=i&&(o.p.autoencode&&(r=e.jgrid.htmlDecode(r)),u[i]=r,n[a].editable===!0)){null===l&&(l=a),d?e("span:first",this).html(""):e(this).html("");var f=e.extend({},n[a].editoptions||{},{id:t+"_"+i,name:i});n[a].edittype||(n[a].edittype="text"),("&nbsp;"==r||"&#160;"==r||1==r.length&&160==r.charCodeAt(0))&&(r="");var p=e.jgrid.createEl.call(o,n[a].edittype,f,r,!0,e.extend({},e.jgrid.ajaxOptions,o.p.ajaxSelectOptions||{}));e(p).addClass("editable"),d?e("span:first",this).append(p):e(this).append(p),"select"==n[a].edittype&&"undefined"!=typeof n[a].editoptions&&n[a].editoptions.multiple===!0&&"undefined"==typeof n[a].editoptions.dataUrl&&e.browser.msie&&e(p).width(e(p).width()),s++}}),s>0&&(u.id=t,o.p.savedRow.push(u),e(d).attr("editable","1"),e("td:eq("+l+") input",d).focus(),c.keys===!0&&e(d).bind("keydown",function(i){if(27===i.keyCode){if(e(o).jqGrid("restoreRow",t,c.afterrestorefunc),o.p._inlinenav)try{e(o).jqGrid("showAddEditButtons")}catch(r){}return!1}if(13===i.keyCode){var a=i.target;if("TEXTAREA"==a.tagName)return!0;if(e(o).jqGrid("saveRow",t,c)&&o.p._inlinenav)try{e(o).jqGrid("showAddEditButtons")}catch(d){}return!1}}),e(o).triggerHandler("jqGridInlineEditRow",[t,c]),e.isFunction(c.oneditfunc)&&c.oneditfunc.call(o,t)))))})},saveRow:function(t,i,r,a,d,n,o){var s=e.makeArray(arguments).slice(1),l={};"object"===e.type(s[0])?l=s[0]:(e.isFunction(i)&&(l.successfunc=i),"undefined"!=typeof r&&(l.url=r),"undefined"!=typeof a&&(l.extraparam=a),e.isFunction(d)&&(l.aftersavefunc=d),e.isFunction(n)&&(l.errorfunc=n),e.isFunction(o)&&(l.afterrestorefunc=o)),l=e.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"},e.jgrid.inlineEdit,l);var c,u,f,p,j,g=!1,v=this[0],m={},w={},h={};if(!v.grid)return g;if(j=e(v).jqGrid("getInd",t,!0),j===!1)return g;if(u=e(j).attr("editable"),l.url=l.url?l.url:v.p.editurl,"1"===u){var b;if(e('td[role="gridcell"]',j).each(function(t){if(b=v.p.colModel[t],c=b.name,"cb"!=c&&"subgrid"!=c&&b.editable===!0&&"rn"!=c&&!e(this).hasClass("not-editable-cell")){switch(b.edittype){case"checkbox":var i=["Yes","No"];b.editoptions&&(i=b.editoptions.value.split(":")),m[c]=e("input",this).is(":checked")?i[0]:i[1];break;case"text":case"password":case"textarea":case"button":m[c]=e("input, textarea",this).val();break;case"select":if(b.editoptions.multiple){var r=e("select",this),a=[];m[c]=e(r).val(),m[c]?m[c]=m[c].join(","):m[c]="",e("select option:selected",this).each(function(t,i){a[t]=e(i).text()}),w[c]=a.join(",")}else m[c]=e("select option:selected",this).val(),w[c]=e("select option:selected",this).text();b.formatter&&"select"==b.formatter&&(w={});break;case"custom":try{if(!b.editoptions||!e.isFunction(b.editoptions.custom_value))throw"e1";if(m[c]=b.editoptions.custom_value.call(v,e(".customelement",this),"get"),void 0===m[c])throw"e2"}catch(d){"e1"==d&&e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose),"e2"==d?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,d.message,e.jgrid.edit.bClose)}}if(p=e.jgrid.checkValues(m[c],t,v),p[0]===!1)return p[1]=m[c]+" "+p[1],!1;v.p.autoencode&&(m[c]=e.jgrid.htmlEncode(m[c])),"clientArray"!==l.url&&b.editoptions&&b.editoptions.NullIfEmpty===!0&&""===m[c]&&(h[c]="null")}}),p[0]===!1){try{var q=e.jgrid.findPos(e("#"+e.jgrid.jqID(t),v.grid.bDiv)[0]);e.jgrid.info_dialog(e.jgrid.errors.errcap,p[1],e.jgrid.edit.bClose,{left:q[0],top:q[1]})}catch(x){alert(p[1])}return g}var R,y,_;if(y=v.p.prmNames,_=y.oper,R=y.id,m&&(m[_]=y.editoper,m[R]=t,"undefined"==typeof v.p.inlineData&&(v.p.inlineData={}),m=e.extend({},m,v.p.inlineData,l.extraparam)),"clientArray"==l.url){m=e.extend({},m,w),v.p.autoencode&&e.each(m,function(t,i){m[t]=e.jgrid.htmlDecode(i)});var D=e(v).jqGrid("setRowData",t,m);e(j).attr("editable","0");for(var G=0;G<v.p.savedRow.length;G++)if(v.p.savedRow[G].id==t){f=G;break}f>=0&&v.p.savedRow.splice(f,1),e(v).triggerHandler("jqGridInlineAfterSaveRow",[t,D,m,l]),e.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(v,t,D),g=!0,e(j).unbind("keydown")}else e("#lui_"+e.jgrid.jqID(v.p.id)).show(),h=e.extend({},m,h),h[R]=e.jgrid.stripPref(v.p.idPrefix,h[R]),e.ajax(e.extend({url:l.url,data:e.isFunction(v.p.serializeRowData)?v.p.serializeRowData.call(v,h):h,type:l.mtype,async:!1,complete:function(i,r){if(e("#lui_"+e.jgrid.jqID(v.p.id)).hide(),"success"===r){var a,d=!0;if(a=e(v).triggerHandler("jqGridInlineSuccessSaveRow",[i,t,l]),e.isArray(a)||(a=[!0,m]),a[0]&&e.isFunction(l.successfunc)&&(a=l.successfunc.call(v,i)),e.isArray(a)?(d=a[0],m=a[1]?a[1]:m):d=a,d===!0){v.p.autoencode&&e.each(m,function(t,i){m[t]=e.jgrid.htmlDecode(i)}),m=e.extend({},m,w),e(v).jqGrid("setRowData",t,m),e(j).attr("editable","0");for(var n=0;n<v.p.savedRow.length;n++)if(v.p.savedRow[n].id==t){f=n;break}f>=0&&v.p.savedRow.splice(f,1),e(v).triggerHandler("jqGridInlineAfterSaveRow",[t,i,m,l]),e.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(v,t,i),g=!0,e(j).unbind("keydown")}else e(v).triggerHandler("jqGridInlineErrorSaveRow",[t,i,r,null,l]),e.isFunction(l.errorfunc)&&l.errorfunc.call(v,t,i,r,null),l.restoreAfterError===!0&&e(v).jqGrid("restoreRow",t,l.afterrestorefunc)}},error:function(i,r,a){if(e("#lui_"+e.jgrid.jqID(v.p.id)).hide(),e(v).triggerHandler("jqGridInlineErrorSaveRow",[t,i,r,a,l]),e.isFunction(l.errorfunc))l.errorfunc.call(v,t,i,r,a);else try{e.jgrid.info_dialog(e.jgrid.errors.errcap,'<div class="ui-state-error">'+i.responseText+"</div>",e.jgrid.edit.bClose,{buttonalign:"right"})}catch(d){alert(i.responseText)}l.restoreAfterError===!0&&e(v).jqGrid("restoreRow",t,l.afterrestorefunc)}},e.jgrid.ajaxOptions,v.p.ajaxRowOptions||{}))}return g},restoreRow:function(t,i){var r=e.makeArray(arguments).slice(1),a={};return"object"===e.type(r[0])?a=r[0]:e.isFunction(i)&&(a.afterrestorefunc=i),a=e.extend(!0,e.jgrid.inlineEdit,a),this.each(function(){var i,r,d=this,n={};if(d.grid&&(r=e(d).jqGrid("getInd",t,!0),r!==!1)){for(var o=0;o<d.p.savedRow.length;o++)if(d.p.savedRow[o].id==t){i=o;break}if(i>=0){if(e.isFunction(e.fn.datepicker))try{e("input.hasDatepicker","#"+e.jgrid.jqID(r.id)).datepicker("hide")}catch(s){}e.each(d.p.colModel,function(){this.editable===!0&&this.name in d.p.savedRow[i]&&(n[this.name]=d.p.savedRow[i][this.name])}),e(d).jqGrid("setRowData",t,n),e(r).attr("editable","0").unbind("keydown"),d.p.savedRow.splice(i,1),e("#"+e.jgrid.jqID(t),"#"+e.jgrid.jqID(d.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){e(d).jqGrid("delRowData",t)},0)}e(d).triggerHandler("jqGridInlineAfterRestoreRow",[t]),e.isFunction(a.afterrestorefunc)&&a.afterrestorefunc.call(d,t)}})},addRow:function(t){return t=e.extend(!0,{rowID:"new_row",initdata:{},position:"first",useDefValues:!0,useFormatter:!1,addRowParams:{extraparam:{}}},t||{}),this.each(function(){if(this.grid){var i=this;if(t.useDefValues===!0&&e(i.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var r=this.editoptions.defaultValue,a=e.isFunction(r)?r.call(i):r;t.initdata[this.name]=a}}),e(i).jqGrid("addRowData",t.rowID,t.initdata,t.position),e("#"+e.jgrid.jqID(t.rowID),"#"+e.jgrid.jqID(i.p.id)).addClass("jqgrid-new-row"),t.useFormatter)e("#"+e.jgrid.jqID(t.rowID)+" .ui-inline-edit","#"+e.jgrid.jqID(i.p.id)).click();else{var r=i.p.prmNames,a=r.oper;t.addRowParams.extraparam[a]=r.addoper,e(i).jqGrid("editRow",t.rowID,t.addRowParams),e(i).jqGrid("setSelection",t.rowID)}}})},inlineNav:function(t,i){return i=e.extend({edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",addParams:{useFormatter:!1,rowID:"new_row"},editParams:{},restoreAfterSelect:!0},e.jgrid.nav,i||{}),this.each(function(){if(this.grid){var r,a=this,d=e.jgrid.jqID(a.p.id);if(a.p._inlinenav=!0,i.addParams.useFormatter===!0){var n,o=a.p.colModel;for(n=0;n<o.length;n++)if(o[n].formatter&&"actions"===o[n].formatter){if(o[n].formatoptions){var s={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},l=e.extend(s,o[n].formatoptions);i.addParams.addRowParams={keys:l.keys,oneditfunc:l.onEdit,successfunc:l.onSuccess,url:l.url,extraparam:l.extraparam,aftersavefunc:l.afterSavef,errorfunc:l.onError,afterrestorefunc:l.afterRestore}}break}}i.add&&e(a).jqGrid("navButtonAdd",t,{caption:i.addtext,title:i.addtitle,buttonicon:i.addicon,id:a.p.id+"_iladd",onClickButton:function(){e(a).jqGrid("addRow",i.addParams),i.addParams.useFormatter||(e("#"+d+"_ilsave").removeClass("ui-state-disabled"),e("#"+d+"_ilcancel").removeClass("ui-state-disabled"),e("#"+d+"_iladd").addClass("ui-state-disabled"),e("#"+d+"_iledit").addClass("ui-state-disabled"))}}),i.edit&&e(a).jqGrid("navButtonAdd",t,{caption:i.edittext,title:i.edittitle,buttonicon:i.editicon,id:a.p.id+"_iledit",onClickButton:function(){var t=e(a).jqGrid("getGridParam","selrow");t?(e(a).jqGrid("editRow",t,i.editParams),e("#"+d+"_ilsave").removeClass("ui-state-disabled"),e("#"+d+"_ilcancel").removeClass("ui-state-disabled"),e("#"+d+"_iladd").addClass("ui-state-disabled"),e("#"+d+"_iledit").addClass("ui-state-disabled")):(e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+d,jqm:!0}),e("#jqg_alrt").focus())}}),i.save&&(e(a).jqGrid("navButtonAdd",t,{caption:i.savetext||"",title:i.savetitle||"Save row",buttonicon:i.saveicon,id:a.p.id+"_ilsave",onClickButton:function(){var t=a.p.savedRow[0].id;if(t){var r=a.p.prmNames,n=r.oper;i.editParams.extraparam||(i.editParams.extraparam={}),e("#"+e.jgrid.jqID(t),"#"+d).hasClass("jqgrid-new-row")?i.editParams.extraparam[n]=r.addoper:i.editParams.extraparam[n]=r.editoper,e(a).jqGrid("saveRow",t,i.editParams)&&e(a).jqGrid("showAddEditButtons")}else e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+d,jqm:!0}),e("#jqg_alrt").focus()}}),e("#"+d+"_ilsave").addClass("ui-state-disabled")),i.cancel&&(e(a).jqGrid("navButtonAdd",t,{caption:i.canceltext||"",title:i.canceltitle||"Cancel row editing",buttonicon:i.cancelicon,id:a.p.id+"_ilcancel",onClickButton:function(){var t=a.p.savedRow[0].id;t?(e(a).jqGrid("restoreRow",t,i.editParams),e(a).jqGrid("showAddEditButtons")):(e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+d,jqm:!0}),e("#jqg_alrt").focus())}}),e("#"+d+"_ilcancel").addClass("ui-state-disabled")),i.restoreAfterSelect===!0&&(r=e.isFunction(a.p.beforeSelectRow)?a.p.beforeSelectRow:!1,a.p.beforeSelectRow=function(t,d){var n=!0;return a.p.savedRow.length>0&&a.p._inlinenav===!0&&t!==a.p.selrow&&null!==a.p.selrow&&(a.p.selrow==i.addParams.rowID?e(a).jqGrid("delRowData",a.p.selrow):e(a).jqGrid("restoreRow",a.p.selrow,i.editParams),e(a).jqGrid("showAddEditButtons")),r&&(n=r.call(a,t,d)),n})}})},showAddEditButtons:function(){return this.each(function(){if(this.grid){var t=e.jgrid.jqID(this.p.id);e("#"+t+"_ilsave").addClass("ui-state-disabled"),e("#"+t+"_ilcancel").addClass("ui-state-disabled"),e("#"+t+"_iladd").removeClass("ui-state-disabled"),e("#"+t+"_iledit").removeClass("ui-state-disabled")}})}})}(jQuery);