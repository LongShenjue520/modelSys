!function(i){"use strict";i.jgrid.extend({setSubGrid:function(){return this.each(function(){var d,e=this,r={plusicon:"ui-icon-plus",minusicon:"ui-icon-minus",openicon:"ui-icon-carat-1-sw",expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,reloadOnExpand:!0};if(e.p.subGridOptions=i.extend(r,e.p.subGridOptions||{}),e.p.colNames.unshift(""),e.p.colModel.unshift({name:"subgrid",width:i.browser.safari?e.p.subGridWidth+e.p.cellLayout:e.p.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0}),d=e.p.subGridModel,d[0]){d[0].align=i.extend([],d[0].align||[]);for(var s=0;s<d[0].name.length;s++)d[0].align[s]=d[0].align[s]||"left"}})},addSubGridCell:function(i,d){var e,r,s="";return this.each(function(){s=this.formatCol(i,d),r=this.p.id,e=this.p.subGridOptions.plusicon}),'<td role="gridcell" aria-describedby="'+r+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+s+"><a href='javascript:void(0);'><span class='ui-icon "+e+"'></span></a></td>"},addSubGrid:function(d,e){return this.each(function(){var r=this;if(r.grid){var s,t,a,n,l,o=function(d,e,s){var t=i("<td align='"+r.p.subGridModel[0].align[s]+"'></td>").html(e);i(d).append(t)},p=function(d,e){var s,t,a,n=i("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),l=i("<tr></tr>");for(t=0;t<r.p.subGridModel[0].name.length;t++)s=i("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+r.p.direction+"'></th>"),i(s).html(r.p.subGridModel[0].name[t]),i(s).width(r.p.subGridModel[0].width[t]),i(l).append(s);i(n).append(l),d&&(a=r.p.xmlReader.subgrid,i(a.root+" "+a.row,d).each(function(){if(l=i("<tr class='ui-widget-content ui-subtblcell'></tr>"),a.repeatitems===!0)i(a.cell,this).each(function(d){o(l,i(this).text()||"&#160;",d)});else{var d=r.p.subGridModel[0].mapping||r.p.subGridModel[0].name;if(d)for(t=0;t<d.length;t++)o(l,i(d[t],this).text()||"&#160;",t)}i(n).append(l)}));var p=i("table:first",r.grid.bDiv).attr("id")+"_";return i("#"+i.jgrid.jqID(p+e)).append(n),r.grid.hDiv.loading=!1,i("#load_"+i.jgrid.jqID(r.p.id)).hide(),!1},u=function(d,e){var s,t,a,n,l,p,u=i("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),c=i("<tr></tr>");for(a=0;a<r.p.subGridModel[0].name.length;a++)s=i("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+r.p.direction+"'></th>"),i(s).html(r.p.subGridModel[0].name[a]),i(s).width(r.p.subGridModel[0].width[a]),i(c).append(s);if(i(u).append(c),d&&(l=r.p.jsonReader.subgrid,t=d[l.root],"undefined"!=typeof t))for(a=0;a<t.length;a++){if(n=t[a],c=i("<tr class='ui-widget-content ui-subtblcell'></tr>"),l.repeatitems===!0)for(l.cell&&(n=n[l.cell]),p=0;p<n.length;p++)o(c,n[p]||"&#160;",p);else{var g=r.p.subGridModel[0].mapping||r.p.subGridModel[0].name;if(g.length)for(p=0;p<g.length;p++)o(c,n[g[p]]||"&#160;",p)}i(u).append(c)}var b=i("table:first",r.grid.bDiv).attr("id")+"_";return i("#"+i.jgrid.jqID(b+e)).append(u),r.grid.hDiv.loading=!1,i("#load_"+i.jgrid.jqID(r.p.id)).hide(),!1},c=function(d){var e,s,t,a;if(e=i(d).attr("id"),s={nd_:(new Date).getTime()},s[r.p.prmNames.subgridid]=e,!r.p.subGridModel[0])return!1;if(r.p.subGridModel[0].params)for(a=0;a<r.p.subGridModel[0].params.length;a++)for(t=0;t<r.p.colModel.length;t++)r.p.colModel[t].name===r.p.subGridModel[0].params[a]&&(s[r.p.colModel[t].name]=i("td:eq("+t+")",d).text().replace(/\&#160\;/gi,""));if(!r.grid.hDiv.loading)switch(r.grid.hDiv.loading=!0,i("#load_"+i.jgrid.jqID(r.p.id)).show(),r.p.subgridtype||(r.p.subgridtype=r.p.datatype),i.isFunction(r.p.subgridtype)?r.p.subgridtype.call(r,s):r.p.subgridtype=r.p.subgridtype.toLowerCase(),r.p.subgridtype){case"xml":case"json":i.ajax(i.extend({type:r.p.mtype,url:r.p.subGridUrl,dataType:r.p.subgridtype,data:i.isFunction(r.p.serializeSubGridData)?r.p.serializeSubGridData.call(r,s):s,complete:function(d){"xml"===r.p.subgridtype?p(d.responseXML,e):u(i.jgrid.parse(d.responseText),e),d=null}},i.jgrid.ajaxOptions,r.p.ajaxSubgridOptions||{}))}return!1},g=0;i.each(r.p.colModel,function(){(this.hidden===!0||"rn"===this.name||"cb"===this.name)&&g++});var b=r.rows.length,h=1;for(void 0!==e&&e>0&&(h=e,b=e+1);b>h;)i(r.rows[h]).hasClass("jqgrow")&&i(r.rows[h].cells[d]).bind("click",function(){var e=i(this).parent("tr")[0];if(l=e.nextSibling,i(this).hasClass("sgcollapsed")){if(t=r.p.id,s=e.id,r.p.subGridOptions.reloadOnExpand===!0||r.p.subGridOptions.reloadOnExpand===!1&&!i(l).hasClass("ui-subgrid")){if(a=d>=1?"<td colspan='"+d+"'>&#160;</td>":"",n=i(r).triggerHandler("jqGridSubGridBeforeExpand",[t+"_"+s,s]),n=n===!1||"stop"===n?!1:!0,n&&i.isFunction(r.p.subGridBeforeExpand)&&(n=r.p.subGridBeforeExpand.call(r,t+"_"+s,s)),n===!1)return!1;i(e).after("<tr role='row' class='ui-subgrid'>"+a+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon "+r.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(r.p.colNames.length-1-g,10)+"' class='ui-widget-content subgrid-data'><div id="+t+"_"+s+" class='tablediv'></div></td></tr>"),i(r).triggerHandler("jqGridSubGridRowExpanded",[t+"_"+s,s]),i.isFunction(r.p.subGridRowExpanded)?r.p.subGridRowExpanded.call(r,t+"_"+s,s):c(e)}else i(l).show();i(this).html("<a href='javascript:void(0);'><span class='ui-icon "+r.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded"),r.p.subGridOptions.selectOnExpand&&i(r).jqGrid("setSelection",s)}else if(i(this).hasClass("sgexpanded")){if(n=i(r).triggerHandler("jqGridSubGridRowColapsed",[t+"_"+s,s]),n=n===!1||"stop"===n?!1:!0,n&&i.isFunction(r.p.subGridRowColapsed)&&(s=e.id,n=r.p.subGridRowColapsed.call(r,t+"_"+s,s)),n===!1)return!1;r.p.subGridOptions.reloadOnExpand===!0?i(l).remove(".ui-subgrid"):i(l).hasClass("ui-subgrid")&&i(l).hide(),i(this).html("<a href='javascript:void(0);'><span class='ui-icon "+r.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed")}return!1}),r.p.subGridOptions.expandOnLoad===!0&&i(r.rows[h].cells[d]).trigger("click"),h++;r.subGridXml=function(i,d){p(i,d)},r.subGridJson=function(i,d){u(i,d)}}})},expandSubGridRow:function(d){return this.each(function(){var e=this;if((e.grid||d)&&e.p.subGrid===!0){var r=i(this).jqGrid("getInd",d,!0);if(r){var s=i("td.sgcollapsed",r)[0];s&&i(s).trigger("click")}}})},collapseSubGridRow:function(d){return this.each(function(){var e=this;if((e.grid||d)&&e.p.subGrid===!0){var r=i(this).jqGrid("getInd",d,!0);if(r){var s=i("td.sgexpanded",r)[0];s&&i(s).trigger("click")}}})},toggleSubGridRow:function(d){return this.each(function(){var e=this;if((e.grid||d)&&e.p.subGrid===!0){var r=i(this).jqGrid("getInd",d,!0);if(r){var s=i("td.sgcollapsed",r)[0];s?i(s).trigger("click"):(s=i("td.sgexpanded",r)[0],s&&i(s).trigger("click"))}}})}})}(jQuery);