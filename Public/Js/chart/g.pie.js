!function(){function e(e,t,l,r,a,o){function s(e,t,l,r,a,o){var s=Math.PI/180,n=e+l*Math.cos(-r*s),i=e+l*Math.cos(-a*s),h=e+l/2*Math.cos(-(r+(a-r)/2)*s),c=t+l*Math.sin(-r*s),u=t+l*Math.sin(-a*s),f=t+l/2*Math.sin(-(r+(a-r)/2)*s),d=["M",e,t,"L",n,c,"A",l,l,0,+(Math.abs(a-r)>180),1,i,u,"z"];return d.middle={x:h,y:f},d}o=o||{};var n=this,i=[],h=e.set(),c=e.set(),u=e.set(),f=a.length,d=0,v=0,m=0,p=9,g=!0;if(c.covers=h,1==f)u.push(e.circle(t,l,r).attr({fill:n.colors[0],stroke:o.stroke||"#fff","stroke-width":null==o.strokewidth?1:o.strokewidth})),h.push(e.circle(t,l,r).attr(n.shim)),v=a[0],a[0]={value:a[0],order:0,valueOf:function(){return this.value}},u[0].middle={x:t,y:l},u[0].mangle=180;else{for(var b=0;f>b;b++)v+=a[b],a[b]={value:a[b],order:b,valueOf:function(){return this.value}};for(a.sort(function(e,t){return t.value-e.value}),b=0;f>b;b++)g&&360*a[b]/v<=1.5&&(p=b,g=!1),b>p&&(g=!1,a[p].value+=a[b],a[p].others=!0,m=a[p].value);for(f=Math.min(p+1,a.length),m&&a.splice(f)&&(a[p].others=!0),b=0;f>b;b++){var x=d-360*a[b]/v/2;if(b||(d=90-x,x=d-360*a[b]/v/2),o.init)var k=s(t,l,1,d,d-360*a[b]/v).join(",");var w=s(t,l,r,d,d-=360*a[b]/v),y=e.path(o.init?k:w).attr({fill:o.colors&&o.colors[b]||n.colors[b]||"#666",stroke:o.stroke||"#fff","stroke-width":null==o.strokewidth?1:o.strokewidth,"stroke-linejoin":"round"});y.value=a[b],y.middle=w.middle,y.mangle=x,i.push(y),u.push(y),o.init&&y.animate({path:w.join(",")},+o.init-1||1e3,">")}for(b=0;f>b;b++)y=e.path(i[b].attr("path")).attr(n.shim),o.href&&o.href[b]&&y.attr({href:o.href[b]}),y.attr=function(){},h.push(y),u.push(y)}c.hover=function(e,o){o=o||function(){};for(var s=this,n=0;f>n;n++)!function(n,i,h){var c={sector:n,cover:i,cx:t,cy:l,mx:n.middle.x,my:n.middle.y,mangle:n.mangle,r:r,value:a[h],total:v,label:s.labels&&s.labels[h]};i.mouseover(function(){e.call(c)}).mouseout(function(){o.call(c)})}(u[n],h[n],n);return this},c.each=function(e){for(var o=this,s=0;f>s;s++)!function(s,n,i){var h={sector:s,cover:n,cx:t,cy:l,x:s.middle.x,y:s.middle.y,mangle:s.mangle,r:r,value:a[i],total:v,label:o.labels&&o.labels[i]};e.call(h)}(u[s],h[s],s);return this},c.click=function(e){for(var o=this,s=0;f>s;s++)!function(s,n,i){var h={sector:s,cover:n,cx:t,cy:l,mx:s.middle.x,my:s.middle.y,mangle:s.mangle,r:r,value:a[i],total:v,label:o.labels&&o.labels[i]};n.click(function(){e.call(h)})}(u[s],h[s],s);return this},c.inject=function(e){e.insertBefore(h[0])};var M=function(s,i,d,m){var p=t+r+r/5,g=l,b=g+10;s=s||[],m=m&&m.toLowerCase&&m.toLowerCase()||"east",d=e[d&&d.toLowerCase()]||"circle",c.labels=e.set();for(var x=0;f>x;x++){var k,w=u[x].attr("fill"),y=a[x].order;a[x].others&&(s[y]=i||"Others"),s[y]=n.labelise(s[y],a[x],v),c.labels.push(e.set()),c.labels[x].push(e[d](p+5,b,5).attr({fill:w,stroke:"none"})),c.labels[x].push(k=e.text(p+20,b,s[y]||a[y]).attr(n.txtattr).attr({fill:o.legendcolor||"#000","text-anchor":"start"})),h[x].label=c.labels[x],b+=1.2*k.getBBox().height}var M=c.labels.getBBox(),B={east:[0,-M.height/2],west:[-M.width-2*r-20,-M.height/2],north:[-r-M.width/2,-r-M.height-10],south:[-r-M.width/2,r+10]}[m];c.labels.translate.apply(c.labels,B),c.push(c.labels)};return o.legend&&M(o.legend,o.legendothers,o.legendmark,o.legendpos),c.push(u,h),c.series=u,c.covers=h,c}var t=function(){};t.prototype=Raphael.g,e.prototype=new t,Raphael.fn.piechart=function(t,l,r,a,o){return new e(this,t,l,r,a,o)}}();