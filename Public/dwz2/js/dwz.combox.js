!function(e){var t=[],a=function(o){e.each(t,function(r){t[r]!=o&&(e("#"+t[r])[0]?e("#op_"+t[r]).css({height:"",width:""}).hide():e("#op_"+t[r]).remove(),e(document).unbind("click",a))})};e.extend(e.fn,{comboxSelect:function(o){var r=e.extend({selector:">a"},o);return this.each(function(){var o=e(this),i=e(r.selector,o);t.push(o.attr("id")),e(r.selector,o).click(function(){var t=e("#op_"+o.attr("id"));if(t.is(":hidden")){t.height()>300&&t.css({height:"300px",overflow:"scroll"});var r=o.offset().top+o[0].offsetHeight-50;r+t.height()>e(window).height()-20&&(r=e(window).height()-20-t.height()),t.css({top:r,left:o.offset().left}).show(),a(o.attr("id")),e(document).click(a)}else e(document).unbind("click",a),a();return!1}),e("#op_"+o.attr("id")).find(">li").comboxOption(i,o)})},comboxOption:function(t,a){return this.each(function(){e(">a",this).click(function(){var o=e(this);o.parent().parent().find(".selected").removeClass("selected"),o.addClass("selected"),t.text(o.text());var r=e("select",a);r.val()!=o.attr("value")&&e("select",a).val(o.attr("value")).trigger("refChange").trigger("change")})})},combox:function(){var a=[];return e.each(t,function(o){e("#"+t[o])[0]?a.push(t[o]):e("#op_"+t[o]).remove()}),t=a,this.each(function(t){var a=e(this).removeClass("combox"),o=a.attr("name"),r=a.attr("value"),i=e("option[value="+r+"]",a).text(),n=a.attr("ref"),c=a.attr("refUrl")||"",s=a.attr("id")||Math.round(1e7*Math.random()),l='<div class="combox"><div id="combox_'+s+'" class="select"'+(n?' ref="'+n+'"':"")+">";l+='<a href="javascript:" class="'+a.attr("class")+'" name="'+o+'" value="'+r+'">'+i+"</a></div></div>";var h='<ul class="comboxop" id="op_combox_'+s+'">';e("option",a).each(function(){var t=e(this);h+='<li><a class="'+(r==t[0].value?"selected":"")+'" href="#" value="'+t[0].value+'">'+t[0].text+"</a></li>"}),h+="</ul>",e("body").append(h),a.after(l),e("div.select",a.next()).comboxSelect().append(a),n&&c&&a.unbind("refChange").bind("refChange",function(t){var o=e("#"+n);return 0==o.size()?!1:void e.ajax({type:"GET",dataType:"json",url:c.replace("{value}",a.attr("value")),cache:!1,data:{},success:function(t){if(t){var a="";e.each(t,function(e){t[e]&&t[e].length>1&&(a+='<option value="'+t[e][0]+'">'+t[e][1]+"</option>")});var r=o.parents("div.combox:first");o.html(a).insertAfter(r),r.remove(),o.trigger("refChange").trigger("change").combox()}},error:DWZ.ajaxError})})})}})}(jQuery);