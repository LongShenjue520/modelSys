!function(e,Z){if(window.xheditor)return!1;var ia=navigator.userAgent.toLowerCase(),Ca=-1!==ia.indexOf("mobile"),H=e.browser,qa=parseFloat(H.version),j=H.msie,ra=H.mozilla,Q=H.safari,Ra=H.opera,eb=-1<ia.indexOf(" adobeair/");e.fn.xheditor=function(j){if(Ca)return!1;var n=[];return this.each(function(){if(e.nodeName(this,"TEXTAREA"))if(!1===j)this.xheditor&&(this.xheditor.remove(),this.xheditor=null);else if(this.xheditor)n.push(this.xheditor);else{var o=/({.*})/.exec(e(this).attr("class"));if(o){try{o=eval("("+o[1]+")")}catch(t){}j=e.extend({},o,j)}o=new sa(this,j),o.init()&&(this.xheditor=o,n.push(o))}}),0===n.length&&(n=!1),1===n.length&&(n=n[0]),n};var $=0,R=!1,ta=!0,ua=!1,Sa=!1,t,aa,ba,ca,I,Da,da,Ea,Fa,Ga,J;if(e("script[src*=xheditor]").each(function(){var e=this.src;return e.match(/xheditor[^\/]*\.js/i)?(J=e.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"$1"),!1):void 0}),j)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(rb){}var fb={27:"esc",9:"tab",32:"space",13:"enter",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},Ta="#FFFFFF,#CCCCCC,#C0C0C0,#999999,#666666,#333333,#000000,#FFCCCC,#FF6666,#FF0000,#CC0000,#990000,#660000,#330000,#FFCC99,#FF9966,#FF9900,#FF6600,#CC6600,#993300,#663300,#FFFF99,#FFFF66,#FFCC66,#FFCC33,#CC9933,#996633,#663333,#FFFFCC,#FFFF33,#FFFF00,#FFCC00,#999900,#666600,#333300,#99FF99,#66FF99,#33FF33,#33CC00,#009900,#006600,#003300,#99FFFF,#33FFFF,#66CCCC,#00CCCC,#339999,#336666,#003333,#CCFFFF,#66FFFF,#33CCFF,#3366FF,#3333FF,#000099,#000066,#CCCCFF,#9999FF,#6666CC,#6633FF,#6600CC,#333399,#330099,#FFCCFF,#FF99FF,#CC66CC,#CC33CC,#993399,#663366,#330033".split(","),gb=[{n:"p",t:"Paragraph"},{n:"h1",t:"Heading 1"},{n:"h2",t:"Heading 2"},{n:"h3",t:"Heading 3"},{n:"h4",t:"Heading 4"},{n:"h5",t:"Heading 5"},{n:"h6",t:"Heading 6"},{n:"pre",t:"Preformatted"},{n:"address",t:"Address"}],hb=[{n:"Arial"},{n:"Arial Black"},{n:"Comic Sans MS"},{n:"Courier New"},{n:"System"},{n:"Times New Roman"},{n:"Tahoma"},{n:"Verdana"}],S=[{n:"x-small",s:"10px",t:"1"},{n:"small",s:"13px",t:"2"},{n:"medium",s:"16px",t:"3"},{n:"large",s:"18px",t:"4"},{n:"x-large",s:"24px",t:"5"},{n:"xx-large",s:"32px",t:"6"},{n:"-webkit-xxx-large",s:"48px",t:"7"}],ib=[{s:"Align left",v:"justifyleft"},{s:"Align center",v:"justifycenter"},{s:"Align right",v:"justifyright"},{s:"Align full",v:"justifyfull"}],jb=[{s:"Ordered list",v:"insertOrderedList"},{s:"Unordered list",v:"insertUnorderedList"}],kb={"default":{name:"Default",width:24,height:24,line:7,list:{smile:"Smile",tongue:"Tongue",titter:"Titter",laugh:"Laugh",sad:"Sad",wronged:"Wronged",fastcry:"Fast cry",cry:"Cry",wail:"Wail",mad:"Mad",knock:"Knock",curse:"Curse",crazy:"Crazy",angry:"Angry",ohmy:"Oh my",awkward:"Awkward",panic:"Panic",shy:"Shy",cute:"Cute",envy:"Envy",proud:"Proud",struggle:"Struggle",quiet:"Quiet",shutup:"Shut up",doubt:"Doubt",despise:"Despise",sleep:"Sleep",bye:"Bye"}}},ja={Cut:{t:"Cut (Ctrl+X)"},Copy:{t:"Copy (Ctrl+C)"},Paste:{t:"Paste (Ctrl+V)"},Pastetext:{t:"Paste as plain text",h:j?0:1},Blocktag:{t:"Block tag",h:1},Fontface:{t:"Font family",h:1},FontSize:{t:"Font size",h:1},Bold:{t:"Bold (Ctrl+B)",s:"Ctrl+B"},Italic:{t:"Italic (Ctrl+I)",s:"Ctrl+I"},Underline:{t:"Underline (Ctrl+U)",s:"Ctrl+U"},Strikethrough:{t:"Strikethrough"},FontColor:{t:"Select text color",h:1},BackColor:{t:"Select background color",h:1},SelectAll:{t:"SelectAll (Ctrl+A)"},Removeformat:{t:"Remove formatting"},Align:{t:"Align",h:1},List:{t:"List",h:1},Outdent:{t:"Outdent"},Indent:{t:"Indent"},Link:{t:"Insert/edit link (Ctrl+L)",s:"Ctrl+L",h:1},Unlink:{t:"Unlink"},Anchor:{t:"Anchor",h:1},Img:{t:"Insert/edit image",h:1},Flash:{t:"Insert/edit flash",h:1},Media:{t:"Insert/edit media",h:1},Hr:{t:"Horizontal rule"},Emot:{t:"Emotions",s:"ctrl+e",h:1},Table:{t:"Insert a new table",h:1},Source:{t:"Edit source code"},Preview:{t:"Preview"},Print:{t:"Print (Ctrl+P)",s:"Ctrl+P"},Fullscreen:{t:"Toggle fullscreen (Esc)",s:"Esc"},About:{t:"About xhEditor"}},Ha={mini:"Bold,Italic,Underline,Strikethrough,|,Align,List,|,Link,Img",simple:"Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,|,Link,Img,Emot",full:"Cut,Copy,Paste,Pastetext,|,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,SelectAll,Removeformat,|,Align,List,Outdent,Indent,|,Link,Unlink,Anchor,Img,Flash,Media,Hr,Emot,Table,|,Source,Preview,Print,Fullscreen"};Ha.mfull=Ha.full.replace(/\|(,Align)/i,"/$1");var lb={a:"Link",img:"Img",embed:"Embed"},mb={"<":"&lt;",">":"&gt;",'"':"&quot;","®":"&reg;","©":"&copy;"},nb=/[<>"\u00ae\u00a9]/g,sa=function(z,n){function o(e){var e=e.target,t=lb[e.tagName.toLowerCase()];t&&("Embed"===t&&(t={"application/x-shockwave-flash":"Flash","application/x-mplayer2":"Media"}[e.type.toLowerCase()]),c.exec(t))}function H(e){return 27===e.which?(ua?c.removeModal():R&&c.hidePanel(),!1):void 0}function ia(){setTimeout(c.setSource,10)}function T(){c.getSource()}function Ua(t){var a,n,i;if(t&&(a=t.originalEvent.clipboardData)&&(n=a.items)&&(i=n[0])&&"file"==i.kind&&i.type.match(/^image\//i))return t=i.getAsFile(),a=new FileReader,a.onload=function(){var e='<img src="'+event.target.result+'">',e=Va(e);c.pasteHTML(e)},a.readAsDataURL(t),!1;var s=g.cleanPaste;if(0===s||x||Ia)return!0;Ia=!0,c.saveBookmark();var t=j?"pre":"div",o=e("<"+t+' class="xhe-paste">\ufeff\ufeff</'+t+">",l).appendTo(l.body),t=o[0];a=c.getSel(),n=c.getRng(!0),o.css("top",ea.scrollTop()),j?(n.moveToElementText(t),n.select()):(n.selectNodeContents(t),a.removeAllRanges(),a.addRange(n)),setTimeout(function(){var t,a=3===s;if(a)t=o.text();else{var n=[];e(".xhe-paste",l.body).each(function(t,a){0==e(a).find(".xhe-paste").length&&n.push(a.innerHTML)}),t=n.join("<br />")}o.remove(),c.loadBookmark(),(t=t.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,""))&&(a?c.pasteText(t):(t=c.cleanHTML(t),t=c.cleanWord(t),t=c.formatXHTML(t),(!g.onPaste||g.onPaste&&!1!==(t=g.onPaste(t)))&&(t=Va(t),c.pasteHTML(t)))),Ia=!1},0)}function Va(t){var a=g.localUrlTest,n=g.remoteImgSaveUrl;if(a&&n){var i=[],s=0,t=t.replace(/(<img)((?:\s+[^>]*?)?(?:\s+src="\s*([^"]+)\s*")(?: [^>]*)?)(\/?>)/gi,function(e,t,n,l,o){return/^(https?|data:image)/i.test(l)&&!a.test(l)&&(i[s]=l,n=n.replace(/\s+(width|height)="[^"]*"/gi,"").replace(/\s+src="[^"]*"/gi,' src="'+va+'img/waiting.gif" remoteimg="'+s++ +'"')),t+n+o});0<i.length&&e.post(n,{urls:i.join("|")},function(t){t=t.split("|"),e("img[remoteimg]",c.doc).each(function(){var a=e(this);K(a,"src",t[a.attr("remoteimg")]),a.removeAttr("remoteimg")})})}return t}function Ja(e){try{c._exec("styleWithCSS",e,!0)}catch(t){try{c._exec("useCSS",!e,!0)}catch(a){}}}function Ka(){if(La&&!x){Ja(!1);try{c._exec("enableObjectResizing",!0,!0)}catch(e){}if(j)try{c._exec("BackgroundImageCache",!0,!0)}catch(t){}}}function Ca(e){return x||13!==e.which||e.shiftKey||e.ctrlKey||e.altKey?!0:(e=c.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li"),e.is("li")?!0:g.forcePtag?void(0===e.length&&c._exec("formatblock","<p>")):(c.pasteHTML("<br />"),j&&0<e.length&&2===c.getRng().parentElement().childNodes.length&&c.pasteHTML("<br />"),!1))}function Ma(){!ra&&!Q&&(ka&&A.height("100%").css("height",A.outerHeight()-q.outerHeight()),j&&q.hide().show())}function ob(e){if(e=e.target,e.tagName.match(/(img|embed)/i)){var t=c.getSel(),a=c.getRng(!0);a.selectNode(e),t.removeAllRanges(),t.addRange(a)}}function K(e,t,a){if(!t)return!1;var n="_xhe_"+t;return a&&(wa&&(a=U(a,wa,E)),e.attr(t,E?U(a,"abs",E):a).removeAttr(n).attr(n,a)),e.attr(n)||e.attr(t)}function Na(){ta&&c.hidePanel()}function pb(t){if(x)return!0;var a=t.which,n=fb[a],a=n?n:String.fromCharCode(a).toLowerCase();sKey="",sKey+=t.ctrlKey?"ctrl+":"",sKey+=t.altKey?"alt+":"",sKey+=t.shiftKey?"shift+":"",sKey+=a;var i,t=la[sKey];for(i in t){if(i=t[i],!e.isFunction(i))return c.exec(i),!1;if(!1===i.call(c))return!1}}function L(e,t){var a=typeof e;return t?"array"===t&&e.hasOwnProperty&&e instanceof Array?!0:a===t:"undefined"!=a}function U(t,a,n){if(t.match(/^(\w+):\/\//i)&&!t.match(/^https?:/i)||/^#/i.test(t)||/^data:/i.test(t))return t;var i=n?e('<a href="'+n+'" />')[0]:location,n=i.protocol,s=i.host,l=i.hostname,o=i.port,i=i.pathname.replace(/\\/g,"/").replace(/[^\/]+$/i,"");if(""===o&&(o="80"),""===i?i="/":"/"!==i.charAt(0)&&(i="/"+i),t=e.trim(t),"abs"!==a&&(t=t.replace(RegExp(n+"\\/\\/"+l.replace(/\./g,"\\.")+"(?::"+o+")"+("80"===o?"?":"")+"(/|$)","i"),"/")),"rel"===a&&(t=t.replace(RegExp("^"+i.replace(/([\/\.\+\[\]\(\)])/g,"\\$1"),"i"),"")),"rel"!==a&&(t.match(/^(https?:\/\/|\/)/i)||(t=i+t),"/"===t.charAt(0))){for(var l=[],t=t.split("/"),r=t.length,i=0;r>i;i++)o=t[i],".."===o?l.pop():""!==o&&"."!==o&&l.push(o);""===t[r-1]&&l.push(""),t="/"+l.join("/")}return"abs"===a&&!t.match(/^https?:\/\//i)&&(t=n+"//"+s+t),t=t.replace(/(https?:\/\/[^:\/?#]+):80(\/|$)/i,"$1$2")}function Wa(e,t){return"*"===t||e.match(RegExp(".("+t.replace(/,/g,"|")+")$","i"))?!0:(alert("Upload file extension required for this: "+t),!1)}function Xa(e){var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(t))).toFixed(2)+"Byte,KB,MB,GB,TB,PB".split(",")[t]}function M(){return!1}var c=this,y=e(z),Ya=y.closest("form"),q,A,V,ea,l,fa,ma=y.offsetParent().css("zIndex"),ga,La=!1,x=!1,ka=!1,Ia=!1,Oa,na=!1,Za="",w=null,xa,oa=!1,Pa=!1,ha=null,W=null,N=0,g=c.settings=e.extend({},sa.settings,n),ya=g.plugins,za=[];if(ya&&(ja=e.extend({},ja,ya),e.each(ya,function(e){za.push(e)}),za=za.join(",")),g.tools.match(/^\s*(m?full|simple|mini)\s*$/i)){var $a=Ha[e.trim(g.tools)];g.tools=g.tools.match(/m?full/i)&&ya?$a.replace("Table","Table,"+za):$a}g.tools.match(/(^|,)\s*About\s*(,|$)/i)||(g.tools+=",About"),g.tools=g.tools.split(","),g.editorRoot&&(J=g.editorRoot),!1===eb&&(J=U(J,"abs")),g.urlBase&&(g.urlBase=U(g.urlBase,"abs"));var ab="xheCSS_"+g.skin,pa="xhe"+$+"_container",bb="xhe"+$+"_Tool",cb="xhe"+$+"_iframearea",db="xhe"+$+"_iframe",Aa="xhe"+$+"_fixffcursor",O="",P="",va=J+"xheditor_skin/"+g.skin+"/",Ba=kb,wa=g.urlType,E=g.urlBase,X=g.emotPath,X=X?X:J+"xheditor_emot/",Qa="",Ba=e.extend({},Ba,g.emots),X=U(X,"rel",E?E:null);(na=g.showBlocktag)&&(P+=" showBlocktag");var la=[];this.init=function(){0===e("#"+ab).length&&e("head").append('<link id="'+ab+'" rel="stylesheet" type="text/css" href="'+va+'ui.css" />');var a=y.outerWidth(),n=y.outerHeight(),a=g.width||z.style.width||(a>10?a:0);N=g.height||z.style.height||(n>10?n:150),L(a,"number")&&(a+="px"),L(N,"string")&&(N=N.replace(/[^\d]+/g,""));var i,s,n=g.background||z.style.background,r=['<span class="xheGStart"/>'],h=/\||\//i;if(e.each(g.tools,function(e,t){if(t.match(h)&&r.push('<span class="xheGEnd"/>'),"|"===t)r.push('<span class="xheSeparator"/>');else if("/"===t)r.push("<br />");else{if(i=ja[t],!i)return;s=i.c?i.c:"xheIcon xheBtn"+t,r.push('<span><a href="#" title="'+i.t+'" cmd="'+t+'" class="xheButton xheEnabled" tabindex="-1" role="button"><span class="'+s+'" unselectable="on" style="font-size:0;color:transparent;text-indent:-999px;">'+i.t+"</span></a></span>"),i.s&&c.addShortcuts(i.s,t)}t.match(h)&&r.push('<span class="xheGStart"/>')}),r.push('<span class="xheGEnd"/><br />'),y.after(e('<input type="text" id="'+Aa+'" style="position:absolute;display:none;" /><span id="'+pa+'" class="xhe_'+g.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xheLayout" style="'+("0px"!=a?"width:"+a+";":"")+"height:"+N+'px;" role="presentation"><tr><td id="'+bb+'" class="xheTool" unselectable="on" style="height:1px;" role="presentation"></td></tr><tr><td id="'+cb+'" class="xheIframeArea" role="presentation"><iframe frameborder="0" id="'+db+'" src="javascript:;" style="width:100%;"></iframe></td></tr></table></span>')),q=e("#"+bb),A=e("#"+cb),O='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" href="'+va+'iframe.css"/>',a=g.loadCSS)if(L(a,"array"))for(var d in a)O+='<link rel="stylesheet" href="'+a[d]+'"/>';else O=a.match(/\s*<style(\s+[^>]*?)?>[\s\S]+?<\/style>\s*/i)?O+a:O+('<link rel="stylesheet" href="'+a+'"/>');d="<html><head>"+O+"<title>WYSIWYG Editor,press alt+1-9,toogle to tool area,press tab,select button,press esc,return editor "+(g.readTip?g.readTip:"")+"</title>",n&&(d+="<style>html{background:"+n+";}</style>"),d+='</head><body spellcheck="0" class="editMode'+P+'"></body></html>',c.win=V=e("#"+db)[0].contentWindow,ea=e(V);try{this.doc=l=V.document,fa=e(l),l.open(),l.write(d),l.close(),j?l.body.contentEditable="true":l.designMode="On"}catch(u){}if(setTimeout(Ka,300),c.setSource(),V.setInterval=null,q.append(r.join("")).bind("mousedown contextmenu",M).click(function(t){var a=e(t.target).closest("a");return a.is(".xheEnabled")&&(clearTimeout(xa),q.find("a").attr("tabindex","-1"),w=t,c.exec(a.attr("cmd"))),!1}),q.find(".xheButton").hover(function(t){var a=e(this),n=g.hoverExecDelay,i=W;if(W=null,-1===n||oa||!a.is(".xheEnabled"))return!1;if(i&&i>10)return oa=!0,setTimeout(function(){oa=!1},100),!1;var s=a.attr("cmd");return 1!==ja[s].h?(c.hidePanel(),!1):(Pa&&(n=0),void(n>=0&&(xa=setTimeout(function(){w=t,ha={x:w.clientX,y:w.clientY},c.exec(s)},n))))},function(){ha=null,xa&&clearTimeout(xa)}).mousemove(function(e){if(ha){var t=e.clientX-ha.x,a=e.clientY-ha.y;(1<Math.abs(t)||1<Math.abs(a))&&(t>0&&a>0?(t=Math.round(Math.atan(a/t)/.017453293),W=W?(W+t)/2:t):W=null,ha={x:e.clientX,y:e.clientY})}}),t=e("#xhePanel"),aa=e("#xheShadow"),ba=e("#xheCntLine"),0===t.length&&(t=e('<div id="xhePanel"></div>').mousedown(function(e){e.stopPropagation()}),aa=e('<div id="xheShadow"></div>'),ba=e('<div id="xheCntLine"></div>'),setTimeout(function(){e(document.body).append(t).append(aa).append(ba)},10)),e("#"+pa).show(),y.hide(),A.css("height",N-q.outerHeight()),j&8>qa&&setTimeout(function(){A.css("height",N-q.outerHeight())},1),y.focus(c.focus),Ya.submit(T).bind("reset",ia),g.submitID&&e("#"+g.submitID).click(T),e(window).bind("unload beforeunload",T).bind("resize",Ma),e(document).mousedown(Na),Sa||(e(document).keydown(H),Sa=!0),ea.focus(function(){g.focus&&g.focus()}).blur(function(){g.blur&&g.blur()}),Q&&ea.click(ob),fa.mousedown(Na).keydown(pb).keypress(Ca).dblclick(o).bind("mousedown click",function(e){y.trigger(e.type)}),j){fa.keydown(function(t){var a=c.getRng();return 8===t.which&&a.item?(e(a.item(0)).remove(),!1):void 0});var p=function(t){var a,t=e(t.target);(a=t.css("width"))&&t.css("width","").attr("width",a.replace(/[^0-9%]+/g,"")),(a=t.css("height"))&&t.css("height","").attr("height",a.replace(/[^0-9%]+/g,""))};fa.bind("controlselect",function(t){t=t.target,e.nodeName(t,"IMG")&&e(t).unbind("resizeend",p).bind("resizeend",p)})}return fa.keydown(function(e){var t=e.which;return e.altKey&&t>=49&&57>=t?(q.find("a").attr("tabindex","0"),q.find(".xheGStart").eq(t-49).next().find("a").focus(),l.title="\ufeff\ufeff",!1):void 0}).click(function(){q.find("a").attr("tabindex","-1")}),q.keydown(function(e){var t=e.which;if(27==t)q.find("a").attr("tabindex","-1"),c.focus();else if(e.altKey&&t>=49&&57>=t)return q.find(".xheGStart").eq(t-49).next().find("a").focus(),!1}),d=e(l.documentElement),Ra?d.bind("keydown",function(e){e.ctrlKey&&86===e.which&&Ua()}):d.bind(j?"beforepaste":"paste",Ua),g.disableContextmenu&&d.bind("contextmenu",M),g.html5Upload&&d.bind("dragenter dragover",function(t){var a;return(a=t.originalEvent.dataTransfer.types)&&-1!==e.inArray("Files",a)?!1:void 0}).bind("drop",function(t){var a,t=t.originalEvent.dataTransfer;if(t&&(a=t.files)&&0<a.length){var n,i,s,t=["Link","Img","Flash","Media"],l=[];for(n in t)i=t[n],g["up"+i+"Url"]&&g["up"+i+"Url"].match(/^[^!].*/i)&&l.push(i+":,"+g["up"+i+"Ext"]);return 0===l.length?!1:(s=l.join(","),i=function(e){var t,a;for(n=0;n<e.length;n++){if(t=e[n].name.replace(/.+\./,""),!(t=s.match(RegExp("(\\w+):[^:]*,"+t+"(?:,|$)","i"))))return 1;if(a){if(a!==t[1])return 2}else a=t[1]}return a}(a),1===i?alert("Upload file extension required for this: "+s.replace(/\w+:,/g,"")):2===i?alert("You can only drag and drop the same type of file."):i&&c.startUpload(a,g["up"+i+"Url"],"*",function(t){var a,n=[];(a=g.onUpload)&&a(t);for(var s=0,l=t.length;l>s;s++)a=t[s],url=L(a,"string")?a:a.url,"!"===url.substr(0,1)&&(url=url.substr(1)),n.push(url);c.exec(i),e("#xhe"+i+"Url").val(n.join(" ")),e("#xheSave").click()}),!1)}}),(d=g.shortcuts)&&e.each(d,function(e,t){c.addShortcuts(e,t)}),$++,La=!0,g.fullscreen?c.toggleFullscreen():g.sourceMode&&setTimeout(c.toggleSource,20),!0},this.remove=function(){c.hidePanel(),T(),y.unbind("focus",c.focus),Ya.unbind("submit",T).unbind("reset",ia),g.submitID&&e("#"+g.submitID).unbind("mousedown",T),e(window).unbind("unload beforeunload",T).unbind("resize",Ma),e(document).unbind("mousedown",Na),e("#"+pa).remove(),e("#"+Aa).remove(),y.show(),La=!1},this.saveBookmark=function(){if(!x){c.focus();var e=c.getRng(),e=e.cloneRange?e.cloneRange():e;ga={top:ea.scrollTop(),rng:e}}},this.loadBookmark=function(){if(!x&&ga){c.focus();var e=ga.rng;if(j)e.select();else{var t=c.getSel();t.removeAllRanges(),t.addRange(e)}ea.scrollTop(ga.top),ga=null}},this.focus=function(){if(x?e("#sourceCode",l).focus():V.focus(),j){var t=c.getRng();t.parentElement&&t.parentElement().ownerDocument!==l&&c.setTextCursor()}return!1},this.setTextCursor=function(e){var t=c.getRng(!0),a=l.body;if(j)t.moveToElementText(a);else{for(var n=e?"lastChild":"firstChild";3!=a.nodeType&&a[n];)a=a[n];t.selectNode(a)}t.collapse(e?!1:!0),j?t.select():(e=c.getSel(),e.removeAllRanges(),e.addRange(t))},this.getSel=function(){return l.selection?l.selection:V.getSelection()},this.getRng=function(e){var t,a;try{e||(t=c.getSel(),a=t.createRange?t.createRange():0<t.rangeCount?t.getRangeAt(0):null),a||(a=l.body.createTextRange?l.body.createTextRange():l.createRange())}catch(n){}return a},this.getParent=function(t){var a,n=c.getRng();return j?a=n.item?n.item(0):n.parentElement():(a=n.commonAncestorContainer,n.collapsed||n.startContainer===n.endContainer&&2>n.startOffset-n.endOffset&&n.startContainer.hasChildNodes()&&(a=n.startContainer.childNodes[n.startOffset])),t=t?t:"*",a=e(a),a.is(t)||(a=e(a).closest(t)),a},this.getSelect=function(t){var a=c.getSel(),n=c.getRng(),i=!0,i=!n||n.item?!1:!a||0===n.boundingWidth||n.collapsed;return"text"===t?i?"":n.text||(a.toString?a.toString():""):(n.cloneContents?(t=e("<div></div>"),(n=n.cloneContents())&&t.append(n),n=t.html()):n=L(n.item)?n.item(0).outerHTML:L(n.htmlText)?n.htmlText:n.toString(),i&&(n=""),n=c.processHTML(n,"read"),n=c.cleanHTML(n),n=c.formatXHTML(n))},this.pasteHTML=function(t,a){if(x)return!1;c.focus();var t=c.processHTML(t,"write"),n=c.getSel(),i=c.getRng();if(a!==Z){if(i.item){var s=i.item(0),i=c.getRng(!0);i.moveToElementText(s),i.select()}i.collapse(a)}if(t+="<"+(j?"img":"span")+' id="_xhe_temp" width="0" height="0" />',i.insertNode){if(0<e(i.startContainer).closest("style,script").length)return!1;i.deleteContents(),i.insertNode(i.createContextualFragment(t))}else"control"===n.type.toLowerCase()&&(n.clear(),i=c.getRng()),i.pasteHTML(t);var s=e("#_xhe_temp",l),o=s[0];j?(i.moveToElementText(o),i.select()):(i.selectNode(o),n.removeAllRanges(),n.addRange(i)),s.remove()},this.pasteText=function(e,t){e||(e=""),e=c.domEncode(e),e=e.replace(/\r?\n/g,"<br />"),c.pasteHTML(e,t)},this.appendHTML=function(t){return x?!1:(c.focus(),t=c.processHTML(t,"write"),e(l.body).append(t),void c.setTextCursor(!0))},this.domEncode=function(e){return e.replace(nb,function(e){return mb[e]})},this.setSource=function(t){ga=null,"string"!=typeof t&&""!==t&&(t=z.value),x?e("#sourceCode",l).val(t):(g.beforeSetSource&&(t=g.beforeSetSource(t)),t=c.cleanHTML(t),t=c.formatXHTML(t),t=c.processHTML(t,"write"),j?(l.body.innerHTML='<img id="_xhe_temp" width="0" height="0" />'+t,e("#_xhe_temp",l).remove()):l.body.innerHTML=t)},this.processHTML=function(e,t){if("write"===t){if(e=e.replace(/(<(\/?)(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*((\/?)>)/g,function(e,t,a,n,i,s,l){n=n.toLowerCase(),ra?"strong"===n?n="b":"em"===n&&(n="i"):Q&&("strong"===n?(n="span",a||(i+=' class="Apple-style-span" style="font-weight: bold;"')):"em"===n?(n="span",a||(i+=' class="Apple-style-span" style="font-style: italic;"')):"u"===n?(n="span",a||(i+=' class="Apple-style-span" style="text-decoration: underline;"')):"strike"===n&&(n="span",a||(i+=' class="Apple-style-span" style="text-decoration: line-through;"')));var o,r="";"del"===n?n="strike":"img"===n?i=i.replace(/\s+emot\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(e,t){return o=t.match(/^(["']?)(.*)\1/)[2],o=o.split(","),o[1]||(o[1]=o[0],o[0]=""),"default"===o[0]&&(o[0]=""),g.emotMark?e:""}):"a"===n?(!i.match(/ href=[^ ]/i)&&i.match(/ name=[^ ]/i)&&(r+=" xhe-anchor"),l&&(s="></a>")):"table"!==n||a||(e=i.match(/\s+border\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i),e&&!e[1].match(/^(["']?)\s*0\s*\1$/))||(r+=" xhe-border");var c,i=i.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(e,t,a){return t=t.toLowerCase(),a=a.match(/^(["']?)(.*)\1/)[2],aft="",j&&t.match(/^(disabled|checked|readonly|selected)$/)&&a.match(/^(false|0)$/i)||"img"===n&&o&&"src"===t?"":(t.match(/^(src|href)$/)&&(aft=" _xhe_"+t+'="'+a+'"',E&&(a=U(a,"abs",E))),r&&"class"===t&&(a+=" "+r,r=""),Q&&"style"===t&&"span"===n&&a.match(/(^|;)\s*(font-family|font-size|color|background-color)\s*:\s*[^;]+\s*(;|$)/i)&&(c=!0)," "+t+'="'+a+'"'+aft)});return o&&(e=X+(o[0]?o[0]:"default")+"/"+o[1]+".gif",i+=' src="'+e+'" _xhe_src="'+e+'"'),c&&(i+=' class="Apple-style-span"'),r&&(i+=' class="'+r+'"'),"<"+a+n+i+s}),j&&(e=e.replace(/&apos;/gi,"&#39;")),!Q)var a=function(e,t,a,n){var i,s,t="";if((i=a.match(/font-family\s*:\s*([^;"]+)/i))&&(t+=' face="'+i[1]+'"'),i=a.match(/font-size\s*:\s*([^;"]+)/i)){i=i[1].toLowerCase();for(var l=0;l<S.length;l++)if(i===S[l].n||i===S[l].s){s=l+1;break}s&&(t+=' size="'+s+'"',a=a.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/gi,"$1"))}if(s=a.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i)){if(i=s[1].match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i))for(s[1]="#",l=1;3>=l;l++)s[1]+=(i[l]-0).toString(16);s[1]=s[1].replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3"),t+=' color="'+s[1]+'"'}return a=a.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/gi,"$1"),""!==t?(a&&(t+=' style="'+a+'"'),"<font"+t+">"+n+"</font>"):e},e=e.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,a),e=e.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,a),e=e.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,a);e=e.replace(/<(td|th)(\s+[^>]*?)?>(\s|&nbsp;)*<\/\1>/gi,"<$1$2>"+(j?"":"<br />")+"</$1>")}else{if(Q)for(var n=[{r:/font-weight:\sbold/gi,t:"strong"},{r:/font-style:\sitalic/gi,t:"em"},{r:/text-decoration:\sunderline/gi,t:"u"},{r:/text-decoration:\sline-through/gi,t:"strike"}],a=function(e,t,a,i,s){if(t=a+i,a="",!t)return s;for(i=0;i<n.length;i++)if(t.match(n[i].r)){a=n[i].t;break}return a?"<"+a+">"+s+"</"+a+">":e},i=0;2>i;i++)e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,a),e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,a),e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,a);e=e.replace(/(<(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/g,function(e,t,a,n,i){var s,a=a.toLowerCase(),n=n.replace(/\s+_xhe_(?:src|href)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(e,t){return s=t.match(/^(["']?)(.*)\1/)[2],""});return s&&wa&&(s=U(s,wa,E)),n=n.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(e,t,a){if(t=t.toLowerCase(),a=a.match(/^(["']?)(.*)\1/)[2],"class"===t){if(a.match(/^["']?(apple|webkit)/i))return"";if(a=a.replace(/\s?xhe-[a-z]+/gi,""),""===a)return""}else{if(t.match(/^((_xhe_|_moz_|_webkit_)|jquery\d+)/i))return"";if(s&&t.match(/^(src|href)$/i))return" "+t+'="'+s+'"';"style"===t&&(a=a.replace(/(^|;)\s*(font-size)\s*:\s*([a-z-]+)\s*(;|$)/i,function(e,t,a,n,i){for(var s,l=0;l<S.length;l++)if(e=S[l],n===e.n){s=e.s;break}return t+a+":"+s+i}))}return" "+t+'="'+a+'"'}),"img"===a&&!n.match(/\s+alt\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i)&&(n+=' alt=""'),t+n+i}),e=e.replace(/(<(td|th)(?:\s+[^>]*?)?>)\s*([\s\S]*?)(<br(\s*\/)?>)?\s*<\/\2>/gi,function(e,t,a,n){return t+(n?n:"&nbsp;")+"</"+a+">"}),e=e.replace(/^\s*(?:<(p|div)(?:\s+[^>]*?)?>)?\s*(<span(?:\s+[^>]*?)?>\s*<\/span>|<br(?:\s+[^>]*?)?>|&nbsp;)*\s*(?:<\/\1>)?\s*$/i,"")}return e=e.replace(/(<pre(?:\s+[^>]*?)?>)([\s\S]+?)(<\/pre>)/gi,function(e,t,a,n){return t+a.replace(/<br\s*\/?>/gi,"\r\n")+n})},this.getSource=function(t){var a,n=g.beforeGetSource;return x?(a=e("#sourceCode",l).val(),n||(a=c.formatXHTML(a,!1))):(a=c.processHTML(l.body.innerHTML,"read"),a=c.cleanHTML(a),a=c.formatXHTML(a,t),n&&(a=n(a))),z.value=a},this.cleanWord=function(t){var a=g.cleanPaste;if(a>0&&3>a&&t.match(/mso(-|normal)|WordDocument|<table\s+[^>]*?x:str/i))for(var t=t.replace(/<\!--[\s\S]*?--\>|<!(--)?\[[\s\S]+?\](--)?>|<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,""),t=t.replace(/\r?\n/gi,""),t=t.replace(/(<(\/?)([\w\-:]+))((?:\s+[\w\-:]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))?)*)\s*(\/?>)/g,function(t,n,i,s,l,o){return s=s.toLowerCase(),s.match(/^(link|img)$/)&&l.match(/file:\/\//i)||s.match(/:/)||"span"===s&&2===a?"":(i||(l=l.replace(/\s([\w\-:]+)(?:\s*=\s*("[^"]*"|'[^']*'|[^>\s]+))?/gi,function(t,n,i){return n=n.toLowerCase(),i=i.match(/^(["']?)(.*)\1/)[2],n.match(/:/)||n.match(/^(class|lang|language|span)$/)||"td"===s&&("height"===n||"width"===n&&!l.match(/\scolspan="\d+"/i))?"":"style"===n?2===a?"":(i=e.trim(i.replace(/\s*(mso-[^:]+:.+?|margin\s*:\s*0cm 0cm 0pt\s*|(text-align|font-variant|line-height)\s*:\s*.+?)(;|$)\s*/gi,"")))?" "+n+'="'+i.replace(/"/g,"'")+'"':"":t})),n+l+o)}),n=0;3>n;n++)t=t.replace(/<([^\s>]+)(\s+[^>]*)?>\s*<\/\1>/g,function(e,t){return t.match(/^a$/i)?e:""});return t},this.cleanHTML=function(e){var t,e=e.replace(/<!?\/?(DOCTYPE|html|body|meta)(\s+[^>]*?)?>/gi,""),e=e.replace(/<head(?:\s+[^>]*?)?>([\s\S]*?)<\/head>/i,function(e,a){return t=a.match(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/gi),""});return t&&(e=t.join("")+e),e=e.replace(/<\??xml(:\w+)?(\s+[^>]*?)?>([\s\S]*?<\/xml>)?/gi,""),g.internalScript||(e=e.replace(/<script(\s+[^>]*?)?>[\s\S]*?<\/script>/gi,"")),g.internalStyle||(e=e.replace(/<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,"")),g.linkTag&&g.inlineScript&&g.inlineStyle||(e=e.replace(/(<(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/gi,function(e,t,a,n,i){return g.linkTag||"link"!==a.toLowerCase()?(g.inlineScript||(n=n.replace(/\s+on(?:click|dblclick|mouse(down|up|move|over|out|enter|leave|wheel)|key(down|press|up)|change|select|submit|reset|blur|focus|load|unload)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"")),g.inlineStyle||(n=n.replace(/\s+(style|class)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"")),t+n+i):""})),e=e.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1(\s+[^>]*?)?>/gi,"$2")},this.formatXHTML=function(e,t){function a(e){for(var t={},e=e.split(","),a=0;a<e.length;a++)t[e[a]]=!0;return t}function n(e){var e=e.toLowerCase(),t=v[e];return t?t:e}function i(e,t,a){if(p[e])for(;k.last()&&g[k.last()];)s(k.last());f[e]&&k.last()===e&&s(e),(a=u[e]||!!a)||k.push(e);var n=[];n.push("<"+e),t.replace(y,function(e,t,a,i,s){t=t.toLowerCase(),n.push(" "+t+'="'+(a?a:i?i:s?s:m[t]?t:"").replace(/"/g,"'")+'"')}),n.push((a?" /":"")+">"),r(n.join(""),e,!0),"pre"===e&&(j=!0)}function s(e){if(e)for(t=k.length-1;t>=0&&k[t]!==e;t--);else var t=0;if(t>=0){for(var a=k.length-1;a>=t;a--)r("</"+k[a]+">",k[a]);k.length=t}"pre"===e&&(j=!1,A--)}function l(e){r(c.domEncode(e))}function o(e){w.push(e.replace(/^[\s\r\n]+|[\s\r\n]+$/g,""))}function r(e,a,n){if(j||(e=e.replace(/(\t*\r?\n\t*)+/g,"")),j||!0!==t)w.push(e);else if(e.match(/^\s*$/))w.push(e);else{var i=p[a];i?(n&&A++,""===H&&A--):H&&A++,((i?a:"")!==H||i)&&h(),w.push(e),"br"===a&&h(),i&&(u[a]||!n)&&A--,H=i?a:""}}function h(){if(w.push("\r\n"),A>0)for(var e=A;e--;)w.push("	")}function d(e,t,a,n){return a?(e="",(t=a.match(/ face\s*=\s*"\s*([^"]+)\s*"/i))&&(e+="font-family:"+t[1]+";"),(t=a.match(/ size\s*=\s*"\s*(\d+)\s*"/i))&&(e+="font-size:"+S[(7<t[1]?7:1>t[1]?1:t[1])-1].s+";"),(t=a.match(/ color\s*=\s*"\s*([^"]+)\s*"/i))&&(e+="color:"+t[1]+";"),(a=a.match(/ style\s*=\s*"\s*([^"]+)\s*"/i))&&(e+=a[1]),e&&(n='<span style="'+e+'">'+n+"</span>"),n):n}var u=a("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),p=a("address,applet,blockquote,button,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,table,tbody,td,tfoot,th,thead,tr,ul,script"),g=a("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),f=a("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),m=a("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),b=a("script,style"),v={b:"strong",i:"em",s:"del",strike:"del"},x=/<(?:\/([^\s>]+)|!([^>]*?)|([\w\-:]+)((?:"[^"]*"|'[^']*'|[^"'<>])*)\s*(\/?))>/g,y=/\s*([\w\-:]+)(?:\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g,w=[],k=[];k.last=function(){return this[this.length-1]};for(var C,T,F,M,L=0,A=-1,H="body",j=!1;C=x.exec(e);)T=C.index,T>L&&(L=e.substring(L,T),F?M.push(L):l(L)),L=x.lastIndex,!(T=C[1])||(T=n(T),F&&T===F&&(o(M.join("")),M=F=null),F)?F?M.push(C[0]):(T=C[3])?(T=n(T),i(T,C[4],C[5]),b[T]&&(F=T,M=[])):C[2]&&w.push(C[0]):s(T);return e.length>L&&l(e.substring(L,e.length)),s(),e=w.join(""),w=null,e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,d),e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,d),e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,d),e=e.replace(/^(\s*\r?\n)+|(\s*\r?\n)+$/g,"")},this.toggleShowBlocktag=function(t){na!==t&&(na=!na,t=e(l.body),na?(P+=" showBlocktag",t.addClass("showBlocktag")):(P=P.replace(" showBlocktag",""),t.removeClass("showBlocktag")))},this.toggleSource=function(t){if(x!==t){q.find("[cmd=Source]").toggleClass("xheEnabled").toggleClass("xheActive");var a,n,i=l.body,s=e(i),t=0,o="";x?(a=c.getSource(),s.html("").removeAttr("scroll").attr("class","editMode"+P),j?i.contentEditable="true":l.designMode="On",ra&&(c._exec("inserthtml","-"),e("#"+Aa).show().focus().hide()),o="Edit source code"):(c.pasteHTML('<span id="_xhe_cursor"></span>',!0),a=c.getSource(!0),t=a.indexOf('<span id="_xhe_cursor"></span>'),Ra||(t=a.substring(0,t).replace(/\r/g,"").length),a=a.replace(/(\r?\n\s*|)<span id="_xhe_cursor"><\/span>(\s*\r?\n|)/,function(e,t,a){return t&&a?"\r\n":t+a}),j?i.contentEditable="false":l.designMode="Off",s.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" style="width:100%;height:100%" />'),n=e("#sourceCode",s).blur(c.getSource)[0],o="WYSIWYG mode"),x=!x,c.setSource(a),c.focus(),x?n.setSelectionRange?n.setSelectionRange(t,t):(n=n.createTextRange(),n.move("character",t),
n.select()):c.setTextCursor(),q.find("[cmd=Source]").attr("title",o).find("span").text(o),q.find("[cmd=Source],[cmd=Preview]").toggleClass("xheEnabled"),q.find(".xheButton").not("[cmd=Source],[cmd=Fullscreen],[cmd=About]").toggleClass("xheEnabled").attr("aria-disabled",x?!0:!1),setTimeout(Ka,300)}},this.showPreview=function(){var e=g.beforeSetSource,t=c.getSource();e&&(t=e(t));var e="<html><head>"+O+"<title>Preview</title>"+(E?'<base href="'+E+'"/>':"")+"</head><body>"+t+"</body></html>",t=window.screen,t=window.open("","xhePreview","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+Math.round(.9*t.width)+",height="+Math.round(.8*t.height)+",left="+Math.round(.05*t.width)),a=t.document;a.open(),a.write(e),a.close(),t.focus()},this.toggleFullscreen=function(t){if(ka!==t){var t=e("#"+pa).find(".xheLayout"),a=e("#"+pa),n=jQuery.browser.version,n=j&&(6==n||7==n);ka?(n&&y.after(a),t.attr("style",Za),A.height(N-q.outerHeight()),e(window).scrollTop(Oa),setTimeout(function(){e(window).scrollTop(Oa)},10)):(n&&e("body").append(a),Oa=e(window).scrollTop(),Za=t.attr("style"),t.removeAttr("style"),A.height("100%"),setTimeout(Ma,100)),ra?(e("#"+Aa).show().focus().hide(),setTimeout(c.focus,1)):n&&c.setTextCursor(),ka=!ka,a.toggleClass("xhe_Fullscreen"),e("html").toggleClass("xhe_Fullfix"),q.find("[cmd=Fullscreen]").toggleClass("xheActive"),setTimeout(Ka,300)}},this.showMenu=function(t,a){var n=e('<div class="xheMenu"></div>'),i=t.length,s=[];e.each(t,function(e,t){s.push("<a href=\"javascript:void('"+t.v+'\')" title="'+(t.t?t.t:t.s)+'" v="'+t.v+'" role="option" aria-setsize="'+i+'" aria-posinset="'+(e+1)+'" tabindex="0">'+t.s+"</a>")}),n.append(s.join("")),n.click(function(t){return t=t.target,e.nodeName(t,"DIV")?void 0:(c.loadBookmark(),a(e(t).closest("a").attr("v")),c.hidePanel(),!1)}).mousedown(M),c.saveBookmark(),c.showPanel(n)},this.showColor=function(t){var a=e('<div class="xheColor"></div>'),n=[],i=Ta.length,s=0;e.each(Ta,function(e,t){0===s%7&&n.push((s>0?"</div>":"")+"<div>"),n.push("<a href=\"javascript:void('"+t+'\')" xhev="'+t+'" title="'+t+'" style="background:'+t+'" role="option" aria-setsize="'+i+'" aria-posinset="'+(s+1)+'"></a>'),s++}),n.push("</div>"),a.append(n.join("")),a.click(function(a){return a=a.target,e.nodeName(a,"A")?(c.loadBookmark(),t(e(a).attr("xhev")),c.hidePanel(),!1):void 0}).mousedown(M),c.saveBookmark(),c.showPanel(a)},this.showPastetext=function(){var t=e('<div><label for="xhePastetextValue">Use Ctrl+V on your keyboard to paste the text.</label></div><div><textarea id="xhePastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="Ok" /></div>'),a=e("#xhePastetextValue",t);e("#xheSave",t).click(function(){c.loadBookmark();var e=a.val();return e&&c.pasteText(e),c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showLink=function(){var t='<div><label for="xheLinkUrl">Link URL: </label><input type="text" id="xheLinkUrl" value="http://" class="xheText" /></div><div><label for="xheLinkTarget">Target:&nbsp;&nbsp; </label><select id="xheLinkTarget"><option selected="selected" value="">Default</option><option value="_blank">New window</option><option value="_self">Same window</option><option value="_parent">Parent window</option></select></div><div style="display:none"><label for="xheLinkText">Link Text:</label><input type="text" id="xheLinkText" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="Ok" /></div>',a=fa.find("a[name]").not("[href]"),n=0<a.length;if(n){var i=[];a.each(function(){var t=e(this).attr("name");i.push('<option value="#'+t+'">'+t+"</option>")}),t=t.replace(/(<div><label for="xheLinkTarget)/,'<div><label for="xheLinkAnchor">Anchor: &nbsp;&nbsp;</label><select id="xheLinkAnchor"><option value="">None selected</option>'+i.join("")+"</select></div>$1")}var t=e(t),s=c.getParent("a"),o=e("#xheLinkText",t),r=e("#xheLinkUrl",t),h=e("#xheLinkTarget",t),a=e("#xheSave",t),d=c.getSelect();if(n&&t.find("#xheLinkAnchor").change(function(){var t=e(this).val();""!=t&&r.val(t)}),1===s.length){if(!s.attr("href"))return w=null,c.exec("Anchor");r.val(K(s,"href")),h.attr("value",s.attr("target"))}else""===d&&o.val(g.defLinkText).closest("div").show();g.upLinkUrl&&c.uploadInit(r,g.upLinkUrl,g.upLinkExt),a.click(function(){c.loadBookmark();var t=r.val();if((""===t||0===s.length)&&c._exec("unlink"),""!==t&&"http://"!==t){var a=t.split(" "),n=h.val(),i=o.val();if(1<a.length){c._exec("unlink"),d=c.getSelect();var u='<a href="xhe_tmpurl"',p=[];""!==n&&(u+=' target="'+n+'"');for(var u=u+">xhe_tmptext</a>",i=""!==d?d:i?i:t,g=0,f=a.length;f>g;g++)t=a[g],""!==t&&(t=t.split("||"),n=u,n=n.replace("xhe_tmpurl",t[0]),n=n.replace("xhe_tmptext",t[1]?t[1]:i),p.push(n));c.pasteHTML(p.join("&nbsp;"))}else t=a[0].split("||"),i||(i=t[0]),i=t[1]?t[1]:""!==d?"":i?i:t[0],0===s.length?(i?c.pasteHTML('<a href="#xhe_tmpurl">'+i+"</a>"):c._exec("createlink","#xhe_tmpurl"),s=e('a[href$="#xhe_tmpurl"]',l)):i&&!Q&&s.text(i),K(s,"href",t[0]),""!==n?s.attr("target",n):s.removeAttr("target")}return c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showAnchor=function(){var t=e('<div><label for="xheAnchorName">Anchor name: </label><input type="text" id="xheAnchorName" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="Ok" /></div>'),a=c.getParent("a"),n=e("#xheAnchorName",t),i=e("#xheSave",t);if(1===a.length){if(a.attr("href"))return w=null,c.exec("Link");n.val(a.attr("name"))}i.click(function(){c.loadBookmark();var e=n.val();return e?0===a.length?c.pasteHTML('<a name="'+e+'"></a>'):a.attr("name",e):1===a.length&&a.remove(),c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showImg=function(){var t=e('<div><label for="xheImgUrl">Img URL:&nbsp; </label><input type="text" id="xheImgUrl" value="http://" class="xheText" /></div><div><div><label for="xheImgAlt">Alt text: </label><input type="text" id="xheImgAlt" /></div><div><label for="xheImgAlign">Alignment:</label><select id="xheImgAlign"><option selected="selected" value="">Default</option><option value="left">Left</option><option value="right">Right</option><option value="top">Top</option><option value="middle">Middle</option><option value="baseline">Baseline</option><option value="bottom">Bottom</option></select></div><div><label for="xheImgWidth">Width:&nbsp; &nbsp; </label><input type="text" id="xheImgWidth" style="width:40px;" /> <label for="xheImgHeight">Height:&nbsp; &nbsp;</label><input type="text" id="xheImgHeight" style="width:40px;" /></div><div><label for="xheImgBorder">Border:&nbsp; &nbsp;</label><input type="text" id="xheImgBorder" style="width:40px;" /></div><div><label for="xheImgHspace">Hspace:&nbsp;&nbsp;&nbsp;</label><input type="text" id="xheImgHspace" style="width:40px;" /> <label for="xheImgVspace">Vspace:&nbsp; &nbsp;</label><input type="text" id="xheImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="Ok" /></div>'),a=c.getParent("img"),n=e("#xheImgUrl",t),i=e("#xheImgAlt",t),s=e("#xheImgAlign",t),o=e("#xheImgWidth",t),r=e("#xheImgHeight",t),h=e("#xheImgBorder",t),d=e("#xheImgVspace",t),u=e("#xheImgHspace",t),p=e("#xheSave",t);if(1===a.length){n.val(K(a,"src")),i.val(a.attr("alt")),s.val(a.attr("align")),o.val(a.attr("width")),r.val(a.attr("height")),h.val(a.attr("border"));var f=a.attr("vspace"),m=a.attr("hspace");d.val(0>=f?"":f),u.val(0>=m?"":m)}g.upImgUrl&&c.uploadInit(n,g.upImgUrl,g.upImgExt),p.click(function(){c.loadBookmark();var t=n.val();if(""!==t&&"http://"!==t){var p=t.split(" "),g=i.val(),f=s.val(),m=o.val(),b=r.val(),v=h.val(),x=d.val(),y=u.val();if(1<p.length){var w='<img src="xhe_tmpurl"',k=[];""!==g&&(w+=' alt="'+g+'"'),""!==f&&(w+=' align="'+f+'"'),""!==m&&(w+=' width="'+m+'"'),""!==b&&(w+=' height="'+b+'"'),""!==v&&(w+=' border="'+v+'"'),""!==x&&(w+=' vspace="'+x+'"'),""!==y&&(w+=' hspace="'+y+'"');var C,w=w+" />";for(C in p)t=p[C],""!==t&&(t=t.split("||"),g=w,g=g.replace("xhe_tmpurl",t[0]),t[1]&&(g='<a href="'+t[1]+'" target="_blank">'+g+"</a>"),k.push(g));c.pasteHTML(k.join("&nbsp;"))}else 1===p.length&&(t=p[0],""!==t&&(t=t.split("||"),0===a.length&&(c.pasteHTML('<img src="'+t[0]+'#xhe_tmpurl" />'),a=e('img[src$="#xhe_tmpurl"]',l)),K(a,"src",t[0]),""!==g&&a.attr("alt",g),""!==f?a.attr("align",f):a.removeAttr("align"),""!==m?a.attr("width",m):a.removeAttr("width"),""!==b?a.attr("height",b):a.removeAttr("height"),""!==v?a.attr("border",v):a.removeAttr("border"),""!==x?a.attr("vspace",x):a.removeAttr("vspace"),""!==y?a.attr("hspace",y):a.removeAttr("hspace"),t[1]&&(p=a.parent("a"),0===p.length&&(a.wrap("<a></a>"),p=a.parent("a")),K(p,"href",t[1]),p.attr("target","_blank"))))}else 1===a.length&&a.remove();return c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showEmbed=function(t,a,n,i,s,o,r){var a=e(a),h=c.getParent('embed[type="'+n+'"],embed[classid="'+i+'"]'),d=e("#xhe"+t+"Url",a),u=e("#xhe"+t+"Width",a),p=e("#xhe"+t+"Height",a),t=e("#xheSave",a);o&&c.uploadInit(d,o,r),1===h.length&&(d.val(K(h,"src")),u.val(h.attr("width")),p.val(h.attr("height"))),t.click(function(){c.loadBookmark();var t=d.val();if(""!==t&&"http://"!==t){var a=u.val(),o=p.val(),r=/^\d+%?$/;r.test(a)||(a=412),r.test(o)||(o=300);var g='<embed type="'+n+'" classid="'+i+'" src="xhe_tmpurl"'+s,r=t.split(" ");if(1<r.length){var f,m,b=[],g=g+' width="xhe_width" height="xhe_height" />';for(m in r)t=r[m].split("||"),f=g,f=f.replace("xhe_tmpurl",t[0]),f=f.replace("xhe_width",t[1]?t[1]:a),f=f.replace("xhe_height",t[2]?t[2]:o),""!==t&&b.push(f);c.pasteHTML(b.join("&nbsp;"))}else 1===r.length&&(t=r[0].split("||"),0===h.length&&(c.pasteHTML(g.replace("xhe_tmpurl",t[0]+"#xhe_tmpurl")+" />"),h=e('embed[src$="#xhe_tmpurl"]',l)),K(h,"src",t[0]),h.attr("width",t[1]?t[1]:a),h.attr("height",t[2]?t[2]:o))}else 1===h.length&&h.remove();return c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(a)},this.showEmot=function(t){var a=e('<div class="xheEmot"></div>'),t=t?t:Qa?Qa:"default",n=Ba[t],i=X+t+"/",s=0,l=[],o="",o=n.width,r=n.height,h=n.line,d=n.count,n=n.list;if(d)for(n=1;d>=n;n++)s++,l.push("<a href=\"javascript:void('"+n+'\')" style="background-image:url('+i+n+'.gif);" emot="'+t+","+n+'" xhev="" title="'+n+'" role="option">&nbsp;</a>'),0===s%h&&l.push("<br />");else e.each(n,function(e,a){s++,l.push("<a href=\"javascript:void('"+a+'\')" style="background-image:url('+i+e+'.gif);" emot="'+t+","+e+'" title="'+a+'" xhev="'+a+'" role="option">&nbsp;</a>'),0===s%h&&l.push("<br />")});var d=h*(o+12),n=Math.ceil(s/h)*(r+12),u=.75*d;u>=n&&(u=""),o=e("<style>"+(u?".xheEmot div{width:"+(d+20)+"px;height:"+u+"px;}":"")+".xheEmot div a{width:"+o+"px;height:"+r+"px;}</style><div>"+l.join("")+"</div>").click(function(t){var t=t.target,a=e(t);return e.nodeName(t,"A")?(c.loadBookmark(),c.pasteHTML('<img emot="'+a.attr("emot")+'" alt="'+a.attr("xhev")+'">'),c.hidePanel(),!1):void 0}).mousedown(M),a.append(o);var p=0,g=['<ul role="tablist">'];e.each(Ba,function(e,a){p++,g.push("<li"+(t===e?' class="cur"':"")+' role="presentation"><a href="javascript:void(\''+a.name+'\')" group="'+e+'" role="tab" tabindex="0">'+a.name+"</a></li>")}),p>1&&(g.push('</ul><br style="clear:both;" />'),o=e(g.join("")).click(function(t){return Qa=e(t.target).attr("group"),c.exec("Emot"),!1}).mousedown(M),a.append(o)),c.saveBookmark(),c.showPanel(a)},this.showTable=function(){var t=e('<div><label for="xheTableRows">Rows:&nbsp; &nbsp; &nbsp; &nbsp;</label><input type="text" id="xheTableRows" style="width:40px;" value="3" /> <label for="xheTableColumns">Cols:&nbsp; &nbsp; &nbsp; &nbsp;</label><input type="text" id="xheTableColumns" style="width:40px;" value="2" /></div><div><label for="xheTableHeaders">Headers:&nbsp; &nbsp;&nbsp;</label><select id="xheTableHeaders"><option selected="selected" value="">None</option><option value="row">First row</option><option value="col">First column</option><option value="both">Both</option></select></div><div><label for="xheTableWidth">Width: &nbsp; &nbsp; &nbsp;</label><input type="text" id="xheTableWidth" style="width:40px;" value="200" /> <label for="xheTableHeight">Height:&nbsp; &nbsp; &nbsp;</label><input type="text" id="xheTableHeight" style="width:40px;" value="" /></div><div><label for="xheTableBorder">Border:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><input type="text" id="xheTableBorder" style="width:40px;" value="1" /></div><div><label for="xheTableCellSpacing">CellSpacing:</label><input type="text" id="xheTableCellSpacing" style="width:40px;" value="1" /> <label for="xheTableCellPadding">CellPadding:</label><input type="text" id="xheTableCellPadding" style="width:40px;" value="1" /></div><div><label for="xheTableAlign">Align:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><select id="xheTableAlign"><option selected="selected" value="">Default</option><option value="left">Left</option><option value="center">Center</option><option value="right">Right</option></select></div><div><label for="xheTableCaption">Caption:&nbsp;&nbsp;&nbsp;&nbsp;</label><input type="text" id="xheTableCaption" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="Ok" /></div>'),a=e("#xheTableRows",t),n=e("#xheTableColumns",t),i=e("#xheTableHeaders",t),s=e("#xheTableWidth",t),l=e("#xheTableHeight",t),o=e("#xheTableBorder",t),r=e("#xheTableCellSpacing",t),h=e("#xheTableCellPadding",t),d=e("#xheTableAlign",t),u=e("#xheTableCaption",t);e("#xheSave",t).click(function(){c.loadBookmark();var e=u.val(),t=o.val(),p=a.val(),g=n.val(),f=i.val(),m=s.val(),b=l.val(),v=r.val(),x=h.val(),y=d.val(),t="<table"+(""!==t?' border="'+t+'"':"")+(""!==m?' width="'+m+'"':"")+(""!==b?' height="'+b+'"':"")+(""!==v?' cellspacing="'+v+'"':"")+(""!==x?' cellpadding="'+x+'"':"")+(""!==y?' align="'+y+'"':"")+">";if(""!==e&&(t+="<caption>"+e+"</caption>"),"row"===f||"both"===f){for(t+="<tr>",e=0;g>e;e++)t+='<th scope="col"></th>';t+="</tr>",p--}for(t+="<tbody>",e=0;p>e;e++){for(t+="<tr>",m=0;g>m;m++)t=0!==m||"col"!==f&&"both"!==f?t+"<td></td>":t+'<th scope="row"></th>';t+="</tr>"}return c.pasteHTML(t+"</tbody></table>"),c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showAbout=function(){var t=e('<div style="font:12px Arial;width:245px;word-wrap:break-word;word-break:break-all;outline:none;" role="dialog" tabindex="-1"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />v1.1.12 (build 111204)</p><p>xhEditor is a platform independent WYSWYG XHTML editor based by jQuery,released as Open Source under <a href="http://www.gnu.org/licenses/lgpl.html" target="_blank">LGPL</a>.</p><p>Copyright &copy; <a href="http://xheditor.com/" target="_blank">xhEditor.com</a>. All rights reserved.</p></div>');t.find("p").attr("role","presentation"),c.showDialog(t,!0),setTimeout(function(){t.focus()},100)},this.addShortcuts=function(e,t){e=e.toLowerCase(),la[e]===Z&&(la[e]=[]),la[e].push(t)},this.delShortcuts=function(e){delete la[e]},this.uploadInit=function(t,a,n){function i(e){L(e,"string")&&(e=[e]);var a,n,i=!1,s=e.length,l=[];for((a=g.onUpload)&&a(e),a=0;s>a;a++)n=e[a],n=L(n,"string")?n:n.url,"!"===n.substr(0,1)&&(i=!0,n=n.substr(1)),l.push(n);t.val(l.join(" ")),i&&t.closest(".xheDialog").find("#xheSave").click()}var s=e('<span class="xheUpload"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="'+g.upBtnText+'" class="xheBtn" tabindex="-1" /></span>'),l=e(".xheBtn",s),o=g.html5Upload,r=o?g.upMultiple:1;if(t.after(s),l.before(t),a=a.replace(/{editorRoot}/gi,J),"!"===a.substr(0,1))l.click(function(){c.showIframeModal("Upload file",a.substr(1),i,null,null)});else{s.append('<input type="file"'+(r>1?' multiple=""':"")+' class="xheFile" size="13" name="filedata" tabindex="-1" />');var h=e(".xheFile",s);h.change(function(){c.startUpload(h[0],a,n,i)}),setTimeout(function(){t.closest(".xheDialog").bind("dragenter dragover",M).bind("drop",function(e){var t,e=e.originalEvent.dataTransfer;return o&&e&&(t=e.files)&&0<t.length&&c.startUpload(t,a,n,i),!1})},10)}},this.startUpload=function(a,b,d,f){function h(a,d){var e=Object,g=!1;try{e=eval("("+a+")")}catch(h){}return e.err===Z||e.msg===Z?alert(b+" upload interface error!\r\n\r\nreturn error:\r\n\r\n"+a):e.err?alert(e.err):(m.push(e.msg),g=!0),(!g||d)&&c.removeModal(),d&&g&&f(m),g}var m=[],i=g.html5Upload,k=i?g.upMultiple:1,j,r=e('<div style="padding:22px 0;text-align:center;line-height:30px;">File uploading,please wait...<br /></div>'),s='<img src="'+va+'img/loading.gif">';if(i&&(!a.nodeType||(j=a.files)&&j[0].name)){if(j||(j=a),a=j.length,a>k)return void alert("Please do not upload more then "+k+" files.");for(k=0;a>k;k++)if(!Wa(j[k].name,d))return;var l=e('<div class="xheProgress"><div><span>0%</span></div></div>');r.append(l),d=new c.html5Upload("filedata",j,b,h,function(t){if(0<=t.loaded){var a=Math.round(100*t.loaded/t.total)+"%";e("div",l).css("width",a),e("span",l).text(a+" ( "+Xa(t.loaded)+" / "+Xa(t.total)+" )")}else l.replaceWith(s)})}else{if(!Wa(a.value,d))return;r.append(s),d=new c.html4Upload(a,b,h)}c.showModal("File uploading(Esc cancel)",r,320,150),d.start()},this.html4Upload=function(t,a,n){var i="jUploadFrame"+(new Date).getTime(),s=this,l=e('<iframe name="'+i+'" class="xheHideArea" />').appendTo("body"),o=e('<form action="'+a+'" target="'+i+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body"),r=e(t),c=r.clone().attr("disabled","true");return r.before(c).appendTo(o),this.remove=function(){null!==s&&(c.before(r).remove(),l.remove(),o.remove(),s=null)},this.onLoad=function(){var t=l[0].contentWindow.document,a=e(t.body).text();t.write(""),s.remove(),n(a,!0)},this.start=function(){o.submit(),l.load(s.onLoad)},this},this.html5Upload=function(e,t,a,n,i){function s(t,a,n,i){o=new XMLHttpRequest,upload=o.upload,o.onreadystatechange=function(){4===o.readyState&&n(o.responseText)},upload?upload.onprogress=function(e){i(e.loaded)}:i(-1),o.open("POST",a),o.setRequestHeader("Content-Type","application/octet-stream"),o.setRequestHeader("Content-Disposition",'attachment; name="'+encodeURIComponent(e)+'"; filename="'+encodeURIComponent(t.name)+'"'),o.sendAsBinary&&t.getAsBinary?o.sendAsBinary(t.getAsBinary()):o.send(t)}function l(e){i&&i({loaded:h+e,total:d})}for(var o,r=0,c=t.length,h=0,d=0,u=this,p=0;c>p;p++)d+=t[p].size;this.remove=function(){o&&(o.abort(),o=null)},this.uploadNext=function(e){e&&(h+=t[r-1].size,l(0)),(!e||e&&!0===n(e,r===c))&&c>r&&s(t[r++],a,u.uploadNext,function(e){l(e)})},this.start=function(){u.uploadNext()}},this.showIframeModal=function(a,b,d,f,g,j){function i(){try{s.callback=k,s.unloadme=c.removeModal,e(s.document).keydown(H),n=s.name}catch(t){}}function k(e){s.document.write(""),c.removeModal(),null!=e&&d(e)}var b=e('<iframe frameborder="0" src="'+b.replace(/{editorRoot}/gi,J)+(/\?/.test(b)?"&":"?")+"parenthost="+location.host+'" style="width:100%;height:100%;display:none;" /><div class="xheModalIfmWait"></div>'),l=b.eq(0),r=b.eq(1);c.showModal(a,b,f,g,j);var s=l[0].contentWindow,n;i(),l.load(function(){if(i(),n){var a=!0;try{n=eval("("+unescape(n)+")")}catch(b){a=!1}if(a)return k(n)}r.is(":visible")&&(l.show().focus(),r.remove())})},this.showModal=function(t,a,n,i,s){return ua?!1:(c.panelState=R,R=!1,da=g.layerShadow,n=n?n:g.modalWidth,i=i?i:g.modalHeight,I=e('<div class="xheModal" style="width:'+(n-1)+"px;height:"+i+"px;margin-left:-"+Math.ceil(n/2)+"px;"+(j&&7>qa?"":"margin-top:-"+Math.ceil(i/2)+"px")+'">'+(g.modalTitle?'<div class="xheModalTitle"><span class="xheModalClose" title="Close (Esc)" tabindex="0" role="button"></span>'+t+"</div>":"")+'<div class="xheModalContent"></div></div>').appendTo("body"),Ea=e('<div class="xheModalOverlay"></div>').appendTo("body"),da>0&&(Da=e('<div class="xheModalShadow" style="width:'+I.outerWidth()+"px;height:"+I.outerHeight()+"px;margin-left:-"+(Math.ceil(n/2)-da-2)+"px;"+(j&&7>qa?"":"margin-top:-"+(Math.ceil(i/2)-da-2)+"px")+'"></div>').appendTo("body")),e(".xheModalContent",I).css("height",i-(g.modalTitle?e(".xheModalTitle").outerHeight():0)).html(a),j&&6===qa&&(Fa=e("select:visible").css("visibility","hidden")),e(".xheModalClose",I).click(c.removeModal),Ea.show(),da>0&&Da.show(),I.show(),setTimeout(function(){I.find("a,input[type=text],textarea").filter(":visible").filter(function(){return"hidden"!==e(this).css("visibility")}).eq(0).focus()},10),ua=!0,void(Ga=s))},this.removeModal=function(){Fa&&Fa.css("visibility","visible"),I.html("").remove(),da>0&&Da.remove(),Ea.remove(),Ga&&Ga(),ua=!1,R=c.panelState},this.showDialog=function(t,a){var n=e('<div class="xheDialog"></div>'),i=e(t),s=e("#xheSave",i);if(1===s.length){if(i.find("input[type=text],select").keypress(function(e){return 13===e.which?(s.click(),!1):void 0}),i.find("textarea").keydown(function(e){return e.ctrlKey&&13===e.which?(s.click(),!1):void 0}),s.after(' <input type="button" id="xheCancel" value="Cancel" />'),e("#xheCancel",i).click(c.hidePanel),!g.clickCancelDialog){ta=!1;var l=e('<div class="xheFixCancel"></div>').appendTo("body").mousedown(M),o=A.offset();l.css({left:o.left,top:o.top,width:A.outerWidth(),height:A.outerHeight()})}n.mousedown(function(){oa=!0})}n.append(i),c.showPanel(n,a)},this.showPanel=function(a,n){if(!w.target)return!1;t.html("").append(a).css("left",-999).css("top",-999),ca=e(w.target).closest("a").addClass("xheActive");var i=ca.offset(),s=i.left,i=i.top,i=i+(ca.outerHeight()-1);ba.css({left:s+1,top:i,width:ca.width()}).show();var l=document.documentElement,o=document.body;s+t.outerWidth()>(window.pageXOffset||l.scrollLeft||o.scrollLeft)+(l.clientWidth||o.clientWidth)&&(s-=t.outerWidth()-ca.outerWidth()),l=g.layerShadow,l>0&&aa.css({left:s+l,top:i+l,width:t.outerWidth(),height:t.outerHeight()}).show(),ma&&!isNaN(ma)&&(aa.css("zIndex",parseFloat(ma)+1),t.css("zIndex",parseFloat(ma)+2),ba.css("zIndex",parseFloat(ma)+3)),t.css({left:s,top:i}).show(),n||setTimeout(function(){t.find("a,input[type=text],textarea").filter(":visible").filter(function(){return"hidden"!==e(this).css("visibility")}).eq(0).focus()},10),Pa=R=!0},this.hidePanel=function(){R&&(ca.removeClass("xheActive"),aa.hide(),ba.hide(),t.hide(),R=!1,ta||(e(".xheFixCancel").remove(),ta=!0),Pa=oa=!1,W=null,c.focus(),c.loadBookmark())},this.exec=function(t){c.hidePanel();var a=ja[t];if(!a)return!1;if(null===w){w={};var n=q.find(".xheButton[cmd="+t+"]");1===n.length&&(w.target=n)}if(a.e)a.e.call(c);else switch(t=t.toLowerCase()){case"cut":try{if(l.execCommand(t),!l.queryCommandSupported(t))throw"Error"}catch(i){alert("Currently not supported by your browser, use keyboard shortcuts(Ctrl+X) instead.")}break;case"copy":try{if(l.execCommand(t),!l.queryCommandSupported(t))throw"Error"}catch(s){alert("Currently not supported by your browser, use keyboard shortcuts(Ctrl+C) instead.")}break;case"paste":try{if(l.execCommand(t),!l.queryCommandSupported(t))throw"Error"}catch(o){alert("Currently not supported by your browser, use keyboard shortcuts(Ctrl+V) instead.")}break;case"pastetext":window.clipboardData?c.pasteText(window.clipboardData.getData("Text",!0)):c.showPastetext();break;case"blocktag":var r=[];e.each(gb,function(e,t){r.push({s:"<"+t.n+">"+t.t+"</"+t.n+">",v:"<"+t.n+">",t:t.t})}),c.showMenu(r,function(e){c._exec("formatblock",e)});break;case"fontface":var h=[];e.each(hb,function(e,t){t.c=t.c?t.c:t.n,h.push({s:'<span style="font-family:'+t.c+'">'+t.n+"</span>",v:t.c,t:t.n})}),c.showMenu(h,function(e){c._exec("fontname",e)});break;case"fontsize":var d=[];e.each(S,function(e,t){d.push({s:'<span style="font-size:'+t.s+';">'+t.t+"("+t.s+")</span>",v:e+1,t:t.t})}),c.showMenu(d,function(e){c._exec("fontsize",e)});break;case"fontcolor":c.showColor(function(e){c._exec("forecolor",e)});break;case"backcolor":c.showColor(function(e){j?c._exec("backcolor",e):(Ja(!0),c._exec("hilitecolor",e),Ja(!1))});break;case"align":c.showMenu(ib,function(e){c._exec(e)});break;case"list":c.showMenu(jb,function(e){c._exec(e)});break;case"link":c.showLink();break;case"anchor":c.showAnchor();break;case"img":c.showImg();break;case"flash":c.showEmbed("Flash",'<div><label for="xheFlashUrl">Flash URL:</label><input type="text" id="xheFlashUrl" value="http://" class="xheText" /></div><div><label for="xheFlashWidth">Width:&nbsp; &nbsp; </label><input type="text" id="xheFlashWidth" style="width:40px;" value="480" /> <label for="xheFlashHeight">Height:&nbsp; &nbsp;</label><input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="Ok" /></div>',"application/x-shockwave-flash","clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000",' wmode="opaque" quality="high" menu="false" play="true" loop="true" allowfullscreen="true"',g.upFlashUrl,g.upFlashExt);break;case"media":c.showEmbed("Media",'<div><label for="xheMediaUrl">Media URL:</label><input type="text" id="xheMediaUrl" value="http://" class="xheText" /></div><div><label for="xheMediaWidth">Width:&nbsp; &nbsp; </label><input type="text" id="xheMediaWidth" style="width:40px;" value="480" /> <label for="xheMediaHeight">Height:&nbsp; &nbsp;</label><input type="text" id="xheMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="Ok" /></div>',"application/x-mplayer2","clsid:6bf52a52-394a-11d3-b153-00c04f79faa6",' enablecontextmenu="false" autostart="false"',g.upMediaUrl,g.upMediaExt);break;case"hr":c.pasteHTML("<hr />");break;case"emot":c.showEmot();break;case"table":c.showTable();break;case"source":c.toggleSource();break;case"preview":c.showPreview();break;case"print":V.print();break;case"fullscreen":c.toggleFullscreen();break;case"about":c.showAbout();break;default:c._exec(t)}w=null},this._exec=function(e,t,a){return a||c.focus(),t!==Z?l.execCommand(e,!1,t):l.execCommand(e,!1,null)}};sa.settings={skin:"default",tools:"full",clickCancelDialog:!0,linkTag:!1,internalScript:!1,inlineScript:!1,internalStyle:!0,inlineStyle:!0,showBlocktag:!1,forcePtag:!0,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",upMediaExt:"wmv,avi,wma,mp3,mid",modalWidth:350,modalHeight:220,modalTitle:!0,defLinkText:"Click here",layerShadow:3,emotMark:!1,upBtnText:"Upload",cleanPaste:2,hoverExecDelay:100,html5Upload:!0,upMultiple:99},window.xheditor=sa,e(function(){e.fn.oldVal=e.fn.val,e.fn.val=function(e){var t,a=this;return e===Z?a[0]&&(t=a[0].xheditor)?t.getSource():a.oldVal():a.each(function(){(t=this.xheditor)?t.setSource(e):a.oldVal(e)})},e("textarea").each(function(){var t=e(this),a=t.attr("class");a&&(a=a.match(/(?:^|\s)xheditor(?:\-(m?full|simple|mini))?(?:\s|$)/i))&&t.xheditor(a[1]?{tools:a[1]}:null)})})}(jQuery);