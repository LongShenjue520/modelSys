function ubb2html(s){function e(s){return null!=s&&""!=s?!isNaN(s):!1}var r,a=[],i=0,t="10px,13px,16px,18px,24px,32px,48px".split(",");for(r=(""+s).replace(/[<>&"]/g,function(s){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[s]}),r=r.replace(/\r?\n/g,"<br />"),r=r.replace(/\[code\s*(?:=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/gi,function(s){return i++,a[i]=s,"[	ubbcodeplace_"+i+"	]"}),r=r.replace(/\[(\/?)(b|u|i|s|sup|sub)\]/gi,"<$1$2>"),r=r.replace(/\[color\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/gi,'<font color="$1">'),r=r.replace(/\[font\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/gi,'<font face="$1">'),r=r.replace(/\[\/(color|font)\]/gi,"</font>"),r=r.replace(/\[size\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/gi,function(s,e){return e.match(/^\d+$/)&&(e=t[e-1]),'<span style="font-size:'+e+';">'}),r=r.replace(/\[back\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/gi,'<span style="background-color:$1;">'),r=r.replace(/\[\/(size|back)\]/gi,"</span>"),s=0;3>s;s++)r=r.replace(/\[align\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\](((?!\[align(?:\s+[^\]]+)?\])[\s\S])*?)\[\/align\]/gi,'<p align="$1">$2</p>');for(r=r.replace(/\[img\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/img\]/gi,'<img src="$1" alt="" />'),r=r.replace(/\[img\s*=([^,\]]*)(?:\s*,\s*(\d*%?)\s*,\s*(\d*%?)\s*)?(?:,?\s*(\w+))?\s*\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*)?\s*\[\/img\]/gi,function(s,r,a,i,t,c){return s='<img src="'+c+'" alt="'+r+'"',t=t?t:e(a)?"":a,e(a)&&(s+=' width="'+a+'"'),e(i)&&(s+=' height="'+i+'"'),t&&(s+=' align="'+t+'"'),s+" />"}),r=r.replace(/\[emot\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\/\]/gi,'<img emot="$1" />'),r=r.replace(/\[url\]\s*(((?!")[\s\S])*?)(?:"[\s\S]*?)?\s*\[\/url\]/gi,'<a href="$1">$1</a>'),r=r.replace(/\[url\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]*?)\s*\[\/url\]/gi,'<a href="$1">$2</a>'),r=r.replace(/\[email\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/email\]/gi,'<a href="mailto:$1">$1</a>'),r=r.replace(/\[email\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]+?)\s*\[\/email\]/gi,'<a href="mailto:$1">$2</a>'),r=r.replace(/\[quote\]/gi,"<blockquote>"),r=r.replace(/\[\/quote\]/gi,"</blockquote>"),r=r.replace(/\[flash\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/flash\]/gi,function(s,e,r,a){return e||(e=480),r||(r=400),'<embed type="application/x-shockwave-flash" src="'+a+'" wmode="opaque" quality="high" bgcolor="#ffffff" menu="false" play="true" loop="true" width="'+e+'" height="'+r+'"/>'}),r=r.replace(/\[media\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+)\s*)?)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/media\]/gi,function(s,e,r,a,i){return e||(e=480),r||(r=400),'<embed type="application/x-mplayer2" src="'+i+'" enablecontextmenu="false" autostart="'+("1"==a?"true":"false")+'" width="'+e+'" height="'+r+'"/>'}),r=r.replace(/\[table\s*(?:=\s*(\d{1,4}%?)\s*(?:,\s*([^\]"]+)(?:"[^\]]*?)?)?)?\s*\]/gi,function(s,e,r){return s="<table",e&&(s+=' width="'+e+'"'),r&&(s+=' bgcolor="'+r+'"'),s+">"}),r=r.replace(/\[tr\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/gi,function(s,e){return"<tr"+(e?' bgcolor="'+e+'"':"")+">"}),r=r.replace(/\[td\s*(?:=\s*(\d{1,2})\s*,\s*(\d{1,2})\s*(?:,\s*(\d{1,4}%?))?)?\s*\]/gi,function(s,e,r,a){return"<td"+(e>1?' colspan="'+e+'"':"")+(r>1?' rowspan="'+r+'"':"")+(a?' width="'+a+'"':"")+">"}),r=r.replace(/\[\/(table|tr|td)\]/gi,"</$1>"),r=r.replace(/\[\*\]((?:(?!\[\*\]|\[\/list\]|\[list\s*(?:=[^\]]+)?\])[\s\S])+)/gi,"<li>$1</li>"),r=r.replace(/\[list\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/gi,function(s,e){var r="<ul";return e&&(r+=' type="'+e+'"'),r+">"}),r=r.replace(/\[\/list\]/gi,"</ul>"),r=r.replace(/\[hr\/\]/gi,"<hr />"),s=1;i>=s;s++)r=r.replace("[	ubbcodeplace_"+s+"	]",a[s]);return r=r.replace(/(^|<\/?\w+(?:\s+[^>]*?)?>)([^<$]+)/gi,function(s,e,r){return e+r.replace(/[\t ]/g,function(s){return{"	":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"," ":"&nbsp;"}[s]})})}function html2ubb(s){function e(s,e,a,i){if(!a)return i;var t,s=[],e=[];return(t=a.match(/ face\s*=\s*"\s*([^"]+)\s*"/i))&&(s.push("[font="+t[1]+"]"),e.push("[/font]")),(t=a.match(/ size\s*=\s*"\s*(\d+)\s*"/i))&&(s.push("[size="+t[1]+"]"),e.push("[/size]")),(t=a.match(/ color\s*=\s*"\s*([^"]+)\s*"/i))&&(s.push("[color="+r(t[1])+"]"),e.push("[/color]")),s.join("")+i+e.join("")}function r(s){var e;if(e=s.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){for(s=(65536*e[1]+256*e[2]+1*e[3]).toString(16);6>s.length;)s="0"+s;s="#"+s}return s=s.replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3")}var a,i=/\s+src\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i,t=/\s+width\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,c=/\s+height\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,l=/(?:background|background-color|bgcolor)\s*[:=]\s*(["']?)\s*((rgb\s*\(\s*\d{1,3}%?,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\))|(#[0-9a-f]{3,6})|([a-z]{1,20}))\s*\1/i,n=[],p=0;for(a=(""+s).replace(/\s*\r?\n\s*/g,""),a=a.replace(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/gi,""),a=a.replace(/<\!--[\s\S]*?--\>/gi,""),a=a.replace(/<br(\s+[^>]*)?\/?>/gi,"\r\n"),a=a.replace(/\[code\s*(=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/gi,function(s){return p++,n[p]=s,"[	ubbcodeplace_"+p+"	]"}),a=a.replace(/<(\/?)(b|u|i|s)(\s+[^>]*?)?>/gi,"[$1$2]"),a=a.replace(/<(\/?)strong(\s+[^>]*?)?>/gi,"[$1b]"),a=a.replace(/<(\/?)em(\s+[^>]*?)?>/gi,"[$1i]"),a=a.replace(/<(\/?)(strike|del)(\s+[^>]*?)?>/gi,"[$1s]"),a=a.replace(/<(\/?)(sup|sub)(\s+[^>]*?)?>/gi,"[$1$2]"),a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,e),a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,e),a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,e),s=0;3>s;s++)a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color|background|background-color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,function(s,e,a,i){var s=a.match(/(?:^|;)\s*font-family\s*:\s*([^;]+)/i),e=a.match(/(?:^|;)\s*font-size\s*:\s*([^;]+)/i),t=a.match(/(?:^|;)\s*color\s*:\s*([^;]+)/i),a=a.match(/(?:^|;)\s*(?:background|background-color)\s*:\s*([^;]+)/i),c=[],l=[];return s&&(c.push("[font="+s[1]+"]"),l.push("[/font]")),e&&(c.push("[size="+e[1]+"]"),l.push("[/size]")),t&&(c.push("[color="+r(t[1])+"]"),l.push("[/color]")),a&&(c.push("[back="+r(a[1])+"]"),l.push("[/back]")),c.join("")+i+l.join("")});for(s=0;3>s;s++)a=a.replace(/<(div|p)(?:\s+[^>]*?)?[\s"';]\s*(?:text-)?align\s*[=:]\s*(["']?)\s*(left|center|right)\s*\2[^>]*>(((?!<\1(\s+[^>]*?)?>)[\s\S])+?)<\/\1>/gi,"[align=$3]$4[/align]");for(s=0;3>s;s++)a=a.replace(/<(center)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,"[align=center]$2[/align]");for(s=0;3>s;s++)a=a.replace(/<(p|div)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*text-align\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,function(){});for(a=a.replace(/<a(?:\s+[^>]*?)?\s+href=(["'])\s*(.+?)\s*\1[^>]*>\s*([\s\S]*?)\s*<\/a>/gi,function(s,e,r,a){return r&&a?(s="url",r.match(/^mailto:/i)&&(s="email",r=r.replace(/mailto:(.+?)/i,"$1")),e="["+s,r!=a&&(e+="="+r),e+"]"+a+"[/"+s+"]"):""}),a=a.replace(/<img(\s+[^>]*?)\/?>/gi,function(s,e){var r=e.match(/\s+emot\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i);if(r)return"[emot="+r[2]+"/]";var r=e.match(i),a=e.match(/\s+alt\s*=\s*(["']?)\s*(.*?)\s*\1(\s|$)/i),l=e.match(t),n=e.match(c),p=e.match(/\s+align\s*=\s*(["']?)\s*(\w+)\s*\1(\s|$)/i),o="[img";return r?(a=""+a[2],(l||n)&&(a+=","+(l?l[2]:"")+","+(n?n[2]:"")),p&&(a+=","+p[2]),a&&(o+="="+a),o+="]"+r[2]+"[/img]"):""}),a=a.replace(/<blockquote(?:\s+[^>]*?)?>/gi,"[quote]"),a=a.replace(/<\/blockquote>/gi,"[/quote]"),a=a.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-shockwave-flash\s*"|\s+classid\s*=\s*"\s*clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000\s*")[^>]*?)\/?>/gi,function(s,e){var r=e.match(i),a=e.match(t),l=e.match(c),n="[flash";return r?(a&&l&&(n+="="+a[2]+","+l[2]),n+="]"+r[2],n+"[/flash]"):""}),a=a.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-mplayer2\s*"|\s+classid\s*=\s*"\s*clsid:6bf52a52-394a-11d3-b153-00c04f79faa6\s*")[^>]*?)\/?>/gi,function(s,e){var r=e.match(i),a=e.match(t),l=e.match(c),n=e.match(/\s+autostart\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i),p="[media",o="0";return r?(n&&"true"==n[2]&&(o="1"),a&&l&&(p+="="+a[2]+","+l[2]+","+o),p+="]"+r[2],p+"[/media]"):""}),a=a.replace(/<table(\s+[^>]*?)?>/gi,function(s,e){var r="[table";if(e){var a=e.match(t),i=e.match(l);a&&(r+="="+a[2],i&&(r+=","+i[2]))}return r+"]"}),a=a.replace(/<tr(\s+[^>]*?)?>/gi,function(s,e){var r="[tr";if(e){var a=e.match(l);a&&(r+="="+a[2])}return r+"]"}),a=a.replace(/<(?:th|td)(\s+[^>]*?)?>/gi,function(s,e){var r="[td";if(e){var a=e.match(/\s+colspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),i=e.match(/\s+rowspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),c=e.match(t),a=a?a[2]:1,i=i?i[2]:1;(a>1||i>1||c)&&(r+="="+a+","+i),c&&(r+=","+c[2])}return r+"]"}),a=a.replace(/<\/(table|tr)>/gi,"[/$1]"),a=a.replace(/<\/(th|td)>/gi,"[/td]"),a=a.replace(/<ul(\s+[^>]*?)?>/gi,function(s,e){var r;return e&&(r=e.match(/\s+type\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i)),"[list"+(r?"="+r[2]:"")+"]"}),a=a.replace(/<ol(\s+[^>]*?)?>/gi,"[list=1]"),a=a.replace(/<li(\s+[^>]*?)?>/gi,"[*]"),a=a.replace(/<\/li>/gi,""),a=a.replace(/<\/(ul|ol)>/gi,"[/list]"),a=a.replace(/<h([1-6])(\s+[^>]*?)?>/gi,function(s,e){return"\r\n\r\n[size="+(7-e)+"][b]"}),a=a.replace(/<\/h[1-6]>/gi,"[/b][/size]\r\n\r\n"),a=a.replace(/<address(\s+[^>]*?)?>/gi,"\r\n[i]"),a=a.replace(/<\/address>/gi,"[i]\r\n"),a=a.replace(/<hr(\s+[^>]*?)?\/>/gi,"[hr/]"),s=0;3>s;s++)a=a.replace(/<(p)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,"\r\n\r\n$2\r\n\r\n");for(s=0;3>s;s++)a=a.replace(/<(div)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,"\r\n$2\r\n");for(a=a.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n"),a=a.replace(/^((\s|&nbsp;)*\r?\n)+/g,""),a=a.replace(/((\s|&nbsp;)*\r?\n)+$/g,""),s=1;p>=s;s++)a=a.replace("[	ubbcodeplace_"+s+"	]",n[s]);a=a.replace(/<[^<>]+?>/g,"");var o={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return a=a.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(s,e){return o[e]})}