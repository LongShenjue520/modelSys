!function(e,Z){if(window.xheditor)return!1;var ia=navigator.userAgent.toLowerCase(),Ca=-1!==ia.indexOf("mobile"),H=e.browser,qa=parseFloat(H.version),j=H.msie,ra=H.mozilla,Q=H.safari,Ra=H.opera,eb=-1<ia.indexOf(" adobeair/");e.fn.xheditor=function(j){if(Ca)return!1;var n=[];return this.each(function(){if(e.nodeName(this,"TEXTAREA"))if(!1===j)this.xheditor&&(this.xheditor.remove(),this.xheditor=null);else if(this.xheditor)n.push(this.xheditor);else{var o=/({.*})/.exec(e(this).attr("class"));if(o){try{o=eval("("+o[1]+")")}catch(t){}j=e.extend({},o,j)}o=new sa(this,j),o.init()&&(this.xheditor=o,n.push(o))}}),0===n.length&&(n=!1),1===n.length&&(n=n[0]),n};var $=0,R=!1,ta=!0,ua=!1,Sa=!1,t,aa,ba,ca,I,Da,da,Ea,Fa,Ga,J;if(e("script[src*=xheditor]").each(function(){var e=this.src;return e.match(/xheditor[^\/]*\.js/i)?(J=e.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"$1"),!1):void 0}),j)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(rb){}var fb={27:"esc",9:"tab",32:"space",13:"enter",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},Ta="#FFFFFF,#CCCCCC,#C0C0C0,#999999,#666666,#333333,#000000,#FFCCCC,#FF6666,#FF0000,#CC0000,#990000,#660000,#330000,#FFCC99,#FF9966,#FF9900,#FF6600,#CC6600,#993300,#663300,#FFFF99,#FFFF66,#FFCC66,#FFCC33,#CC9933,#996633,#663333,#FFFFCC,#FFFF33,#FFFF00,#FFCC00,#999900,#666600,#333300,#99FF99,#66FF99,#33FF33,#33CC00,#009900,#006600,#003300,#99FFFF,#33FFFF,#66CCCC,#00CCCC,#339999,#336666,#003333,#CCFFFF,#66FFFF,#33CCFF,#3366FF,#3333FF,#000099,#000066,#CCCCFF,#9999FF,#6666CC,#6633FF,#6600CC,#333399,#330099,#FFCCFF,#FF99FF,#CC66CC,#CC33CC,#993399,#663366,#330033".split(","),gb=[{n:"p",t:"普通段落"},{n:"h1",t:"標題1"},{n:"h2",t:"標題2"},{n:"h3",t:"標題3"},{n:"h4",t:"標題4"},{n:"h5",t:"標題5"},{n:"h6",t:"標題6"},{n:"pre",t:"已編排格式"},{n:"address",t:"地址"}],hb=[{n:"新細明體",c:"PMingLiu"},{n:"細明體",c:"mingliu"},{n:"標楷體",c:"DFKai-SB"},{n:"微軟正黑體",c:"Microsoft JhengHei"},{n:"Arial"},{n:"Arial Black"},{n:"Comic Sans MS"},{n:"Courier New"},{n:"System"},{n:"Times New Roman"},{n:"Tahoma"},{n:"Verdana"}],S=[{n:"x-small",s:"10px",t:"極小"},{n:"small",s:"13px",t:"特小"},{n:"medium",s:"16px",t:"小"},{n:"large",s:"18px",t:"中"},{n:"x-large",s:"24px",t:"大"},{n:"xx-large",s:"32px",t:"特大"},{n:"-webkit-xxx-large",s:"48px",t:"極大"}],ib=[{s:"靠左對齊",v:"justifyleft"},{s:"置中",v:"justifycenter"},{s:"靠右對齊",v:"justifyright"},{s:"左右對齊",v:"justifyfull"}],jb=[{s:"數字列表",v:"insertOrderedList"},{s:"符號列表",v:"insertUnorderedList"}],kb={"default":{name:"預設",width:24,height:24,line:7,list:{smile:"微笑",tongue:"吐舌頭",titter:"偷笑",laugh:"大笑",sad:"難過",wronged:"委屈",fastcry:"快哭了",cry:"哭",wail:"大哭",mad:"生氣",knock:"敲打",curse:"罵人",crazy:"抓狂",angry:"發火",ohmy:"驚訝",awkward:"尷尬",panic:"驚恐",shy:"害羞",cute:"可憐",envy:"羨慕",proud:"得意",struggle:"奮鬥",quiet:"安靜",shutup:"閉嘴",doubt:"疑問",despise:"鄙視",sleep:"睡覺",bye:"再見"}}},ja={Cut:{t:"剪下 (Ctrl+X)"},Copy:{t:"複製 (Ctrl+C)"},Paste:{t:"貼上 (Ctrl+V)"},Pastetext:{t:"貼上文本",h:j?0:1},Blocktag:{t:"段落標籤",h:1},Fontface:{t:"字型",h:1},FontSize:{t:"字型大小",h:1},Bold:{t:"粗體 (Ctrl+B)",s:"Ctrl+B"},Italic:{t:"斜體 (Ctrl+I)",s:"Ctrl+I"},Underline:{t:"底線 (Ctrl+U)",s:"Ctrl+U"},Strikethrough:{t:"刪除線"},FontColor:{t:"字型顏色",h:1},BackColor:{t:"背景顏色",h:1},SelectAll:{t:"全選 (Ctrl+A)"},Removeformat:{t:"刪除文字格式"},Align:{t:"對齊",h:1},List:{t:"列表",h:1},Outdent:{t:"減少縮排"},Indent:{t:"增加縮排"},Link:{t:"超連結 (Ctrl+L)",s:"Ctrl+L",h:1},Unlink:{t:"取消超連結"},Anchor:{t:"錨點",h:1},Img:{t:"圖片",h:1},Flash:{t:"Flash動畫",h:1},Media:{t:"多媒體文件",h:1},Hr:{t:"插入水平線"},Emot:{t:"表情",s:"ctrl+e",h:1},Table:{t:"表格",h:1},Source:{t:"原始碼"},Preview:{t:"預覽"},Print:{t:"打印 (Ctrl+P)",s:"Ctrl+P"},Fullscreen:{t:"全螢幕編輯 (Esc)",s:"Esc"},About:{t:"關於 xhEditor"}},Ha={mini:"Bold,Italic,Underline,Strikethrough,|,Align,List,|,Link,Img",simple:"Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,|,Link,Img,Emot",full:"Cut,Copy,Paste,Pastetext,|,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,SelectAll,Removeformat,|,Align,List,Outdent,Indent,|,Link,Unlink,Anchor,Img,Flash,Media,Hr,Emot,Table,|,Source,Preview,Print,Fullscreen"};Ha.mfull=Ha.full.replace(/\|(,Align)/i,"/$1");var lb={a:"Link",img:"Img",embed:"Embed"},mb={"<":"&lt;",">":"&gt;",'"':"&quot;","®":"&reg;","©":"&copy;"},nb=/[<>"\u00ae\u00a9]/g,sa=function(z,n){function o(e){var e=e.target,t=lb[e.tagName.toLowerCase()];t&&("Embed"===t&&(t={"application/x-shockwave-flash":"Flash","application/x-mplayer2":"Media"}[e.type.toLowerCase()]),c.exec(t))}function H(e){return 27===e.which?(ua?c.removeModal():R&&c.hidePanel(),!1):void 0}function ia(){setTimeout(c.setSource,10)}function T(){c.getSource()}function Ua(t){var a,i,n;if(t&&(a=t.originalEvent.clipboardData)&&(i=a.items)&&(n=i[0])&&"file"==n.kind&&n.type.match(/^image\//i))return t=n.getAsFile(),a=new FileReader,a.onload=function(){var e='<img src="'+event.target.result+'">',e=Va(e);c.pasteHTML(e)},a.readAsDataURL(t),!1;var o=g.cleanPaste;if(0===o||x||Ia)return!0;Ia=!0,c.saveBookmark();var t=j?"pre":"div",s=e("<"+t+' class="xhe-paste">\ufeff\ufeff</'+t+">",l).appendTo(l.body),t=s[0];a=c.getSel(),i=c.getRng(!0),s.css("top",ea.scrollTop()),j?(i.moveToElementText(t),i.select()):(i.selectNodeContents(t),a.removeAllRanges(),a.addRange(i)),setTimeout(function(){var t,a=3===o;if(a)t=s.text();else{var i=[];e(".xhe-paste",l.body).each(function(t,a){0==e(a).find(".xhe-paste").length&&i.push(a.innerHTML)}),t=i.join("<br />")}s.remove(),c.loadBookmark(),(t=t.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,""))&&(a?c.pasteText(t):(t=c.cleanHTML(t),t=c.cleanWord(t),t=c.formatXHTML(t),(!g.onPaste||g.onPaste&&!1!==(t=g.onPaste(t)))&&(t=Va(t),c.pasteHTML(t)))),Ia=!1},0)}function Va(t){var a=g.localUrlTest,i=g.remoteImgSaveUrl;if(a&&i){var n=[],l=0,t=t.replace(/(<img)((?:\s+[^>]*?)?(?:\s+src="\s*([^"]+)\s*")(?: [^>]*)?)(\/?>)/gi,function(e,t,i,o,s){return/^(https?|data:image)/i.test(o)&&!a.test(o)&&(n[l]=o,i=i.replace(/\s+(width|height)="[^"]*"/gi,"").replace(/\s+src="[^"]*"/gi,' src="'+va+'img/waiting.gif" remoteimg="'+l++ +'"')),t+i+s});0<n.length&&e.post(i,{urls:n.join("|")},function(t){t=t.split("|"),e("img[remoteimg]",c.doc).each(function(){var a=e(this);K(a,"src",t[a.attr("remoteimg")]),a.removeAttr("remoteimg")})})}return t}function Ja(e){try{c._exec("styleWithCSS",e,!0)}catch(t){try{c._exec("useCSS",!e,!0)}catch(a){}}}function Ka(){if(La&&!x){Ja(!1);try{c._exec("enableObjectResizing",!0,!0)}catch(e){}if(j)try{c._exec("BackgroundImageCache",!0,!0)}catch(t){}}}function Ca(e){return x||13!==e.which||e.shiftKey||e.ctrlKey||e.altKey?!0:(e=c.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li"),e.is("li")?!0:g.forcePtag?void(0===e.length&&c._exec("formatblock","<p>")):(c.pasteHTML("<br />"),j&&0<e.length&&2===c.getRng().parentElement().childNodes.length&&c.pasteHTML("<br />"),!1))}function Ma(){!ra&&!Q&&(ka&&A.height("100%").css("height",A.outerHeight()-q.outerHeight()),j&&q.hide().show())}function ob(e){if(e=e.target,e.tagName.match(/(img|embed)/i)){var t=c.getSel(),a=c.getRng(!0);a.selectNode(e),t.removeAllRanges(),t.addRange(a)}}function K(e,t,a){if(!t)return!1;var i="_xhe_"+t;return a&&(wa&&(a=U(a,wa,E)),e.attr(t,E?U(a,"abs",E):a).removeAttr(i).attr(i,a)),e.attr(i)||e.attr(t)}function Na(){ta&&c.hidePanel()}function pb(t){if(x)return!0;var a=t.which,i=fb[a],a=i?i:String.fromCharCode(a).toLowerCase();sKey="",sKey+=t.ctrlKey?"ctrl+":"",sKey+=t.altKey?"alt+":"",sKey+=t.shiftKey?"shift+":"",sKey+=a;var n,t=la[sKey];for(n in t){if(n=t[n],!e.isFunction(n))return c.exec(n),!1;if(!1===n.call(c))return!1}}function L(e,t){var a=typeof e;return t?"array"===t&&e.hasOwnProperty&&e instanceof Array?!0:a===t:"undefined"!=a}function U(t,a,i){if(t.match(/^(\w+):\/\//i)&&!t.match(/^https?:/i)||/^#/i.test(t)||/^data:/i.test(t))return t;var n=i?e('<a href="'+i+'" />')[0]:location,i=n.protocol,l=n.host,o=n.hostname,s=n.port,n=n.pathname.replace(/\\/g,"/").replace(/[^\/]+$/i,"");if(""===s&&(s="80"),""===n?n="/":"/"!==n.charAt(0)&&(n="/"+n),t=e.trim(t),"abs"!==a&&(t=t.replace(RegExp(i+"\\/\\/"+o.replace(/\./g,"\\.")+"(?::"+s+")"+("80"===s?"?":"")+"(/|$)","i"),"/")),"rel"===a&&(t=t.replace(RegExp("^"+n.replace(/([\/\.\+\[\]\(\)])/g,"\\$1"),"i"),"")),"rel"!==a&&(t.match(/^(https?:\/\/|\/)/i)||(t=n+t),"/"===t.charAt(0))){for(var o=[],t=t.split("/"),r=t.length,n=0;r>n;n++)s=t[n],".."===s?o.pop():""!==s&&"."!==s&&o.push(s);""===t[r-1]&&o.push(""),t="/"+o.join("/")}return"abs"===a&&!t.match(/^https?:\/\//i)&&(t=i+"//"+l+t),t=t.replace(/(https?:\/\/[^:\/?#]+):80(\/|$)/i,"$1$2")}function Wa(e,t){return"*"===t||e.match(RegExp(".("+t.replace(/,/g,"|")+")$","i"))?!0:(alert("上傳文件擴展名必需為: "+t),!1)}function Xa(e){var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(t))).toFixed(2)+"Byte,KB,MB,GB,TB,PB".split(",")[t]}function M(){return!1}var c=this,y=e(z),Ya=y.closest("form"),q,A,V,ea,l,fa,ma=y.offsetParent().css("zIndex"),ga,La=!1,x=!1,ka=!1,Ia=!1,Oa,na=!1,Za="",w=null,xa,oa=!1,Pa=!1,ha=null,W=null,N=0,g=c.settings=e.extend({},sa.settings,n),ya=g.plugins,za=[];if(ya&&(ja=e.extend({},ja,ya),e.each(ya,function(e){za.push(e)}),za=za.join(",")),g.tools.match(/^\s*(m?full|simple|mini)\s*$/i)){var $a=Ha[e.trim(g.tools)];g.tools=g.tools.match(/m?full/i)&&ya?$a.replace("Table","Table,"+za):$a}g.tools.match(/(^|,)\s*About\s*(,|$)/i)||(g.tools+=",About"),g.tools=g.tools.split(","),g.editorRoot&&(J=g.editorRoot),!1===eb&&(J=U(J,"abs")),g.urlBase&&(g.urlBase=U(g.urlBase,"abs"));var ab="xheCSS_"+g.skin,pa="xhe"+$+"_container",bb="xhe"+$+"_Tool",cb="xhe"+$+"_iframearea",db="xhe"+$+"_iframe",Aa="xhe"+$+"_fixffcursor",O="",P="",va=J+"xheditor_skin/"+g.skin+"/",Ba=kb,wa=g.urlType,E=g.urlBase,X=g.emotPath,X=X?X:J+"xheditor_emot/",Qa="",Ba=e.extend({},Ba,g.emots),X=U(X,"rel",E?E:null);(na=g.showBlocktag)&&(P+=" showBlocktag");var la=[];this.init=function(){0===e("#"+ab).length&&e("head").append('<link id="'+ab+'" rel="stylesheet" type="text/css" href="'+va+'ui.css" />');var a=y.outerWidth(),i=y.outerHeight(),a=g.width||z.style.width||(a>10?a:0);N=g.height||z.style.height||(i>10?i:150),L(a,"number")&&(a+="px"),L(N,"string")&&(N=N.replace(/[^\d]+/g,""));var n,s,i=g.background||z.style.background,r=['<span class="xheGStart"/>'],h=/\||\//i;if(e.each(g.tools,function(e,t){if(t.match(h)&&r.push('<span class="xheGEnd"/>'),"|"===t)r.push('<span class="xheSeparator"/>');else if("/"===t)r.push("<br />");else{if(n=ja[t],!n)return;s=n.c?n.c:"xheIcon xheBtn"+t,r.push('<span><a href="#" title="'+n.t+'" cmd="'+t+'" class="xheButton xheEnabled" tabindex="-1" role="button"><span class="'+s+'" unselectable="on" style="font-size:0;color:transparent;text-indent:-999px;">'+n.t+"</span></a></span>"),n.s&&c.addShortcuts(n.s,t)}t.match(h)&&r.push('<span class="xheGStart"/>')}),r.push('<span class="xheGEnd"/><br />'),y.after(e('<input type="text" id="'+Aa+'" style="position:absolute;display:none;" /><span id="'+pa+'" class="xhe_'+g.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xheLayout" style="'+("0px"!=a?"width:"+a+";":"")+"height:"+N+'px;" role="presentation"><tr><td id="'+bb+'" class="xheTool" unselectable="on" style="height:1px;" role="presentation"></td></tr><tr><td id="'+cb+'" class="xheIframeArea" role="presentation"><iframe frameborder="0" id="'+db+'" src="javascript:;" style="width:100%;"></iframe></td></tr></table></span>')),q=e("#"+bb),A=e("#"+cb),O='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" href="'+va+'iframe.css"/>',a=g.loadCSS)if(L(a,"array"))for(var d in a)O+='<link rel="stylesheet" href="'+a[d]+'"/>';else O=a.match(/\s*<style(\s+[^>]*?)?>[\s\S]+?<\/style>\s*/i)?O+a:O+('<link rel="stylesheet" href="'+a+'"/>');d="<html><head>"+O+"<title>可視化編輯器,alt+1到9鍵,切換到工具區,tab鍵,選擇按鈕,esc鍵,返回編輯 "+(g.readTip?g.readTip:"")+"</title>",i&&(d+="<style>html{background:"+i+";}</style>"),d+='</head><body spellcheck="0" class="editMode'+P+'"></body></html>',c.win=V=e("#"+db)[0].contentWindow,ea=e(V);try{this.doc=l=V.document,fa=e(l),l.open(),l.write(d),l.close(),j?l.body.contentEditable="true":l.designMode="On"}catch(u){}if(setTimeout(Ka,300),c.setSource(),V.setInterval=null,q.append(r.join("")).bind("mousedown contextmenu",M).click(function(t){var a=e(t.target).closest("a");return a.is(".xheEnabled")&&(clearTimeout(xa),q.find("a").attr("tabindex","-1"),w=t,c.exec(a.attr("cmd"))),!1}),q.find(".xheButton").hover(function(t){var a=e(this),i=g.hoverExecDelay,n=W;if(W=null,-1===i||oa||!a.is(".xheEnabled"))return!1;if(n&&n>10)return oa=!0,setTimeout(function(){oa=!1},100),!1;var l=a.attr("cmd");return 1!==ja[l].h?(c.hidePanel(),!1):(Pa&&(i=0),void(i>=0&&(xa=setTimeout(function(){w=t,ha={x:w.clientX,y:w.clientY},c.exec(l)},i))))},function(){ha=null,xa&&clearTimeout(xa)}).mousemove(function(e){if(ha){var t=e.clientX-ha.x,a=e.clientY-ha.y;(1<Math.abs(t)||1<Math.abs(a))&&(t>0&&a>0?(t=Math.round(Math.atan(a/t)/.017453293),W=W?(W+t)/2:t):W=null,ha={x:e.clientX,y:e.clientY})}}),t=e("#xhePanel"),aa=e("#xheShadow"),ba=e("#xheCntLine"),0===t.length&&(t=e('<div id="xhePanel"></div>').mousedown(function(e){e.stopPropagation()}),aa=e('<div id="xheShadow"></div>'),ba=e('<div id="xheCntLine"></div>'),setTimeout(function(){e(document.body).append(t).append(aa).append(ba)},10)),e("#"+pa).show(),y.hide(),A.css("height",N-q.outerHeight()),j&8>qa&&setTimeout(function(){A.css("height",N-q.outerHeight())},1),y.focus(c.focus),Ya.submit(T).bind("reset",ia),g.submitID&&e("#"+g.submitID).click(T),e(window).bind("unload beforeunload",T).bind("resize",Ma),e(document).mousedown(Na),Sa||(e(document).keydown(H),Sa=!0),ea.focus(function(){g.focus&&g.focus()}).blur(function(){g.blur&&g.blur()}),Q&&ea.click(ob),fa.mousedown(Na).keydown(pb).keypress(Ca).dblclick(o).bind("mousedown click",function(e){y.trigger(e.type)}),j){fa.keydown(function(t){var a=c.getRng();return 8===t.which&&a.item?(e(a.item(0)).remove(),!1):void 0});var p=function(t){var a,t=e(t.target);(a=t.css("width"))&&t.css("width","").attr("width",a.replace(/[^0-9%]+/g,"")),(a=t.css("height"))&&t.css("height","").attr("height",a.replace(/[^0-9%]+/g,""))};fa.bind("controlselect",function(t){t=t.target,e.nodeName(t,"IMG")&&e(t).unbind("resizeend",p).bind("resizeend",p)})}return fa.keydown(function(e){var t=e.which;return e.altKey&&t>=49&&57>=t?(q.find("a").attr("tabindex","0"),q.find(".xheGStart").eq(t-49).next().find("a").focus(),l.title="\ufeff\ufeff",!1):void 0}).click(function(){q.find("a").attr("tabindex","-1")}),q.keydown(function(e){var t=e.which;if(27==t)q.find("a").attr("tabindex","-1"),c.focus();else if(e.altKey&&t>=49&&57>=t)return q.find(".xheGStart").eq(t-49).next().find("a").focus(),!1}),d=e(l.documentElement),Ra?d.bind("keydown",function(e){e.ctrlKey&&86===e.which&&Ua()}):d.bind(j?"beforepaste":"paste",Ua),g.disableContextmenu&&d.bind("contextmenu",M),g.html5Upload&&d.bind("dragenter dragover",function(t){var a;return(a=t.originalEvent.dataTransfer.types)&&-1!==e.inArray("Files",a)?!1:void 0}).bind("drop",function(t){var a,t=t.originalEvent.dataTransfer;if(t&&(a=t.files)&&0<a.length){var i,n,l,t=["Link","Img","Flash","Media"],o=[];for(i in t)n=t[i],g["up"+n+"Url"]&&g["up"+n+"Url"].match(/^[^!].*/i)&&o.push(n+":,"+g["up"+n+"Ext"]);return 0===o.length?!1:(l=o.join(","),n=function(e){var t,a;for(i=0;i<e.length;i++){if(t=e[i].name.replace(/.+\./,""),!(t=l.match(RegExp("(\\w+):[^:]*,"+t+"(?:,|$)","i"))))return 1;if(a){if(a!==t[1])return 2}else a=t[1]}return a}(a),1===n?alert("上傳文件的擴展名必需為："+l.replace(/\w+:,/g,"")):2===n?alert("每次只能拖放上傳同一類型文件"):n&&c.startUpload(a,g["up"+n+"Url"],"*",function(t){var a,i=[];(a=g.onUpload)&&a(t);for(var l=0,o=t.length;o>l;l++)a=t[l],url=L(a,"string")?a:a.url,"!"===url.substr(0,1)&&(url=url.substr(1)),i.push(url);c.exec(n),e("#xhe"+n+"Url").val(i.join(" ")),e("#xheSave").click()}),!1)}}),(d=g.shortcuts)&&e.each(d,function(e,t){c.addShortcuts(e,t)}),$++,La=!0,g.fullscreen?c.toggleFullscreen():g.sourceMode&&setTimeout(c.toggleSource,20),!0},this.remove=function(){c.hidePanel(),T(),y.unbind("focus",c.focus),Ya.unbind("submit",T).unbind("reset",ia),g.submitID&&e("#"+g.submitID).unbind("mousedown",T),e(window).unbind("unload beforeunload",T).unbind("resize",Ma),e(document).unbind("mousedown",Na),e("#"+pa).remove(),e("#"+Aa).remove(),y.show(),La=!1},this.saveBookmark=function(){if(!x){c.focus();var e=c.getRng(),e=e.cloneRange?e.cloneRange():e;ga={top:ea.scrollTop(),rng:e}}},this.loadBookmark=function(){if(!x&&ga){c.focus();var e=ga.rng;if(j)e.select();else{var t=c.getSel();t.removeAllRanges(),t.addRange(e)}ea.scrollTop(ga.top),ga=null}},this.focus=function(){if(x?e("#sourceCode",l).focus():V.focus(),j){var t=c.getRng();t.parentElement&&t.parentElement().ownerDocument!==l&&c.setTextCursor()}return!1},this.setTextCursor=function(e){var t=c.getRng(!0),a=l.body;if(j)t.moveToElementText(a);else{for(var i=e?"lastChild":"firstChild";3!=a.nodeType&&a[i];)a=a[i];t.selectNode(a)}t.collapse(e?!1:!0),j?t.select():(e=c.getSel(),e.removeAllRanges(),e.addRange(t))},this.getSel=function(){return l.selection?l.selection:V.getSelection()},this.getRng=function(e){var t,a;try{e||(t=c.getSel(),a=t.createRange?t.createRange():0<t.rangeCount?t.getRangeAt(0):null),a||(a=l.body.createTextRange?l.body.createTextRange():l.createRange())}catch(i){}return a},this.getParent=function(t){var a,i=c.getRng();return j?a=i.item?i.item(0):i.parentElement():(a=i.commonAncestorContainer,i.collapsed||i.startContainer===i.endContainer&&2>i.startOffset-i.endOffset&&i.startContainer.hasChildNodes()&&(a=i.startContainer.childNodes[i.startOffset])),t=t?t:"*",a=e(a),a.is(t)||(a=e(a).closest(t)),a},this.getSelect=function(t){var a=c.getSel(),i=c.getRng(),n=!0,n=!i||i.item?!1:!a||0===i.boundingWidth||i.collapsed;return"text"===t?n?"":i.text||(a.toString?a.toString():""):(i.cloneContents?(t=e("<div></div>"),(i=i.cloneContents())&&t.append(i),i=t.html()):i=L(i.item)?i.item(0).outerHTML:L(i.htmlText)?i.htmlText:i.toString(),n&&(i=""),i=c.processHTML(i,"read"),i=c.cleanHTML(i),i=c.formatXHTML(i))},this.pasteHTML=function(t,a){if(x)return!1;c.focus();var t=c.processHTML(t,"write"),i=c.getSel(),n=c.getRng();if(a!==Z){if(n.item){var o=n.item(0),n=c.getRng(!0);n.moveToElementText(o),n.select()}n.collapse(a)}if(t+="<"+(j?"img":"span")+' id="_xhe_temp" width="0" height="0" />',n.insertNode){if(0<e(n.startContainer).closest("style,script").length)return!1;n.deleteContents(),n.insertNode(n.createContextualFragment(t))}else"control"===i.type.toLowerCase()&&(i.clear(),n=c.getRng()),n.pasteHTML(t);var o=e("#_xhe_temp",l),s=o[0];j?(n.moveToElementText(s),n.select()):(n.selectNode(s),i.removeAllRanges(),i.addRange(n)),o.remove()},this.pasteText=function(e,t){e||(e=""),e=c.domEncode(e),e=e.replace(/\r?\n/g,"<br />"),c.pasteHTML(e,t)},this.appendHTML=function(t){return x?!1:(c.focus(),t=c.processHTML(t,"write"),e(l.body).append(t),void c.setTextCursor(!0))},this.domEncode=function(e){return e.replace(nb,function(e){return mb[e]})},this.setSource=function(t){ga=null,"string"!=typeof t&&""!==t&&(t=z.value),x?e("#sourceCode",l).val(t):(g.beforeSetSource&&(t=g.beforeSetSource(t)),t=c.cleanHTML(t),t=c.formatXHTML(t),t=c.processHTML(t,"write"),j?(l.body.innerHTML='<img id="_xhe_temp" width="0" height="0" />'+t,e("#_xhe_temp",l).remove()):l.body.innerHTML=t)},this.processHTML=function(e,t){if("write"===t){if(e=e.replace(/(<(\/?)(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*((\/?)>)/g,function(e,t,a,i,n,l,o){i=i.toLowerCase(),ra?"strong"===i?i="b":"em"===i&&(i="i"):Q&&("strong"===i?(i="span",a||(n+=' class="Apple-style-span" style="font-weight: bold;"')):"em"===i?(i="span",a||(n+=' class="Apple-style-span" style="font-style: italic;"')):"u"===i?(i="span",a||(n+=' class="Apple-style-span" style="text-decoration: underline;"')):"strike"===i&&(i="span",a||(n+=' class="Apple-style-span" style="text-decoration: line-through;"')));var s,r="";"del"===i?i="strike":"img"===i?n=n.replace(/\s+emot\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(e,t){return s=t.match(/^(["']?)(.*)\1/)[2],s=s.split(","),s[1]||(s[1]=s[0],s[0]=""),"default"===s[0]&&(s[0]=""),g.emotMark?e:""}):"a"===i?(!n.match(/ href=[^ ]/i)&&n.match(/ name=[^ ]/i)&&(r+=" xhe-anchor"),o&&(l="></a>")):"table"!==i||a||(e=n.match(/\s+border\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i),e&&!e[1].match(/^(["']?)\s*0\s*\1$/))||(r+=" xhe-border");var c,n=n.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(e,t,a){return t=t.toLowerCase(),a=a.match(/^(["']?)(.*)\1/)[2],aft="",j&&t.match(/^(disabled|checked|readonly|selected)$/)&&a.match(/^(false|0)$/i)||"img"===i&&s&&"src"===t?"":(t.match(/^(src|href)$/)&&(aft=" _xhe_"+t+'="'+a+'"',E&&(a=U(a,"abs",E))),r&&"class"===t&&(a+=" "+r,r=""),Q&&"style"===t&&"span"===i&&a.match(/(^|;)\s*(font-family|font-size|color|background-color)\s*:\s*[^;]+\s*(;|$)/i)&&(c=!0)," "+t+'="'+a+'"'+aft)});return s&&(e=X+(s[0]?s[0]:"default")+"/"+s[1]+".gif",n+=' src="'+e+'" _xhe_src="'+e+'"'),c&&(n+=' class="Apple-style-span"'),r&&(n+=' class="'+r+'"'),"<"+a+i+n+l}),j&&(e=e.replace(/&apos;/gi,"&#39;")),!Q)var a=function(e,t,a,i){var n,l,t="";if((n=a.match(/font-family\s*:\s*([^;"]+)/i))&&(t+=' face="'+n[1]+'"'),n=a.match(/font-size\s*:\s*([^;"]+)/i)){n=n[1].toLowerCase();for(var o=0;o<S.length;o++)if(n===S[o].n||n===S[o].s){l=o+1;break}l&&(t+=' size="'+l+'"',a=a.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/gi,"$1"))}if(l=a.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i)){if(n=l[1].match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i))for(l[1]="#",o=1;3>=o;o++)l[1]+=(n[o]-0).toString(16);l[1]=l[1].replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3"),t+=' color="'+l[1]+'"'}return a=a.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/gi,"$1"),""!==t?(a&&(t+=' style="'+a+'"'),"<font"+t+">"+i+"</font>"):e},e=e.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,a),e=e.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,a),e=e.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,a);e=e.replace(/<(td|th)(\s+[^>]*?)?>(\s|&nbsp;)*<\/\1>/gi,"<$1$2>"+(j?"":"<br />")+"</$1>")}else{if(Q)for(var i=[{r:/font-weight:\sbold/gi,t:"strong"},{r:/font-style:\sitalic/gi,t:"em"},{r:/text-decoration:\sunderline/gi,t:"u"},{r:/text-decoration:\sline-through/gi,t:"strike"}],a=function(e,t,a,n,l){if(t=a+n,a="",!t)return l;for(n=0;n<i.length;n++)if(t.match(i[n].r)){a=i[n].t;break}return a?"<"+a+">"+l+"</"+a+">":e},n=0;2>n;n++)e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,a),e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,a),e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,a);e=e.replace(/(<(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/g,function(e,t,a,i,n){var l,a=a.toLowerCase(),i=i.replace(/\s+_xhe_(?:src|href)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(e,t){return l=t.match(/^(["']?)(.*)\1/)[2],""});return l&&wa&&(l=U(l,wa,E)),i=i.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(e,t,a){if(t=t.toLowerCase(),a=a.match(/^(["']?)(.*)\1/)[2],"class"===t){if(a.match(/^["']?(apple|webkit)/i))return"";if(a=a.replace(/\s?xhe-[a-z]+/gi,""),""===a)return""}else{if(t.match(/^((_xhe_|_moz_|_webkit_)|jquery\d+)/i))return"";if(l&&t.match(/^(src|href)$/i))return" "+t+'="'+l+'"';"style"===t&&(a=a.replace(/(^|;)\s*(font-size)\s*:\s*([a-z-]+)\s*(;|$)/i,function(e,t,a,i,n){for(var l,o=0;o<S.length;o++)if(e=S[o],i===e.n){l=e.s;break}return t+a+":"+l+n}))}return" "+t+'="'+a+'"'}),"img"===a&&!i.match(/\s+alt\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i)&&(i+=' alt=""'),t+i+n}),e=e.replace(/(<(td|th)(?:\s+[^>]*?)?>)\s*([\s\S]*?)(<br(\s*\/)?>)?\s*<\/\2>/gi,function(e,t,a,i){return t+(i?i:"&nbsp;")+"</"+a+">"}),e=e.replace(/^\s*(?:<(p|div)(?:\s+[^>]*?)?>)?\s*(<span(?:\s+[^>]*?)?>\s*<\/span>|<br(?:\s+[^>]*?)?>|&nbsp;)*\s*(?:<\/\1>)?\s*$/i,"")}return e=e.replace(/(<pre(?:\s+[^>]*?)?>)([\s\S]+?)(<\/pre>)/gi,function(e,t,a,i){return t+a.replace(/<br\s*\/?>/gi,"\r\n")+i})},this.getSource=function(t){var a,i=g.beforeGetSource;return x?(a=e("#sourceCode",l).val(),i||(a=c.formatXHTML(a,!1))):(a=c.processHTML(l.body.innerHTML,"read"),a=c.cleanHTML(a),a=c.formatXHTML(a,t),i&&(a=i(a))),z.value=a},this.cleanWord=function(t){var a=g.cleanPaste;if(a>0&&3>a&&t.match(/mso(-|normal)|WordDocument|<table\s+[^>]*?x:str/i))for(var t=t.replace(/<\!--[\s\S]*?--\>|<!(--)?\[[\s\S]+?\](--)?>|<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,""),t=t.replace(/\r?\n/gi,""),t=t.replace(/(<(\/?)([\w\-:]+))((?:\s+[\w\-:]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))?)*)\s*(\/?>)/g,function(t,i,n,l,o,s){return l=l.toLowerCase(),l.match(/^(link|img)$/)&&o.match(/file:\/\//i)||l.match(/:/)||"span"===l&&2===a?"":(n||(o=o.replace(/\s([\w\-:]+)(?:\s*=\s*("[^"]*"|'[^']*'|[^>\s]+))?/gi,function(t,i,n){return i=i.toLowerCase(),n=n.match(/^(["']?)(.*)\1/)[2],i.match(/:/)||i.match(/^(class|lang|language|span)$/)||"td"===l&&("height"===i||"width"===i&&!o.match(/\scolspan="\d+"/i))?"":"style"===i?2===a?"":(n=e.trim(n.replace(/\s*(mso-[^:]+:.+?|margin\s*:\s*0cm 0cm 0pt\s*|(text-align|font-variant|line-height)\s*:\s*.+?)(;|$)\s*/gi,"")))?" "+i+'="'+n.replace(/"/g,"'")+'"':"":t})),i+o+s)}),i=0;3>i;i++)t=t.replace(/<([^\s>]+)(\s+[^>]*)?>\s*<\/\1>/g,function(e,t){return t.match(/^a$/i)?e:""});return t},this.cleanHTML=function(e){var t,e=e.replace(/<!?\/?(DOCTYPE|html|body|meta)(\s+[^>]*?)?>/gi,""),e=e.replace(/<head(?:\s+[^>]*?)?>([\s\S]*?)<\/head>/i,function(e,a){return t=a.match(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/gi),""});return t&&(e=t.join("")+e),e=e.replace(/<\??xml(:\w+)?(\s+[^>]*?)?>([\s\S]*?<\/xml>)?/gi,""),g.internalScript||(e=e.replace(/<script(\s+[^>]*?)?>[\s\S]*?<\/script>/gi,"")),g.internalStyle||(e=e.replace(/<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,"")),g.linkTag&&g.inlineScript&&g.inlineStyle||(e=e.replace(/(<(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/gi,function(e,t,a,i,n){return g.linkTag||"link"!==a.toLowerCase()?(g.inlineScript||(i=i.replace(/\s+on(?:click|dblclick|mouse(down|up|move|over|out|enter|leave|wheel)|key(down|press|up)|change|select|submit|reset|blur|focus|load|unload)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"")),g.inlineStyle||(i=i.replace(/\s+(style|class)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"")),t+i+n):""})),e=e.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1(\s+[^>]*?)?>/gi,"$2")},this.formatXHTML=function(e,t){function a(e){for(var t={},e=e.split(","),a=0;a<e.length;a++)t[e[a]]=!0;return t}function i(e){var e=e.toLowerCase(),t=x[e];return t?t:e}function n(e,t,a){if(p[e])for(;k.last()&&f[k.last()];)l(k.last());g[e]&&k.last()===e&&l(e),(a=u[e]||!!a)||k.push(e);var i=[];i.push("<"+e),t.replace(y,function(e,t,a,n,l){t=t.toLowerCase(),i.push(" "+t+'="'+(a?a:n?n:l?l:m[t]?t:"").replace(/"/g,"'")+'"')}),i.push((a?" /":"")+">"),r(i.join(""),e,!0),"pre"===e&&(H=!0)}function l(e){if(e)for(t=k.length-1;t>=0&&k[t]!==e;t--);else var t=0;if(t>=0){for(var a=k.length-1;a>=t;a--)r("</"+k[a]+">",k[a]);k.length=t}"pre"===e&&(H=!1,A--)}function o(e){r(c.domEncode(e))}function s(e){w.push(e.replace(/^[\s\r\n]+|[\s\r\n]+$/g,""))}function r(e,a,i){if(H||(e=e.replace(/(\t*\r?\n\t*)+/g,"")),H||!0!==t)w.push(e);else if(e.match(/^\s*$/))w.push(e);else{var n=p[a];n?(i&&A++,""===j&&A--):j&&A++,((n?a:"")!==j||n)&&h(),w.push(e),"br"===a&&h(),n&&(u[a]||!i)&&A--,j=n?a:""}}function h(){if(w.push("\r\n"),A>0)for(var e=A;e--;)w.push("	")}function d(e,t,a,i){return a?(e="",(t=a.match(/ face\s*=\s*"\s*([^"]+)\s*"/i))&&(e+="font-family:"+t[1]+";"),(t=a.match(/ size\s*=\s*"\s*(\d+)\s*"/i))&&(e+="font-size:"+S[(7<t[1]?7:1>t[1]?1:t[1])-1].s+";"),(t=a.match(/ color\s*=\s*"\s*([^"]+)\s*"/i))&&(e+="color:"+t[1]+";"),(a=a.match(/ style\s*=\s*"\s*([^"]+)\s*"/i))&&(e+=a[1]),e&&(i='<span style="'+e+'">'+i+"</span>"),i):i}var u=a("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),p=a("address,applet,blockquote,button,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,table,tbody,td,tfoot,th,thead,tr,ul,script"),f=a("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),g=a("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),m=a("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),v=a("script,style"),x={b:"strong",i:"em",s:"del",strike:"del"},b=/<(?:\/([^\s>]+)|!([^>]*?)|([\w\-:]+)((?:"[^"]*"|'[^']*'|[^"'<>])*)\s*(\/?))>/g,y=/\s*([\w\-:]+)(?:\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g,w=[],k=[];k.last=function(){return this[this.length-1]};for(var C,T,F,M,L=0,A=-1,j="body",H=!1;C=b.exec(e);)T=C.index,T>L&&(L=e.substring(L,T),F?M.push(L):o(L)),L=b.lastIndex,!(T=C[1])||(T=i(T),F&&T===F&&(s(M.join("")),M=F=null),F)?F?M.push(C[0]):(T=C[3])?(T=i(T),n(T,C[4],C[5]),v[T]&&(F=T,M=[])):C[2]&&w.push(C[0]):l(T);return e.length>L&&o(e.substring(L,e.length)),l(),e=w.join(""),w=null,e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,d),e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,d),e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,d),e=e.replace(/^(\s*\r?\n)+|(\s*\r?\n)+$/g,"")},this.toggleShowBlocktag=function(t){na!==t&&(na=!na,t=e(l.body),na?(P+=" showBlocktag",t.addClass("showBlocktag")):(P=P.replace(" showBlocktag",""),t.removeClass("showBlocktag")))},this.toggleSource=function(t){if(x!==t){q.find("[cmd=Source]").toggleClass("xheEnabled").toggleClass("xheActive");var a,i,n=l.body,o=e(n),t=0,s="";x?(a=c.getSource(),o.html("").removeAttr("scroll").attr("class","editMode"+P),j?n.contentEditable="true":l.designMode="On",ra&&(c._exec("inserthtml","-"),e("#"+Aa).show().focus().hide()),s="原始碼"):(c.pasteHTML('<span id="_xhe_cursor"></span>',!0),a=c.getSource(!0),t=a.indexOf('<span id="_xhe_cursor"></span>'),Ra||(t=a.substring(0,t).replace(/\r/g,"").length),a=a.replace(/(\r?\n\s*|)<span id="_xhe_cursor"><\/span>(\s*\r?\n|)/,function(e,t,a){return t&&a?"\r\n":t+a}),j?n.contentEditable="false":l.designMode="Off",o.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" style="width:100%;height:100%" />'),i=e("#sourceCode",o).blur(c.getSource)[0],s="可視化編輯"),x=!x,c.setSource(a),c.focus(),x?i.setSelectionRange?i.setSelectionRange(t,t):(i=i.createTextRange(),i.move("character",t),i.select()):c.setTextCursor(),q.find("[cmd=Source]").attr("title",s).find("span").text(s),q.find("[cmd=Source],[cmd=Preview]").toggleClass("xheEnabled"),q.find(".xheButton").not("[cmd=Source],[cmd=Fullscreen],[cmd=About]").toggleClass("xheEnabled").attr("aria-disabled",x?!0:!1),setTimeout(Ka,300)}},this.showPreview=function(){var e=g.beforeSetSource,t=c.getSource();e&&(t=e(t));var e="<html><head>"+O+"<title>預覽</title>"+(E?'<base href="'+E+'"/>':"")+"</head><body>"+t+"</body></html>",t=window.screen,t=window.open("","xhePreview","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+Math.round(.9*t.width)+",height="+Math.round(.8*t.height)+",left="+Math.round(.05*t.width)),a=t.document;
a.open(),a.write(e),a.close(),t.focus()},this.toggleFullscreen=function(t){if(ka!==t){var t=e("#"+pa).find(".xheLayout"),a=e("#"+pa),i=jQuery.browser.version,i=j&&(6==i||7==i);ka?(i&&y.after(a),t.attr("style",Za),A.height(N-q.outerHeight()),e(window).scrollTop(Oa),setTimeout(function(){e(window).scrollTop(Oa)},10)):(i&&e("body").append(a),Oa=e(window).scrollTop(),Za=t.attr("style"),t.removeAttr("style"),A.height("100%"),setTimeout(Ma,100)),ra?(e("#"+Aa).show().focus().hide(),setTimeout(c.focus,1)):i&&c.setTextCursor(),ka=!ka,a.toggleClass("xhe_Fullscreen"),e("html").toggleClass("xhe_Fullfix"),q.find("[cmd=Fullscreen]").toggleClass("xheActive"),setTimeout(Ka,300)}},this.showMenu=function(t,a){var i=e('<div class="xheMenu"></div>'),n=t.length,l=[];e.each(t,function(e,t){l.push("<a href=\"javascript:void('"+t.v+'\')" title="'+(t.t?t.t:t.s)+'" v="'+t.v+'" role="option" aria-setsize="'+n+'" aria-posinset="'+(e+1)+'" tabindex="0">'+t.s+"</a>")}),i.append(l.join("")),i.click(function(t){return t=t.target,e.nodeName(t,"DIV")?void 0:(c.loadBookmark(),a(e(t).closest("a").attr("v")),c.hidePanel(),!1)}).mousedown(M),c.saveBookmark(),c.showPanel(i)},this.showColor=function(t){var a=e('<div class="xheColor"></div>'),i=[],n=Ta.length,l=0;e.each(Ta,function(e,t){0===l%7&&i.push((l>0?"</div>":"")+"<div>"),i.push("<a href=\"javascript:void('"+t+'\')" xhev="'+t+'" title="'+t+'" style="background:'+t+'" role="option" aria-setsize="'+n+'" aria-posinset="'+(l+1)+'"></a>'),l++}),i.push("</div>"),a.append(i.join("")),a.click(function(a){return a=a.target,e.nodeName(a,"A")?(c.loadBookmark(),t(e(a).attr("xhev")),c.hidePanel(),!1):void 0}).mousedown(M),c.saveBookmark(),c.showPanel(a)},this.showPastetext=function(){var t=e('<div><label for="xhePastetextValue">使用鍵盤快捷鍵(Ctrl+V)把內容貼上到方框裡，按 確定</label></div><div><textarea id="xhePastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="確定" /></div>'),a=e("#xhePastetextValue",t);e("#xheSave",t).click(function(){c.loadBookmark();var e=a.val();return e&&c.pasteText(e),c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showLink=function(){var t='<div><label for="xheLinkUrl">鏈接地址: </label><input type="text" id="xheLinkUrl" value="http://" class="xheText" /></div><div><label for="xheLinkTarget">打開方式: </label><select id="xheLinkTarget"><option selected="selected" value="">預設</option><option value="_blank">新窗口</option><option value="_self">當前窗口</option><option value="_parent">父窗口</option></select></div><div style="display:none"><label for="xheLinkText">鏈接文字: </label><input type="text" id="xheLinkText" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="確定" /></div>',a=fa.find("a[name]").not("[href]"),i=0<a.length;if(i){var n=[];a.each(function(){var t=e(this).attr("name");n.push('<option value="#'+t+'">'+t+"</option>")}),t=t.replace(/(<div><label for="xheLinkTarget)/,'<div><label for="xheLinkAnchor">頁內錨點: </label><select id="xheLinkAnchor"><option value="">未選擇</option>'+n.join("")+"</select></div>$1")}var t=e(t),o=c.getParent("a"),s=e("#xheLinkText",t),r=e("#xheLinkUrl",t),h=e("#xheLinkTarget",t),a=e("#xheSave",t),d=c.getSelect();if(i&&t.find("#xheLinkAnchor").change(function(){var t=e(this).val();""!=t&&r.val(t)}),1===o.length){if(!o.attr("href"))return w=null,c.exec("Anchor");r.val(K(o,"href")),h.attr("value",o.attr("target"))}else""===d&&s.val(g.defLinkText).closest("div").show();g.upLinkUrl&&c.uploadInit(r,g.upLinkUrl,g.upLinkExt),a.click(function(){c.loadBookmark();var t=r.val();if((""===t||0===o.length)&&c._exec("unlink"),""!==t&&"http://"!==t){var a=t.split(" "),i=h.val(),n=s.val();if(1<a.length){c._exec("unlink"),d=c.getSelect();var u='<a href="xhe_tmpurl"',p=[];""!==i&&(u+=' target="'+i+'"');for(var u=u+">xhe_tmptext</a>",n=""!==d?d:n?n:t,f=0,g=a.length;g>f;f++)t=a[f],""!==t&&(t=t.split("||"),i=u,i=i.replace("xhe_tmpurl",t[0]),i=i.replace("xhe_tmptext",t[1]?t[1]:n),p.push(i));c.pasteHTML(p.join("&nbsp;"))}else t=a[0].split("||"),n||(n=t[0]),n=t[1]?t[1]:""!==d?"":n?n:t[0],0===o.length?(n?c.pasteHTML('<a href="#xhe_tmpurl">'+n+"</a>"):c._exec("createlink","#xhe_tmpurl"),o=e('a[href$="#xhe_tmpurl"]',l)):n&&!Q&&o.text(n),K(o,"href",t[0]),""!==i?o.attr("target",i):o.removeAttr("target")}return c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showAnchor=function(){var t=e('<div><label for="xheAnchorName">錨點名稱: </label><input type="text" id="xheAnchorName" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="確定" /></div>'),a=c.getParent("a"),i=e("#xheAnchorName",t),n=e("#xheSave",t);if(1===a.length){if(a.attr("href"))return w=null,c.exec("Link");i.val(a.attr("name"))}n.click(function(){c.loadBookmark();var e=i.val();return e?0===a.length?c.pasteHTML('<a name="'+e+'"></a>'):a.attr("name",e):1===a.length&&a.remove(),c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showImg=function(){var t=e('<div><label for="xheImgUrl">圖片文件: </label><input type="text" id="xheImgUrl" value="http://" class="xheText" /></div><div><div><label for="xheImgAlt">替換文本: </label><input type="text" id="xheImgAlt" /></div><div><label for="xheImgAlign">對齊方式: </label><select id="xheImgAlign"><option selected="selected" value="">預設</option><option value="left">靠左對齊</option><option value="right">靠右對齊</option><option value="top">頂端</option><option value="middle">置中</option><option value="baseline">基線</option><option value="bottom">底邊</option></select></div><div><label for="xheImgWidth">寬　　度: </label><input type="text" id="xheImgWidth" style="width:40px;" /> <label for="xheImgHeight">高　　度: </label><input type="text" id="xheImgHeight" style="width:40px;" /></div><div><label for="xheImgBorder">邊框大小: </label><input type="text" id="xheImgBorder" style="width:40px;" /></div><div><label for="xheImgHspace">水平間距: </label><input type="text" id="xheImgHspace" style="width:40px;" /> <label for="xheImgVspace">垂直間距: </label><input type="text" id="xheImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="確定" /></div>'),a=c.getParent("img"),i=e("#xheImgUrl",t),n=e("#xheImgAlt",t),o=e("#xheImgAlign",t),s=e("#xheImgWidth",t),r=e("#xheImgHeight",t),h=e("#xheImgBorder",t),d=e("#xheImgVspace",t),u=e("#xheImgHspace",t),p=e("#xheSave",t);if(1===a.length){i.val(K(a,"src")),n.val(a.attr("alt")),o.val(a.attr("align")),s.val(a.attr("width")),r.val(a.attr("height")),h.val(a.attr("border"));var f=a.attr("vspace"),m=a.attr("hspace");d.val(0>=f?"":f),u.val(0>=m?"":m)}g.upImgUrl&&c.uploadInit(i,g.upImgUrl,g.upImgExt),p.click(function(){c.loadBookmark();var t=i.val();if(""!==t&&"http://"!==t){var p=t.split(" "),f=n.val(),g=o.val(),m=s.val(),v=r.val(),x=h.val(),b=d.val(),y=u.val();if(1<p.length){var w='<img src="xhe_tmpurl"',k=[];""!==f&&(w+=' alt="'+f+'"'),""!==g&&(w+=' align="'+g+'"'),""!==m&&(w+=' width="'+m+'"'),""!==v&&(w+=' height="'+v+'"'),""!==x&&(w+=' border="'+x+'"'),""!==b&&(w+=' vspace="'+b+'"'),""!==y&&(w+=' hspace="'+y+'"');var C,w=w+" />";for(C in p)t=p[C],""!==t&&(t=t.split("||"),f=w,f=f.replace("xhe_tmpurl",t[0]),t[1]&&(f='<a href="'+t[1]+'" target="_blank">'+f+"</a>"),k.push(f));c.pasteHTML(k.join("&nbsp;"))}else 1===p.length&&(t=p[0],""!==t&&(t=t.split("||"),0===a.length&&(c.pasteHTML('<img src="'+t[0]+'#xhe_tmpurl" />'),a=e('img[src$="#xhe_tmpurl"]',l)),K(a,"src",t[0]),""!==f&&a.attr("alt",f),""!==g?a.attr("align",g):a.removeAttr("align"),""!==m?a.attr("width",m):a.removeAttr("width"),""!==v?a.attr("height",v):a.removeAttr("height"),""!==x?a.attr("border",x):a.removeAttr("border"),""!==b?a.attr("vspace",b):a.removeAttr("vspace"),""!==y?a.attr("hspace",y):a.removeAttr("hspace"),t[1]&&(p=a.parent("a"),0===p.length&&(a.wrap("<a></a>"),p=a.parent("a")),K(p,"href",t[1]),p.attr("target","_blank"))))}else 1===a.length&&a.remove();return c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showEmbed=function(t,a,i,n,o,s,r){var a=e(a),h=c.getParent('embed[type="'+i+'"],embed[classid="'+n+'"]'),d=e("#xhe"+t+"Url",a),u=e("#xhe"+t+"Width",a),p=e("#xhe"+t+"Height",a),t=e("#xheSave",a);s&&c.uploadInit(d,s,r),1===h.length&&(d.val(K(h,"src")),u.val(h.attr("width")),p.val(h.attr("height"))),t.click(function(){c.loadBookmark();var t=d.val();if(""!==t&&"http://"!==t){var a=u.val(),s=p.val(),r=/^\d+%?$/;r.test(a)||(a=412),r.test(s)||(s=300);var f='<embed type="'+i+'" classid="'+n+'" src="xhe_tmpurl"'+o,r=t.split(" ");if(1<r.length){var g,m,v=[],f=f+' width="xhe_width" height="xhe_height" />';for(m in r)t=r[m].split("||"),g=f,g=g.replace("xhe_tmpurl",t[0]),g=g.replace("xhe_width",t[1]?t[1]:a),g=g.replace("xhe_height",t[2]?t[2]:s),""!==t&&v.push(g);c.pasteHTML(v.join("&nbsp;"))}else 1===r.length&&(t=r[0].split("||"),0===h.length&&(c.pasteHTML(f.replace("xhe_tmpurl",t[0]+"#xhe_tmpurl")+" />"),h=e('embed[src$="#xhe_tmpurl"]',l)),K(h,"src",t[0]),h.attr("width",t[1]?t[1]:a),h.attr("height",t[2]?t[2]:s))}else 1===h.length&&h.remove();return c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(a)},this.showEmot=function(t){var a=e('<div class="xheEmot"></div>'),t=t?t:Qa?Qa:"default",i=Ba[t],n=X+t+"/",l=0,o=[],s="",s=i.width,r=i.height,h=i.line,d=i.count,i=i.list;if(d)for(i=1;d>=i;i++)l++,o.push("<a href=\"javascript:void('"+i+'\')" style="background-image:url('+n+i+'.gif);" emot="'+t+","+i+'" xhev="" title="'+i+'" role="option">&nbsp;</a>'),0===l%h&&o.push("<br />");else e.each(i,function(e,a){l++,o.push("<a href=\"javascript:void('"+a+'\')" style="background-image:url('+n+e+'.gif);" emot="'+t+","+e+'" title="'+a+'" xhev="'+a+'" role="option">&nbsp;</a>'),0===l%h&&o.push("<br />")});var d=h*(s+12),i=Math.ceil(l/h)*(r+12),u=.75*d;u>=i&&(u=""),s=e("<style>"+(u?".xheEmot div{width:"+(d+20)+"px;height:"+u+"px;}":"")+".xheEmot div a{width:"+s+"px;height:"+r+"px;}</style><div>"+o.join("")+"</div>").click(function(t){var t=t.target,a=e(t);return e.nodeName(t,"A")?(c.loadBookmark(),c.pasteHTML('<img emot="'+a.attr("emot")+'" alt="'+a.attr("xhev")+'">'),c.hidePanel(),!1):void 0}).mousedown(M),a.append(s);var p=0,f=['<ul role="tablist">'];e.each(Ba,function(e,a){p++,f.push("<li"+(t===e?' class="cur"':"")+' role="presentation"><a href="javascript:void(\''+a.name+'\')" group="'+e+'" role="tab" tabindex="0">'+a.name+"</a></li>")}),p>1&&(f.push('</ul><br style="clear:both;" />'),s=e(f.join("")).click(function(t){return Qa=e(t.target).attr("group"),c.exec("Emot"),!1}).mousedown(M),a.append(s)),c.saveBookmark(),c.showPanel(a)},this.showTable=function(){var t=e('<div><label for="xheTableRows">行　　數: </label><input type="text" id="xheTableRows" style="width:40px;" value="3" /> <label for="xheTableColumns">列　　數: </label><input type="text" id="xheTableColumns" style="width:40px;" value="2" /></div><div><label for="xheTableHeaders">標題單元: </label><select id="xheTableHeaders"><option selected="selected" value="">無</option><option value="row">第一行</option><option value="col">第一列</option><option value="both">第一行和第一列</option></select></div><div><label for="xheTableWidth">寬　　度: </label><input type="text" id="xheTableWidth" style="width:40px;" value="200" /> <label for="xheTableHeight">高　　度: </label><input type="text" id="xheTableHeight" style="width:40px;" value="" /></div><div><label for="xheTableBorder">邊框大小: </label><input type="text" id="xheTableBorder" style="width:40px;" value="1" /></div><div><label for="xheTableCellSpacing">表格間距: </label><input type="text" id="xheTableCellSpacing" style="width:40px;" value="1" /> <label for="xheTableCellPadding">表格填充: </label><input type="text" id="xheTableCellPadding" style="width:40px;" value="1" /></div><div><label for="xheTableAlign">對齊方式: </label><select id="xheTableAlign"><option selected="selected" value="">預設</option><option value="left">靠左對齊</option><option value="center">置中</option><option value="right">靠右對齊</option></select></div><div><label for="xheTableCaption">表格標題: </label><input type="text" id="xheTableCaption" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="確定" /></div>'),a=e("#xheTableRows",t),i=e("#xheTableColumns",t),n=e("#xheTableHeaders",t),l=e("#xheTableWidth",t),o=e("#xheTableHeight",t),s=e("#xheTableBorder",t),r=e("#xheTableCellSpacing",t),h=e("#xheTableCellPadding",t),d=e("#xheTableAlign",t),u=e("#xheTableCaption",t);e("#xheSave",t).click(function(){c.loadBookmark();var e=u.val(),t=s.val(),p=a.val(),f=i.val(),g=n.val(),m=l.val(),v=o.val(),x=r.val(),b=h.val(),y=d.val(),t="<table"+(""!==t?' border="'+t+'"':"")+(""!==m?' width="'+m+'"':"")+(""!==v?' height="'+v+'"':"")+(""!==x?' cellspacing="'+x+'"':"")+(""!==b?' cellpadding="'+b+'"':"")+(""!==y?' align="'+y+'"':"")+">";if(""!==e&&(t+="<caption>"+e+"</caption>"),"row"===g||"both"===g){for(t+="<tr>",e=0;f>e;e++)t+='<th scope="col"></th>';t+="</tr>",p--}for(t+="<tbody>",e=0;p>e;e++){for(t+="<tr>",m=0;f>m;m++)t=0!==m||"col"!==g&&"both"!==g?t+"<td></td>":t+'<th scope="row"></th>';t+="</tr>"}return c.pasteHTML(t+"</tbody></table>"),c.hidePanel(),!1}),c.saveBookmark(),c.showDialog(t)},this.showAbout=function(){var t=e('<div style="font:12px Arial;width:245px;word-wrap:break-word;word-break:break-all;outline:none;" role="dialog" tabindex="-1"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />v1.1.12 (build 111204)</p><p>xhEditor是基於jQuery開發的跨平台輕量可視化XHTML編輯器，基於<a href="http://www.gnu.org/licenses/lgpl.html" target="_blank">LGPL</a>開源協議發佈。</p><p>Copyright &copy; <a href="http://xheditor.com/" target="_blank">xhEditor.com</a>. All rights reserved.</p></div>');t.find("p").attr("role","presentation"),c.showDialog(t,!0),setTimeout(function(){t.focus()},100)},this.addShortcuts=function(e,t){e=e.toLowerCase(),la[e]===Z&&(la[e]=[]),la[e].push(t)},this.delShortcuts=function(e){delete la[e]},this.uploadInit=function(t,a,i){function n(e){L(e,"string")&&(e=[e]);var a,i,n=!1,l=e.length,o=[];for((a=g.onUpload)&&a(e),a=0;l>a;a++)i=e[a],i=L(i,"string")?i:i.url,"!"===i.substr(0,1)&&(n=!0,i=i.substr(1)),o.push(i);t.val(o.join(" ")),n&&t.closest(".xheDialog").find("#xheSave").click()}var l=e('<span class="xheUpload"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="'+g.upBtnText+'" class="xheBtn" tabindex="-1" /></span>'),o=e(".xheBtn",l),s=g.html5Upload,r=s?g.upMultiple:1;if(t.after(l),o.before(t),a=a.replace(/{editorRoot}/gi,J),"!"===a.substr(0,1))o.click(function(){c.showIframeModal("上傳文件",a.substr(1),n,null,null)});else{l.append('<input type="file"'+(r>1?' multiple=""':"")+' class="xheFile" size="13" name="filedata" tabindex="-1" />');var h=e(".xheFile",l);h.change(function(){c.startUpload(h[0],a,i,n)}),setTimeout(function(){t.closest(".xheDialog").bind("dragenter dragover",M).bind("drop",function(e){var t,e=e.originalEvent.dataTransfer;return s&&e&&(t=e.files)&&0<t.length&&c.startUpload(t,a,i,n),!1})},10)}},this.startUpload=function(a,b,d,f){function h(a,d){var e=Object,g=!1;try{e=eval("("+a+")")}catch(h){}return e.err===Z||e.msg===Z?alert(b+" 上傳接口發生錯誤！\r\n\r\n返回的錯誤內容為: \r\n\r\n"+a):e.err?alert(e.err):(m.push(e.msg),g=!0),(!g||d)&&c.removeModal(),d&&g&&f(m),g}var m=[],i=g.html5Upload,k=i?g.upMultiple:1,j,r=e('<div style="padding:22px 0;text-align:center;line-height:30px;">文件上傳中，請稍候……<br /></div>'),s='<img src="'+va+'img/loading.gif">';if(i&&(!a.nodeType||(j=a.files)&&j[0].name)){if(j||(j=a),a=j.length,a>k)return void alert("請不要一次上傳超過"+k+"個文件");for(k=0;a>k;k++)if(!Wa(j[k].name,d))return;var l=e('<div class="xheProgress"><div><span>0%</span></div></div>');r.append(l),d=new c.html5Upload("filedata",j,b,h,function(t){if(0<=t.loaded){var a=Math.round(100*t.loaded/t.total)+"%";e("div",l).css("width",a),e("span",l).text(a+" ( "+Xa(t.loaded)+" / "+Xa(t.total)+" )")}else l.replaceWith(s)})}else{if(!Wa(a.value,d))return;r.append(s),d=new c.html4Upload(a,b,h)}c.showModal("文件上傳中(Esc取消上傳)",r,320,150),d.start()},this.html4Upload=function(t,a,i){var n="jUploadFrame"+(new Date).getTime(),l=this,o=e('<iframe name="'+n+'" class="xheHideArea" />').appendTo("body"),s=e('<form action="'+a+'" target="'+n+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body"),r=e(t),c=r.clone().attr("disabled","true");return r.before(c).appendTo(s),this.remove=function(){null!==l&&(c.before(r).remove(),o.remove(),s.remove(),l=null)},this.onLoad=function(){var t=o[0].contentWindow.document,a=e(t.body).text();t.write(""),l.remove(),i(a,!0)},this.start=function(){s.submit(),o.load(l.onLoad)},this},this.html5Upload=function(e,t,a,i,n){function l(t,a,i,n){s=new XMLHttpRequest,upload=s.upload,s.onreadystatechange=function(){4===s.readyState&&i(s.responseText)},upload?upload.onprogress=function(e){n(e.loaded)}:n(-1),s.open("POST",a),s.setRequestHeader("Content-Type","application/octet-stream"),s.setRequestHeader("Content-Disposition",'attachment; name="'+encodeURIComponent(e)+'"; filename="'+encodeURIComponent(t.name)+'"'),s.sendAsBinary&&t.getAsBinary?s.sendAsBinary(t.getAsBinary()):s.send(t)}function o(e){n&&n({loaded:h+e,total:d})}for(var s,r=0,c=t.length,h=0,d=0,u=this,p=0;c>p;p++)d+=t[p].size;this.remove=function(){s&&(s.abort(),s=null)},this.uploadNext=function(e){e&&(h+=t[r-1].size,o(0)),(!e||e&&!0===i(e,r===c))&&c>r&&l(t[r++],a,u.uploadNext,function(e){o(e)})},this.start=function(){u.uploadNext()}},this.showIframeModal=function(a,b,d,f,g,j){function i(){try{s.callback=k,s.unloadme=c.removeModal,e(s.document).keydown(H),n=s.name}catch(t){}}function k(e){s.document.write(""),c.removeModal(),null!=e&&d(e)}var b=e('<iframe frameborder="0" src="'+b.replace(/{editorRoot}/gi,J)+(/\?/.test(b)?"&":"?")+"parenthost="+location.host+'" style="width:100%;height:100%;display:none;" /><div class="xheModalIfmWait"></div>'),l=b.eq(0),r=b.eq(1);c.showModal(a,b,f,g,j);var s=l[0].contentWindow,n;i(),l.load(function(){if(i(),n){var a=!0;try{n=eval("("+unescape(n)+")")}catch(b){a=!1}if(a)return k(n)}r.is(":visible")&&(l.show().focus(),r.remove())})},this.showModal=function(t,a,i,n,l){return ua?!1:(c.panelState=R,R=!1,da=g.layerShadow,i=i?i:g.modalWidth,n=n?n:g.modalHeight,I=e('<div class="xheModal" style="width:'+(i-1)+"px;height:"+n+"px;margin-left:-"+Math.ceil(i/2)+"px;"+(j&&7>qa?"":"margin-top:-"+Math.ceil(n/2)+"px")+'">'+(g.modalTitle?'<div class="xheModalTitle"><span class="xheModalClose" title="關閉 (Esc)" tabindex="0" role="button"></span>'+t+"</div>":"")+'<div class="xheModalContent"></div></div>').appendTo("body"),Ea=e('<div class="xheModalOverlay"></div>').appendTo("body"),da>0&&(Da=e('<div class="xheModalShadow" style="width:'+I.outerWidth()+"px;height:"+I.outerHeight()+"px;margin-left:-"+(Math.ceil(i/2)-da-2)+"px;"+(j&&7>qa?"":"margin-top:-"+(Math.ceil(n/2)-da-2)+"px")+'"></div>').appendTo("body")),e(".xheModalContent",I).css("height",n-(g.modalTitle?e(".xheModalTitle").outerHeight():0)).html(a),j&&6===qa&&(Fa=e("select:visible").css("visibility","hidden")),e(".xheModalClose",I).click(c.removeModal),Ea.show(),da>0&&Da.show(),I.show(),setTimeout(function(){I.find("a,input[type=text],textarea").filter(":visible").filter(function(){return"hidden"!==e(this).css("visibility")}).eq(0).focus()},10),ua=!0,void(Ga=l))},this.removeModal=function(){Fa&&Fa.css("visibility","visible"),I.html("").remove(),da>0&&Da.remove(),Ea.remove(),Ga&&Ga(),ua=!1,R=c.panelState},this.showDialog=function(t,a){var i=e('<div class="xheDialog"></div>'),n=e(t),l=e("#xheSave",n);if(1===l.length){if(n.find("input[type=text],select").keypress(function(e){return 13===e.which?(l.click(),!1):void 0}),n.find("textarea").keydown(function(e){return e.ctrlKey&&13===e.which?(l.click(),!1):void 0}),l.after(' <input type="button" id="xheCancel" value="取消" />'),e("#xheCancel",n).click(c.hidePanel),!g.clickCancelDialog){ta=!1;var o=e('<div class="xheFixCancel"></div>').appendTo("body").mousedown(M),s=A.offset();o.css({left:s.left,top:s.top,width:A.outerWidth(),height:A.outerHeight()})}i.mousedown(function(){oa=!0})}i.append(n),c.showPanel(i,a)},this.showPanel=function(a,i){if(!w.target)return!1;t.html("").append(a).css("left",-999).css("top",-999),ca=e(w.target).closest("a").addClass("xheActive");var n=ca.offset(),l=n.left,n=n.top,n=n+(ca.outerHeight()-1);ba.css({left:l+1,top:n,width:ca.width()}).show();var o=document.documentElement,s=document.body;l+t.outerWidth()>(window.pageXOffset||o.scrollLeft||s.scrollLeft)+(o.clientWidth||s.clientWidth)&&(l-=t.outerWidth()-ca.outerWidth()),o=g.layerShadow,o>0&&aa.css({left:l+o,top:n+o,width:t.outerWidth(),height:t.outerHeight()}).show(),ma&&!isNaN(ma)&&(aa.css("zIndex",parseFloat(ma)+1),t.css("zIndex",parseFloat(ma)+2),ba.css("zIndex",parseFloat(ma)+3)),t.css({left:l,top:n}).show(),i||setTimeout(function(){t.find("a,input[type=text],textarea").filter(":visible").filter(function(){return"hidden"!==e(this).css("visibility")}).eq(0).focus()},10),Pa=R=!0},this.hidePanel=function(){R&&(ca.removeClass("xheActive"),aa.hide(),ba.hide(),t.hide(),R=!1,ta||(e(".xheFixCancel").remove(),ta=!0),Pa=oa=!1,W=null,c.focus(),c.loadBookmark())},this.exec=function(t){c.hidePanel();var a=ja[t];if(!a)return!1;if(null===w){w={};var i=q.find(".xheButton[cmd="+t+"]");1===i.length&&(w.target=i)}if(a.e)a.e.call(c);else switch(t=t.toLowerCase()){case"cut":try{if(l.execCommand(t),!l.queryCommandSupported(t))throw"Error"}catch(n){alert("您的瀏覽器安全設置不允許使用剪下操作，請使用鍵盤快捷鍵(Ctrl + X)來完成")}break;case"copy":try{if(l.execCommand(t),!l.queryCommandSupported(t))throw"Error"}catch(o){alert("您的瀏覽器安全設置不允許使用複製操作，請使用鍵盤快捷鍵(Ctrl + C)來完成")}break;case"paste":try{if(l.execCommand(t),!l.queryCommandSupported(t))throw"Error"}catch(s){alert("您的瀏覽器安全設置不允許使用貼上操作，請使用鍵盤快捷鍵(Ctrl + V)來完成")}break;case"pastetext":window.clipboardData?c.pasteText(window.clipboardData.getData("Text",!0)):c.showPastetext();break;case"blocktag":var r=[];e.each(gb,function(e,t){r.push({s:"<"+t.n+">"+t.t+"</"+t.n+">",v:"<"+t.n+">",t:t.t})}),c.showMenu(r,function(e){c._exec("formatblock",e)});break;case"fontface":var h=[];e.each(hb,function(e,t){t.c=t.c?t.c:t.n,h.push({s:'<span style="font-family:'+t.c+'">'+t.n+"</span>",v:t.c,t:t.n})}),c.showMenu(h,function(e){c._exec("fontname",e)});break;case"fontsize":var d=[];e.each(S,function(e,t){d.push({s:'<span style="font-size:'+t.s+';">'+t.t+"("+t.s+")</span>",v:e+1,t:t.t})}),c.showMenu(d,function(e){c._exec("fontsize",e)});break;case"fontcolor":c.showColor(function(e){c._exec("forecolor",e)});break;case"backcolor":c.showColor(function(e){j?c._exec("backcolor",e):(Ja(!0),c._exec("hilitecolor",e),Ja(!1))});break;case"align":c.showMenu(ib,function(e){c._exec(e)});break;case"list":c.showMenu(jb,function(e){c._exec(e)});break;case"link":c.showLink();break;case"anchor":c.showAnchor();break;case"img":c.showImg();break;case"flash":c.showEmbed("Flash",'<div><label for="xheFlashUrl">動畫文件: </label><input type="text" id="xheFlashUrl" value="http://" class="xheText" /></div><div><label for="xheFlashWidth">寬　　度: </label><input type="text" id="xheFlashWidth" style="width:40px;" value="480" /> <label for="xheFlashHeight">高　　度: </label><input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="確定" /></div>',"application/x-shockwave-flash","clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000",' wmode="opaque" quality="high" menu="false" play="true" loop="true" allowfullscreen="true"',g.upFlashUrl,g.upFlashExt);break;case"media":c.showEmbed("Media",'<div><label for="xheMediaUrl">媒體文件: </label><input type="text" id="xheMediaUrl" value="http://" class="xheText" /></div><div><label for="xheMediaWidth">寬　　度: </label><input type="text" id="xheMediaWidth" style="width:40px;" value="480" /> <label for="xheMediaHeight">高　　度: </label><input type="text" id="xheMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="確定" /></div>',"application/x-mplayer2","clsid:6bf52a52-394a-11d3-b153-00c04f79faa6",' enablecontextmenu="false" autostart="false"',g.upMediaUrl,g.upMediaExt);break;case"hr":c.pasteHTML("<hr />");break;case"emot":c.showEmot();break;case"table":c.showTable();break;case"source":c.toggleSource();break;case"preview":c.showPreview();break;case"print":V.print();break;case"fullscreen":c.toggleFullscreen();break;case"about":c.showAbout();break;default:c._exec(t)}w=null},this._exec=function(e,t,a){return a||c.focus(),t!==Z?l.execCommand(e,!1,t):l.execCommand(e,!1,null)}};sa.settings={skin:"default",tools:"full",clickCancelDialog:!0,linkTag:!1,internalScript:!1,inlineScript:!1,internalStyle:!0,inlineStyle:!0,showBlocktag:!1,forcePtag:!0,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",upMediaExt:"wmv,avi,wma,mp3,mid",modalWidth:350,modalHeight:220,modalTitle:!0,defLinkText:"點擊打開鏈接",layerShadow:3,emotMark:!1,upBtnText:"上傳",cleanPaste:2,hoverExecDelay:100,html5Upload:!0,upMultiple:99},window.xheditor=sa,e(function(){e.fn.oldVal=e.fn.val,e.fn.val=function(e){var t,a=this;return e===Z?a[0]&&(t=a[0].xheditor)?t.getSource():a.oldVal():a.each(function(){(t=this.xheditor)?t.setSource(e):a.oldVal(e)})},e("textarea").each(function(){var t=e(this),a=t.attr("class");a&&(a=a.match(/(?:^|\s)xheditor(?:\-(m?full|simple|mini))?(?:\s|$)/i))&&t.xheditor(a[1]?{tools:a[1]}:null)})})}(jQuery);