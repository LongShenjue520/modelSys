!function(t){var e=[],a=function(o){t.each(e,function(i){e[i]!=o&&(t("#"+e[i])[0]?t("#op_"+e[i]).css({height:"",width:""}).hide():t("#op_"+e[i]).remove(),t(document).unbind("click",a))})};t.extend(t.fn,{comboxSelect:function(o,i){var c=t.extend({selector:">a"},i);return this.each(function(){var o=t(this),i=t(c.selector,o);e.push(o.attr("id")),t(c.selector,o).click(function(){var e=t("#op_"+o.attr("id"));if(e.is(":hidden")){e.height()>300&&e.css({height:"300px",overflow:"scroll"});var i=o.offset().top+o[0].offsetHeight-50;i+e.height()>t(window).height()-20&&(i=t(window).height()-20-e.height()),e.css({top:i,left:o.offset().left}).show(),a(o.attr("id")),t(document).click(a)}else t(document).unbind("click",a),a();return!1}),t("#op_"+o.attr("id")).find(">li").comboxOption(i,o)})},comboxOption:function(e,a){return e.text(a.data("title")),this.each(function(){t(">a",this).click(function(){var o=t(this);o.parent().parent().find(".selected").removeClass("selected"),o.addClass("selected"),e.text(o.text());var i=t("select",a);if(i.val()!=o.attr("value")){a.attr("ref");t("select",a).val(o.attr("value")).trigger("change")}})})},combox:function(){var a=[];return t.each(e,function(o){t("#"+e[o])[0]?a.push(e[o]):t("#op_"+e[o]).remove()}),e=a,this.each(function(e){var a=t(this).removeClass("combox"),o=a.attr("name"),i=a.attr("value"),c=t("option[value="+i+"]",a).text(),r=a.attr("ref"),n=a.attr("refUrl")||"",s=a.attr("id")||Math.round(1e7*Math.random()),l='<div class="combox"><div id="combox_'+s+'" class="select"'+(r?' ref="'+r+'"':"")+">";l+='<a href="javascript:" class="'+a.attr("class")+'" name="'+o+'" value="'+i+'">'+c+"</a></div></div>";var h='<ul class="comboxop" id="op_combox_'+s+'">';t("option",a).each(function(){var e=t(this);h+='<li><a class="'+(i==e[0].value?"selected":"")+'" href="#" value="'+e[0].value+'">'+e[0].text+"</a></li>"}),h+="</ul>",t("body").append(h),a.after(l),t("div.select",a.next()).comboxSelect().append(a),r&&n&&a.bind("change",{},function(e){var o=t("#"+r);return 0==o.size()?!1:void t.ajax({type:"GET",dataType:"json",url:n.replace("{value}",a.attr("value")),cache:!1,data:{},success:function(e){if(e){var a="";t.each(e,function(t){e[t]&&e[t].length>1&&(a+='<option value="'+e[t][0]+'">'+e[t][1]+"</option>")});var i=o.parents("div.combox:first");o.html(a).insertAfter(i),i.remove(),o.trigger("change").combox()}},error:DWZ.ajaxError})})})}})}(jQuery);