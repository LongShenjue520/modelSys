!function(t){t.fn.extend({jTask:function(s){return this.each(function(){var s=t(this),i=s.attr("id");s.click(function(e){var a=t("body").data(i);return s.hasClass("selected")?t("a.minimize",a).trigger("click"):a.is(":hidden")?t.taskBar.restoreDialog(a):t(a).trigger("click"),t.taskBar.scrollCurrent(t(this)),!1}),t("div.close",s).click(function(s){return t.pdialog.close(i),!1}).hoverClass("closeHover"),s.hoverClass("hover")})}}),t.taskBar={_taskBar:null,_taskBox:null,_prevBut:null,_nextBut:null,_op:{id:"taskbar",taskBox:"div.taskbarContent",prevBut:".taskbarLeft",prevDis:"taskbarLeftDisabled",nextBut:".taskbarRight",nextDis:"taskbarRightDisabled",selected:"selected",boxMargin:"taskbarMargin"},init:function(s){var i=this;t.extend(this._op,s),this._taskBar=t("#"+this._op.id),0==this._taskBar.size()&&(this._taskBar=t(DWZ.frag.taskbar).appendTo(t("#layout")),this._taskBar.find(".taskbarLeft").hoverClass("taskbarLeftHover"),this._taskBar.find(".taskbarRight").hoverClass("taskbarRightHover")),this._taskBox=this._taskBar.find(this._op.taskBox),this._taskList=this._taskBox.find(">ul"),this._prevBut=this._taskBar.find(this._op.prevBut),this._nextBut=this._taskBar.find(this._op.nextBut),this._prevBut.click(function(t){i.scrollLeft()}),this._nextBut.click(function(t){i.scrollRight()}),this._contextmenu(this._taskBox)},_contextmenu:function(s){t(s).contextMenu("dialogCM",{bindings:{closeCurrent:function(s,i){var e=s.isTag("li")?s:t.taskBar._getCurrent();t("div.close",e).trigger("click")},closeOther:function(s,i){var e=s.isTag("li")?"#"+s.attr("id"):".selected",a=t.taskBar._taskList.find(">li:not(:"+e+")");a.each(function(s){t("div.close",a[s]).trigger("click")})},closeAll:function(s,i){var e=t.taskBar._getTasks();e.each(function(s){t("div.close",e[s]).trigger("click")})}},ctrSub:function(s,i){var e=i.find("[rel='closeCurrent']"),a=i.find("[rel='closeOther']");t.taskBar._getCurrent()[0]?1==t.taskBar._getTasks().size()&&a.addClass("disabled"):(e.addClass("disabled"),a.addClass("disabled"))}})},_scrollCurrent:function(){var s=this._tasksW(this._getTasks());if(s>this._getTaskBarW()){var i=this,e=t(">li:last-child",this._taskList),a=this._getTaskBarW()-e.position().left-e.outerWidth(!0);this._taskList.animate({left:a+"px"},200,function(){i._ctrlScrollBut()})}else this._ctrlScrollBut()},_getTaskBarW:function(){return this._taskBox.width()-(this._prevBut.is(":hidden")?this._prevBut.width()+2:0)-(this._nextBut.is(":hidden")?this._nextBut.width()+2:0)},_scrollTask:function(t){var s=this;if(t.position().left+this._getLeft()+t.outerWidth()>this._getBarWidth()){var i=this._getTaskBarW()-t.position().left-t.outerWidth(!0)-2;this._taskList.animate({left:i+"px"},200,function(){s._ctrlScrollBut()})}else if(t.position().left+this._getLeft()<0){var i=this._getLeft()-(t.position().left+this._getLeft());this._taskList.animate({left:i+"px"},200,function(){s._ctrlScrollBut()})}},_ctrlScrollBut:function(){var t=this._tasksW(this._getTasks());this._getTaskBarW()>t?(this._taskBox.removeClass(this._op.boxMargin),this._nextBut.hide(),this._prevBut.hide(),this._getTasks().eq(0)[0]&&this._scrollTask(this._getTasks().eq(0))):(this._taskBox.addClass(this._op.boxMargin),this._nextBut.show().removeClass(this._op.nextDis),this._prevBut.show().removeClass(this._op.prevDis),this._getLeft()>=0&&this._prevBut.addClass(this._op.prevDis),this._getLeft()<=this._getTaskBarW()-t&&this._nextBut.addClass(this._op.nextDis))},_getLeft:function(){return this._taskList.position().left},_visibleStart:function(){for(var t=this._getLeft(),s=this._getTasks(),i=0;i<s.size();i++)if(s.eq(i).position().left+s.eq(i).outerWidth(!0)+t>=0)return s.eq(i);return s.eq(0)},_visibleEnd:function(){for(var t=this._getLeft(),s=this._getTasks(),i=0;i<s.size();i++)if(s.eq(i).position().left+s.eq(i).outerWidth(!0)+t>this._getBarWidth())return s.eq(i);return s.eq(s.size()-1)},_getTasks:function(){return this._taskList.find(">li")},_tasksW:function(s){var i=0;return s.each(function(){i+=t(this).outerWidth(!0)}),i},_getBarWidth:function(){return this._taskBar.innerWidth(!0)},addDialog:function(s,i){this.show();var e=t("#"+s,this._taskList);if(e[0])t(">div>span",e).text(i);else{var a='<li id="#taskid#"><div class="taskbutton"><span>#title#</span></div><div class="close">Close</div></li>';this._taskList.append(a.replace("#taskid#",s).replace("#title#",i)),e=t("#"+s,this._taskList),e.jTask()}this._contextmenu(e),this.switchTask(s),this._scrollTask(e)},closeDialog:function(s){var i="string"==typeof s?t("#"+s,this._taskList):s;i.remove(),0==this._getTasks().size()&&this.hide(),this._scrollCurrent()},restoreDialog:function(s){var i="string"==typeof s?t("body").data(s):s,e="string"==typeof s?s:i.data("id"),a=t.taskBar.getTask(e);t(".resizable").css({top:t(window).height()-60,left:t(a).position().left,height:t(a).outerHeight(),width:t(a).outerWidth()}).show().animate({top:t(i).css("top"),left:t(i).css("left"),width:t(i).css("width"),height:t(i).css("height")},250,function(){t(this).hide(),t(i).show(),t.pdialog.attachShadow(i)}),t.taskBar.switchTask(e)},inactive:function(s){t("#"+s,this._taskList).removeClass("selected")},scrollLeft:function(){var t=this._visibleStart();this._scrollTask(t)},scrollRight:function(){var t=this._visibleEnd();this._scrollTask(t)},scrollCurrent:function(t){this._scrollTask(t)},switchTask:function(t){this._getCurrent().removeClass("selected"),this.getTask(t).addClass("selected")},_getCurrent:function(){return this._taskList.find(">.selected")},getTask:function(s){return t("#"+s,this._taskList)},show:function(){this._taskBar.is(":hidden")&&(this._taskBar.css("top",t(window).height()-34+this._taskBar.outerHeight()).show(),this._taskBar.animate({top:t(window).height()-this._taskBar.outerHeight()},500))},hide:function(){this._taskBar.animate({top:t(window).height()-29+this._taskBar.outerHeight(!0)},500,function(){t.taskBar._taskBar.hide()})}}}(jQuery);